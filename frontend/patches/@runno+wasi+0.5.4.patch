diff --git a/node_modules/@runno/wasi/dist/lib/worker/wasi-host.d.ts b/node_modules/@runno/wasi/dist/lib/worker/wasi-host.d.ts
index c5a5474..cf4702a 100644
--- a/node_modules/@runno/wasi/dist/lib/worker/wasi-host.d.ts
+++ b/node_modules/@runno/wasi/dist/lib/worker/wasi-host.d.ts
@@ -5,12 +5,13 @@ export declare class WASIWorkerHostKilledError extends Error {
 }
 export declare class WASIWorkerHost {
     binaryURL: string;
+    binaryBuffer: ArrayBuffer;
     stdinBuffer: SharedArrayBuffer;
     context: WASIWorkerHostContext;
     result?: Promise<WASIExecutionResult>;
     worker?: Worker;
     reject?: (reason?: unknown) => void;
-    constructor(binaryURL: string, context: WASIWorkerHostContext);
+    constructor(binaryURL: string, binaryBuffer: ArrayBuffer, context: WASIWorkerHostContext);
     start(): Promise<WASIExecutionResult>;
     kill(): void;
     pushStdin(data: string): Promise<void>;
diff --git a/node_modules/@runno/wasi/dist/lib/worker/wasi-worker.d.ts b/node_modules/@runno/wasi/dist/lib/worker/wasi-worker.d.ts
index e273ea6..e1c1ff1 100644
--- a/node_modules/@runno/wasi/dist/lib/worker/wasi-worker.d.ts
+++ b/node_modules/@runno/wasi/dist/lib/worker/wasi-worker.d.ts
@@ -3,11 +3,17 @@ import type { WASIExecutionResult } from "../types";
 type WorkerWASIContext = Partial<Omit<WASIContextOptions, "stdin" | "stdout" | "stderr" | "debug">>;
 type StartWorkerMessage = {
     target: "client";
-    type: "start";
+    type: "startURL";
     binaryURL: string;
     stdinBuffer: SharedArrayBuffer;
 } & WorkerWASIContext;
-export type WorkerMessage = StartWorkerMessage;
+type StartWorkerBufferMessage = {
+    target: "client";
+    type: "startBuffer";
+    binaryBuffer: ArrayBuffer;
+    stdinBuffer: SharedArrayBuffer;
+} & WorkerWASIContext;
+export type WorkerMessage = StartWorkerMessage | StartWorkerBufferMessage;
 type StdoutHostMessage = {
     target: "host";
     type: "stdout";
diff --git a/node_modules/@runno/wasi/dist/wasi.js b/node_modules/@runno/wasi/dist/wasi.js
index f39bad4..f1b44a1 100644
--- a/node_modules/@runno/wasi/dist/wasi.js
+++ b/node_modules/@runno/wasi/dist/wasi.js
@@ -171,7 +171,7 @@ class at {
           }
         }, this.openFile(this.fs[h], a, l);
       }
-      return [c.ENOTCAPABLE];
+      return [c.ENOENT]; // quick dirty fix - wrong error code when accessing non-existing files
     }
   }
   close(t) {
@@ -258,7 +258,7 @@ class at {
       const l = `/${e}/`, s = Object.entries(this.fs).filter(([V]) => V.startsWith(l)), d = new S(Object.fromEntries(s), l).stat();
       return [c.SUCCESS, d];
     } else
-      return [c.ENOTCAPABLE];
+      return [c.ENOENT];
   }
   setFlags(t, e) {
     const n = this.openMap.get(t);
@@ -282,7 +282,7 @@ class at {
       return c.EBADF;
     const s = l.get(e);
     if (!s)
-      return c.ENOTCAPABLE;
+      return c.ENOENT;
     const d = new X(s, 0);
     return d.setAccessTime(n), d.sync(), c.SUCCESS;
   }
@@ -292,7 +292,7 @@ class at {
       return c.EBADF;
     const s = l.get(e);
     if (!s)
-      return c.ENOTCAPABLE;
+      return c.ENOENT;
     const d = new X(s, 0);
     return d.setModificationTime(n), d.sync(), c.SUCCESS;
   }
@@ -1427,7 +1427,9 @@ class Xt {
     }), this.debug = t == null ? void 0 : t.debug, this.isTTY = !!(t != null && t.isTTY);
   }
 }
-const tt = "dmFyIHV0PU9iamVjdC5kZWZpbmVQcm9wZXJ0eTt2YXIgZ3Q9KHIsVCxEKT0+VCBpbiByP3V0KHIsVCx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6RH0pOnJbVF09RDt2YXIgZD0ocixULEQpPT4oZ3Qocix0eXBlb2YgVCE9InN5bWJvbCI/VCsiIjpULEQpLEQpOyhmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgcj0oZT0+KGVbZS5TVUNDRVNTPTBdPSJTVUNDRVNTIixlW2UuRTJCSUc9MV09IkUyQklHIixlW2UuRUFDQ0VTUz0yXT0iRUFDQ0VTUyIsZVtlLkVBRERSSU5VU0U9M109IkVBRERSSU5VU0UiLGVbZS5FQUREUk5PVEFWQUlMPTRdPSJFQUREUk5PVEFWQUlMIixlW2UuRUFGTk9TVVBQT1JUPTVdPSJFQUZOT1NVUFBPUlQiLGVbZS5FQUdBSU49Nl09IkVBR0FJTiIsZVtlLkVBTFJFQURZPTddPSJFQUxSRUFEWSIsZVtlLkVCQURGPThdPSJFQkFERiIsZVtlLkVCQURNU0c9OV09IkVCQURNU0ciLGVbZS5FQlVTWT0xMF09IkVCVVNZIixlW2UuRUNBTkNFTEVEPTExXT0iRUNBTkNFTEVEIixlW2UuRUNISUxEPTEyXT0iRUNISUxEIixlW2UuRUNPTk5BQk9SVEVEPTEzXT0iRUNPTk5BQk9SVEVEIixlW2UuRUNPTk5SRUZVU0VEPTE0XT0iRUNPTk5SRUZVU0VEIixlW2UuRUNPTk5SRVNFVD0xNV09IkVDT05OUkVTRVQiLGVbZS5FREVBRExLPTE2XT0iRURFQURMSyIsZVtlLkVERVNUQUREUlJFUT0xN109IkVERVNUQUREUlJFUSIsZVtlLkVET009MThdPSJFRE9NIixlW2UuRURRVU9UPTE5XT0iRURRVU9UIixlW2UuRUVYSVNUPTIwXT0iRUVYSVNUIixlW2UuRUZBVUxUPTIxXT0iRUZBVUxUIixlW2UuRUZCSUc9MjJdPSJFRkJJRyIsZVtlLkVIT1NUVU5SRUFDSD0yM109IkVIT1NUVU5SRUFDSCIsZVtlLkVJRFJNPTI0XT0iRUlEUk0iLGVbZS5FSUxTRVE9MjVdPSJFSUxTRVEiLGVbZS5FSU5QUk9HUkVTUz0yNl09IkVJTlBST0dSRVNTIixlW2UuRUlOVFI9MjddPSJFSU5UUiIsZVtlLkVJTlZBTD0yOF09IkVJTlZBTCIsZVtlLkVJTz0yOV09IkVJTyIsZVtlLkVJU0NPTk49MzBdPSJFSVNDT05OIixlW2UuRUlTRElSPTMxXT0iRUlTRElSIixlW2UuRUxPT1A9MzJdPSJFTE9PUCIsZVtlLkVNRklMRT0zM109IkVNRklMRSIsZVtlLkVNTElOSz0zNF09IkVNTElOSyIsZVtlLkVNU0dTSVpFPTM1XT0iRU1TR1NJWkUiLGVbZS5FTVVMVElIT1A9MzZdPSJFTVVMVElIT1AiLGVbZS5FTkFNRVRPT0xPTkc9MzddPSJFTkFNRVRPT0xPTkciLGVbZS5FTkVURE9XTj0zOF09IkVORVRET1dOIixlW2UuRU5FVFJFU0VUPTM5XT0iRU5FVFJFU0VUIixlW2UuRU5FVFVOUkVBQ0g9NDBdPSJFTkVUVU5SRUFDSCIsZVtlLkVORklMRT00MV09IkVORklMRSIsZVtlLkVOT0JVRlM9NDJdPSJFTk9CVUZTIixlW2UuRU5PREVWPTQzXT0iRU5PREVWIixlW2UuRU5PRU5UPTQ0XT0iRU5PRU5UIixlW2UuRU5PRVhFQz00NV09IkVOT0VYRUMiLGVbZS5FTk9MQ0s9NDZdPSJFTk9MQ0siLGVbZS5FTk9MSU5LPTQ3XT0iRU5PTElOSyIsZVtlLkVOT01FTT00OF09IkVOT01FTSIsZVtlLkVOT01TRz00OV09IkVOT01TRyIsZVtlLkVOT1BST1RPT1BUPTUwXT0iRU5PUFJPVE9PUFQiLGVbZS5FTk9TUEM9NTFdPSJFTk9TUEMiLGVbZS5FTk9TWVM9NTJdPSJFTk9TWVMiLGVbZS5FTk9UQ09OTj01M109IkVOT1RDT05OIixlW2UuRU5PVERJUj01NF09IkVOT1RESVIiLGVbZS5FTk9URU1QVFk9NTVdPSJFTk9URU1QVFkiLGVbZS5FTk9UUkVDT1ZFUkFCTEU9NTZdPSJFTk9UUkVDT1ZFUkFCTEUiLGVbZS5FTk9UU09DSz01N109IkVOT1RTT0NLIixlW2UuRU5PVFNVUD01OF09IkVOT1RTVVAiLGVbZS5FTk9UVFk9NTldPSJFTk9UVFkiLGVbZS5FTlhJTz02MF09IkVOWElPIixlW2UuRU9WRVJGTE9XPTYxXT0iRU9WRVJGTE9XIixlW2UuRU9XTkVSREVBRD02Ml09IkVPV05FUkRFQUQiLGVbZS5FUEVSTT02M109IkVQRVJNIixlW2UuRVBJUEU9NjRdPSJFUElQRSIsZVtlLkVQUk9UTz02NV09IkVQUk9UTyIsZVtlLkVQUk9UT05PU1VQUE9SVD02Nl09IkVQUk9UT05PU1VQUE9SVCIsZVtlLkVQUk9UT1RZUEU9NjddPSJFUFJPVE9UWVBFIixlW2UuRVJBTkdFPTY4XT0iRVJBTkdFIixlW2UuRVJPRlM9NjldPSJFUk9GUyIsZVtlLkVTUElQRT03MF09IkVTUElQRSIsZVtlLkVTUkNIPTcxXT0iRVNSQ0giLGVbZS5FU1RBTEU9NzJdPSJFU1RBTEUiLGVbZS5FVElNRURPVVQ9NzNdPSJFVElNRURPVVQiLGVbZS5FVFhUQlNZPTc0XT0iRVRYVEJTWSIsZVtlLkVYREVWPTc1XT0iRVhERVYiLGVbZS5FTk9UQ0FQQUJMRT03Nl09IkVOT1RDQVBBQkxFIixlKSkocnx8e30pLFQ9KGU9PihlW2UuUkVBTFRJTUU9MF09IlJFQUxUSU1FIixlW2UuTU9OT1RPTklDPTFdPSJNT05PVE9OSUMiLGVbZS5QUk9DRVNTX0NQVVRJTUVfSUQ9Ml09IlBST0NFU1NfQ1BVVElNRV9JRCIsZVtlLlRIUkVBRF9DUFVUSU1FX0lEPTNdPSJUSFJFQURfQ1BVVElNRV9JRCIsZSkpKFR8fHt9KSxEPShlPT4oZVtlLlNFVD0wXT0iU0VUIixlW2UuQ1VSPTFdPSJDVVIiLGVbZS5FTkQ9Ml09IkVORCIsZSkpKER8fHt9KSxBPShlPT4oZVtlLlVOS05PV049MF09IlVOS05PV04iLGVbZS5CTE9DS19ERVZJQ0U9MV09IkJMT0NLX0RFVklDRSIsZVtlLkNIQVJBQ1RFUl9ERVZJQ0U9Ml09IkNIQVJBQ1RFUl9ERVZJQ0UiLGVbZS5ESVJFQ1RPUlk9M109IkRJUkVDVE9SWSIsZVtlLlJFR1VMQVJfRklMRT00XT0iUkVHVUxBUl9GSUxFIixlW2UuU09DS0VUX0RHUkFNPTVdPSJTT0NLRVRfREdSQU0iLGVbZS5TT0NLRVRfU1RSRUFNPTZdPSJTT0NLRVRfU1RSRUFNIixlW2UuU1lNQk9MSUNfTElOSz03XT0iU1lNQk9MSUNfTElOSyIsZSkpKEF8fHt9KSxHPShlPT4oZVtlLkRJUj0wXT0iRElSIixlKSkoR3x8e30pLGI9KGU9PihlW2UuQ0xPQ0s9MF09IkNMT0NLIixlW2UuRkRfUkVBRD0xXT0iRkRfUkVBRCIsZVtlLkZEX1dSSVRFPTJdPSJGRF9XUklURSIsZSkpKGJ8fHt9KTtjb25zdCBOPXtDUkVBVDoxLERJUkVDVE9SWToyLEVYQ0w6NCxUUlVOQzo4fSxPPXtBUFBFTkQ6MSxEU1lOQzoyLE5PTkJMT0NLOjQsUlNZTkM6OCxTWU5DOjE2fSxfPXtGRF9EQVRBU1lOQzpCaWdJbnQoMSk8PEJpZ0ludCgwKSxGRF9SRUFEOkJpZ0ludCgxKTw8QmlnSW50KDEpLEZEX1NFRUs6QmlnSW50KDEpPDxCaWdJbnQoMiksRkRfRkRTVEFUX1NFVF9GTEFHUzpCaWdJbnQoMSk8PEJpZ0ludCgzKSxGRF9TWU5DOkJpZ0ludCgxKTw8QmlnSW50KDQpLEZEX1RFTEw6QmlnSW50KDEpPDxCaWdJbnQoNSksRkRfV1JJVEU6QmlnSW50KDEpPDxCaWdJbnQoNiksRkRfQURWSVNFOkJpZ0ludCgxKTw8QmlnSW50KDcpLEZEX0FMTE9DQVRFOkJpZ0ludCgxKTw8QmlnSW50KDgpLFBBVEhfQ1JFQVRFX0RJUkVDVE9SWTpCaWdJbnQoMSk8PEJpZ0ludCg5KSxQQVRIX0NSRUFURV9GSUxFOkJpZ0ludCgxKTw8QmlnSW50KDEwKSxQQVRIX0xJTktfU09VUkNFOkJpZ0ludCgxKTw8QmlnSW50KDExKSxQQVRIX0xJTktfVEFSR0VUOkJpZ0ludCgxKTw8QmlnSW50KDEyKSxQQVRIX09QRU46QmlnSW50KDEpPDxCaWdJbnQoMTMpLEZEX1JFQURESVI6QmlnSW50KDEpPDxCaWdJbnQoMTQpLFBBVEhfUkVBRExJTks6QmlnSW50KDEpPDxCaWdJbnQoMTUpLFBBVEhfUkVOQU1FX1NPVVJDRTpCaWdJbnQoMSk8PEJpZ0ludCgxNiksUEFUSF9SRU5BTUVfVEFSR0VUOkJpZ0ludCgxKTw8QmlnSW50KDE3KSxQQVRIX0ZJTEVTVEFUX0dFVDpCaWdJbnQoMSk8PEJpZ0ludCgxOCksUEFUSF9GSUxFU1RBVF9TRVRfU0laRTpCaWdJbnQoMSk8PEJpZ0ludCgxOSksUEFUSF9GSUxFU1RBVF9TRVRfVElNRVM6QmlnSW50KDEpPDxCaWdJbnQoMjApLEZEX0ZJTEVTVEFUX0dFVDpCaWdJbnQoMSk8PEJpZ0ludCgyMSksRkRfRklMRVNUQVRfU0VUX1NJWkU6QmlnSW50KDEpPDxCaWdJbnQoMjIpLEZEX0ZJTEVTVEFUX1NFVF9USU1FUzpCaWdJbnQoMSk8PEJpZ0ludCgyMyksUEFUSF9TWU1MSU5LOkJpZ0ludCgxKTw8QmlnSW50KDI0KSxQQVRIX1JFTU9WRV9ESVJFQ1RPUlk6QmlnSW50KDEpPDxCaWdJbnQoMjUpLFBBVEhfVU5MSU5LX0ZJTEU6QmlnSW50KDEpPDxCaWdJbnQoMjYpLFBPTExfRkRfUkVBRFdSSVRFOkJpZ0ludCgxKTw8QmlnSW50KDI3KSxTT0NLX1NIVVRET1dOOkJpZ0ludCgxKTw8QmlnSW50KDI4KSxTT0NLX0FDQ0VQVDpCaWdJbnQoMSk8PEJpZ0ludCgyOSl9LG09e0FUSU06MSxBVElNX05PVzoyLE1USU06NCxNVElNX05PVzo4fSxxPXtTVUJTQ1JJUFRJT05fQ0xPQ0tfQUJTVElNRToxfSxXPTY0LHo9NDgsJD0zMjt2YXIgTT0oZT0+KGVbZS5DVVI9MF09IkNVUiIsZVtlLkVORD0xXT0iRU5EIixlW2UuU0VUPTJdPSJTRVQiLGUpKShNfHx7fSk7Y2xhc3MgdHR7Y29uc3RydWN0b3IodCl7ZCh0aGlzLCJmcyIpO2QodGhpcywibmV4dEZEIiwxMCk7ZCh0aGlzLCJvcGVuTWFwIixuZXcgTWFwKTt0aGlzLmZzPXsuLi50fSx0aGlzLm9wZW5NYXAuc2V0KDMsbmV3IHUodGhpcy5mcywiLyIpKX1vcGVuRmlsZSh0LGksbil7Y29uc3Qgcz1uZXcgSSh0LG4pO2kmJihzLmJ1ZmZlcj1uZXcgVWludDhBcnJheShuZXcgQXJyYXlCdWZmZXIoMTAyNCksMCwwKSk7Y29uc3QgYT10aGlzLm5leHRGRDtyZXR1cm4gdGhpcy5vcGVuTWFwLnNldChhLHMpLHRoaXMubmV4dEZEKyssW3IuU1VDQ0VTUyxhXX1vcGVuRGlyKHQsaSl7Y29uc3Qgbj1uZXcgdSh0LGkpLHM9dGhpcy5uZXh0RkQ7cmV0dXJuIHRoaXMub3Blbk1hcC5zZXQocyxuKSx0aGlzLm5leHRGRCsrLFtyLlNVQ0NFU1Msc119aGFzRGlyKHQsaSl7cmV0dXJuIGk9PT0iLiI/ITA6dC5jb250YWluc0RpcmVjdG9yeShpKX1vcGVuKHQsaSxuLHMpe2NvbnN0IGE9ISEobiZOLkNSRUFUKSxmPSEhKG4mTi5ESVJFQ1RPUlkpLGM9ISEobiZOLkVYQ0wpLG89ISEobiZOLlRSVU5DKSxFPXRoaXMub3Blbk1hcC5nZXQodCk7aWYoIShFIGluc3RhbmNlb2YgdSkpcmV0dXJuW3IuRUJBREZdO2lmKEUuY29udGFpbnNGaWxlKGkpKXJldHVybiBmP1tyLkVOT1RESVJdOmM/W3IuRUVYSVNUXTp0aGlzLm9wZW5GaWxlKEUuZ2V0KGkpLG8scyk7aWYodGhpcy5oYXNEaXIoRSxpKSl7aWYoaT09PSIuIilyZXR1cm4gdGhpcy5vcGVuRGlyKHRoaXMuZnMsIi8iKTtjb25zdCBoPWAvJHtpfS9gLFM9T2JqZWN0LmVudHJpZXModGhpcy5mcykuZmlsdGVyKChbZ10pPT5nLnN0YXJ0c1dpdGgoaCkpO3JldHVybiB0aGlzLm9wZW5EaXIoT2JqZWN0LmZyb21FbnRyaWVzKFMpLGgpfWVsc2V7aWYoYSl7Y29uc3QgaD1FLmZ1bGxQYXRoKGkpO3JldHVybiB0aGlzLmZzW2hdPXtwYXRoOmgsbW9kZToiYmluYXJ5Iixjb250ZW50Om5ldyBVaW50OEFycmF5LHRpbWVzdGFtcHM6e2FjY2VzczpuZXcgRGF0ZSxtb2RpZmljYXRpb246bmV3IERhdGUsY2hhbmdlOm5ldyBEYXRlfX0sdGhpcy5vcGVuRmlsZSh0aGlzLmZzW2hdLG8scyl9cmV0dXJuW3IuRU5PVENBUEFCTEVdfX1jbG9zZSh0KXtpZighdGhpcy5vcGVuTWFwLmhhcyh0KSlyZXR1cm4gci5FQkFERjtjb25zdCBpPXRoaXMub3Blbk1hcC5nZXQodCk7cmV0dXJuIGkgaW5zdGFuY2VvZiBJJiZpLnN5bmMoKSx0aGlzLm9wZW5NYXAuZGVsZXRlKHQpLHIuU1VDQ0VTU31yZWFkKHQsaSl7Y29uc3Qgbj10aGlzLm9wZW5NYXAuZ2V0KHQpO3JldHVybiFufHxuIGluc3RhbmNlb2YgdT9bci5FQkFERl06W3IuU1VDQ0VTUyxuLnJlYWQoaSldfXByZWFkKHQsaSxuKXtjb25zdCBzPXRoaXMub3Blbk1hcC5nZXQodCk7cmV0dXJuIXN8fHMgaW5zdGFuY2VvZiB1P1tyLkVCQURGXTpbci5TVUNDRVNTLHMucHJlYWQoaSxuKV19d3JpdGUodCxpKXtjb25zdCBuPXRoaXMub3Blbk1hcC5nZXQodCk7cmV0dXJuIW58fG4gaW5zdGFuY2VvZiB1P3IuRUJBREY6KG4ud3JpdGUoaSksci5TVUNDRVNTKX1wd3JpdGUodCxpLG4pe2NvbnN0IHM9dGhpcy5vcGVuTWFwLmdldCh0KTtyZXR1cm4hc3x8cyBpbnN0YW5jZW9mIHU/ci5FQkFERjoocy5wd3JpdGUoaSxuKSxyLlNVQ0NFU1MpfXN5bmModCl7Y29uc3QgaT10aGlzLm9wZW5NYXAuZ2V0KHQpO3JldHVybiFpfHxpIGluc3RhbmNlb2YgdT9yLkVCQURGOihpLnN5bmMoKSxyLlNVQ0NFU1MpfXNlZWsodCxpLG4pe2NvbnN0IHM9dGhpcy5vcGVuTWFwLmdldCh0KTtyZXR1cm4hc3x8cyBpbnN0YW5jZW9mIHU/W3IuRUJBREZdOltyLlNVQ0NFU1Mscy5zZWVrKGksbildfXRlbGwodCl7Y29uc3QgaT10aGlzLm9wZW5NYXAuZ2V0KHQpO3JldHVybiFpfHxpIGluc3RhbmNlb2YgdT9bci5FQkFERl06W3IuU1VDQ0VTUyxpLnRlbGwoKV19cmVudW1iZXIodCxpKXtyZXR1cm4hdGhpcy5leGlzdHModCl8fCF0aGlzLmV4aXN0cyhpKT9yLkVCQURGOih0PT09aXx8KHRoaXMuY2xvc2UoaSksdGhpcy5vcGVuTWFwLnNldChpLHRoaXMub3Blbk1hcC5nZXQodCkpKSxyLlNVQ0NFU1MpfXVubGluayh0LGkpe2NvbnN0IG49dGhpcy5vcGVuTWFwLmdldCh0KTtpZighKG4gaW5zdGFuY2VvZiB1KSlyZXR1cm4gci5FQkFERjtpZighbi5jb250YWlucyhpKSlyZXR1cm4gci5FTk9FTlQ7Zm9yKGNvbnN0IHMgb2YgT2JqZWN0LmtleXModGhpcy5mcykpKHM9PT1uLmZ1bGxQYXRoKGkpfHxzLnN0YXJ0c1dpdGgoYCR7bi5mdWxsUGF0aChpKX0vYCkpJiZkZWxldGUgdGhpcy5mc1tzXTtyZXR1cm4gci5TVUNDRVNTfXJlbmFtZSh0LGksbixzKXtjb25zdCBhPXRoaXMub3Blbk1hcC5nZXQodCksZj10aGlzLm9wZW5NYXAuZ2V0KG4pO2lmKCEoYSBpbnN0YW5jZW9mIHUpfHwhKGYgaW5zdGFuY2VvZiB1KSlyZXR1cm4gci5FQkFERjtpZighYS5jb250YWlucyhpKSlyZXR1cm4gci5FTk9FTlQ7aWYoZi5jb250YWlucyhzKSlyZXR1cm4gci5FRVhJU1Q7Y29uc3QgYz1hLmZ1bGxQYXRoKGkpLG89Zi5mdWxsUGF0aChzKTtmb3IoY29uc3QgRSBvZiBPYmplY3Qua2V5cyh0aGlzLmZzKSlpZihFLnN0YXJ0c1dpdGgoYykpe2NvbnN0IGg9RS5yZXBsYWNlKGMsbyk7dGhpcy5mc1toXT10aGlzLmZzW0VdLHRoaXMuZnNbaF0ucGF0aD1oLGRlbGV0ZSB0aGlzLmZzW0VdfXJldHVybiByLlNVQ0NFU1N9bGlzdCh0KXtjb25zdCBpPXRoaXMub3Blbk1hcC5nZXQodCk7cmV0dXJuIGkgaW5zdGFuY2VvZiB1P1tyLlNVQ0NFU1MsaS5saXN0KCldOltyLkVCQURGXX1zdGF0KHQpe2NvbnN0IGk9dGhpcy5vcGVuTWFwLmdldCh0KTtyZXR1cm4gaSBpbnN0YW5jZW9mIEk/W3IuU1VDQ0VTUyxpLnN0YXQoKV06W3IuRUJBREZdfXBhdGhTdGF0KHQsaSl7Y29uc3Qgbj10aGlzLm9wZW5NYXAuZ2V0KHQpO2lmKCEobiBpbnN0YW5jZW9mIHUpKXJldHVybltyLkVCQURGXTtpZihuLmNvbnRhaW5zRmlsZShpKSl7Y29uc3Qgcz1uLmZ1bGxQYXRoKGkpLGE9bmV3IEkodGhpcy5mc1tzXSwwKS5zdGF0KCk7cmV0dXJuW3IuU1VDQ0VTUyxhXX1lbHNlIGlmKHRoaXMuaGFzRGlyKG4saSkpe2lmKGk9PT0iLiIpcmV0dXJuW3IuU1VDQ0VTUyxuZXcgdSh0aGlzLmZzLCIvIikuc3RhdCgpXTtjb25zdCBzPWAvJHtpfS9gLGE9T2JqZWN0LmVudHJpZXModGhpcy5mcykuZmlsdGVyKChbY10pPT5jLnN0YXJ0c1dpdGgocykpLGY9bmV3IHUoT2JqZWN0LmZyb21FbnRyaWVzKGEpLHMpLnN0YXQoKTtyZXR1cm5bci5TVUNDRVNTLGZdfWVsc2UgcmV0dXJuW3IuRU5PVENBUEFCTEVdfXNldEZsYWdzKHQsaSl7Y29uc3Qgbj10aGlzLm9wZW5NYXAuZ2V0KHQpO3JldHVybiBuIGluc3RhbmNlb2YgST8obi5zZXRGbGFncyhpKSxyLlNVQ0NFU1MpOnIuRUJBREZ9c2V0U2l6ZSh0LGkpe2NvbnN0IG49dGhpcy5vcGVuTWFwLmdldCh0KTtyZXR1cm4gbiBpbnN0YW5jZW9mIEk/KG4uc2V0U2l6ZShOdW1iZXIoaSkpLHIuU1VDQ0VTUyk6ci5FQkFERn1zZXRBY2Nlc3NUaW1lKHQsaSl7Y29uc3Qgbj10aGlzLm9wZW5NYXAuZ2V0KHQpO3JldHVybiBuIGluc3RhbmNlb2YgST8obi5zZXRBY2Nlc3NUaW1lKGkpLHIuU1VDQ0VTUyk6ci5FQkFERn1zZXRNb2RpZmljYXRpb25UaW1lKHQsaSl7Y29uc3Qgbj10aGlzLm9wZW5NYXAuZ2V0KHQpO3JldHVybiBuIGluc3RhbmNlb2YgST8obi5zZXRNb2RpZmljYXRpb25UaW1lKGkpLHIuU1VDQ0VTUyk6ci5FQkFERn1wYXRoU2V0QWNjZXNzVGltZSh0LGksbil7Y29uc3Qgcz10aGlzLm9wZW5NYXAuZ2V0KHQpO2lmKCEocyBpbnN0YW5jZW9mIHUpKXJldHVybiByLkVCQURGO2NvbnN0IGE9cy5nZXQoaSk7aWYoIWEpcmV0dXJuIHIuRU5PVENBUEFCTEU7Y29uc3QgZj1uZXcgSShhLDApO3JldHVybiBmLnNldEFjY2Vzc1RpbWUobiksZi5zeW5jKCksci5TVUNDRVNTfXBhdGhTZXRNb2RpZmljYXRpb25UaW1lKHQsaSxuKXtjb25zdCBzPXRoaXMub3Blbk1hcC5nZXQodCk7aWYoIShzIGluc3RhbmNlb2YgdSkpcmV0dXJuIHIuRUJBREY7Y29uc3QgYT1zLmdldChpKTtpZighYSlyZXR1cm4gci5FTk9UQ0FQQUJMRTtjb25zdCBmPW5ldyBJKGEsMCk7cmV0dXJuIGYuc2V0TW9kaWZpY2F0aW9uVGltZShuKSxmLnN5bmMoKSxyLlNVQ0NFU1N9cGF0aENyZWF0ZURpcih0LGkpe2NvbnN0IG49dGhpcy5vcGVuTWFwLmdldCh0KTtpZighKG4gaW5zdGFuY2VvZiB1KSlyZXR1cm4gci5FQkFERjtpZihuLmNvbnRhaW5zKGkpKXJldHVybiByLkVOT1RDQVBBQkxFO2NvbnN0IHM9YCR7bi5mdWxsUGF0aChpKX0vLnJ1bm5vYDtyZXR1cm4gdGhpcy5mc1tzXT17cGF0aDpzLHRpbWVzdGFtcHM6e2FjY2VzczpuZXcgRGF0ZSxtb2RpZmljYXRpb246bmV3IERhdGUsY2hhbmdlOm5ldyBEYXRlfSxtb2RlOiJzdHJpbmciLGNvbnRlbnQ6IiJ9LHIuU1VDQ0VTU31leGlzdHModCl7cmV0dXJuIHRoaXMub3Blbk1hcC5oYXModCl9ZmlsZVR5cGUodCl7Y29uc3QgaT10aGlzLm9wZW5NYXAuZ2V0KHQpO3JldHVybiBpP2kgaW5zdGFuY2VvZiBJP0EuUkVHVUxBUl9GSUxFOkEuRElSRUNUT1JZOkEuVU5LTk9XTn1maWxlRmRmbGFncyh0KXtjb25zdCBpPXRoaXMub3Blbk1hcC5nZXQodCk7cmV0dXJuIGkgaW5zdGFuY2VvZiBJP2kuZmRmbGFnczowfX1jbGFzcyBJe2NvbnN0cnVjdG9yKHQsaSl7ZCh0aGlzLCJmaWxlIik7ZCh0aGlzLCJidWZmZXIiKTtkKHRoaXMsIl9vZmZzZXQiLEJpZ0ludCgwKSk7ZCh0aGlzLCJpc0RpcnR5IiwhMSk7ZCh0aGlzLCJmZGZsYWdzIik7ZCh0aGlzLCJmbGFnQXBwZW5kIik7ZCh0aGlzLCJmbGFnRFN5bmMiKTtkKHRoaXMsImZsYWdOb25CbG9jayIpO2QodGhpcywiZmxhZ1JTeW5jIik7ZCh0aGlzLCJmbGFnU3luYyIpO2lmKHRoaXMuZmlsZT10LHRoaXMuZmlsZS5tb2RlPT09InN0cmluZyIpe2NvbnN0IG49bmV3IFRleHRFbmNvZGVyO3RoaXMuYnVmZmVyPW4uZW5jb2RlKHRoaXMuZmlsZS5jb250ZW50KX1lbHNlIHRoaXMuYnVmZmVyPXRoaXMuZmlsZS5jb250ZW50O3RoaXMuZmRmbGFncz1pLHRoaXMuZmxhZ0FwcGVuZD0hIShpJk8uQVBQRU5EKSx0aGlzLmZsYWdEU3luYz0hIShpJk8uRFNZTkMpLHRoaXMuZmxhZ05vbkJsb2NrPSEhKGkmTy5OT05CTE9DSyksdGhpcy5mbGFnUlN5bmM9ISEoaSZPLlJTWU5DKSx0aGlzLmZsYWdTeW5jPSEhKGkmTy5TWU5DKX1nZXQgb2Zmc2V0KCl7cmV0dXJuIE51bWJlcih0aGlzLl9vZmZzZXQpfXJlYWQodCl7Y29uc3QgaT10aGlzLmJ1ZmZlci5zdWJhcnJheSh0aGlzLm9mZnNldCx0aGlzLm9mZnNldCt0KTtyZXR1cm4gdGhpcy5fb2Zmc2V0Kz1CaWdJbnQoaS5sZW5ndGgpLGl9cHJlYWQodCxpKXtyZXR1cm4gdGhpcy5idWZmZXIuc3ViYXJyYXkoaSxpK3QpfXdyaXRlKHQpe2lmKHRoaXMuaXNEaXJ0eT0hMCx0aGlzLmZsYWdBcHBlbmQpe2NvbnN0IGk9dGhpcy5idWZmZXIubGVuZ3RoO3RoaXMucmVzaXplKGkrdC5ieXRlTGVuZ3RoKSx0aGlzLmJ1ZmZlci5zZXQodCxpKX1lbHNle2NvbnN0IGk9TWF0aC5tYXgodGhpcy5vZmZzZXQrdC5ieXRlTGVuZ3RoLHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGgpO3RoaXMucmVzaXplKGkpLHRoaXMuYnVmZmVyLnNldCh0LHRoaXMub2Zmc2V0KSx0aGlzLl9vZmZzZXQrPUJpZ0ludCh0LmJ5dGVMZW5ndGgpfSh0aGlzLmZsYWdEU3luY3x8dGhpcy5mbGFnU3luYykmJnRoaXMuc3luYygpfXB3cml0ZSh0LGkpe2lmKHRoaXMuaXNEaXJ0eT0hMCx0aGlzLmZsYWdBcHBlbmQpe2NvbnN0IG49dGhpcy5idWZmZXIubGVuZ3RoO3RoaXMucmVzaXplKG4rdC5ieXRlTGVuZ3RoKSx0aGlzLmJ1ZmZlci5zZXQodCxuKX1lbHNle2NvbnN0IG49TWF0aC5tYXgoaSt0LmJ5dGVMZW5ndGgsdGhpcy5idWZmZXIuYnl0ZUxlbmd0aCk7dGhpcy5yZXNpemUobiksdGhpcy5idWZmZXIuc2V0KHQsaSl9KHRoaXMuZmxhZ0RTeW5jfHx0aGlzLmZsYWdTeW5jKSYmdGhpcy5zeW5jKCl9c3luYygpe2lmKCF0aGlzLmlzRGlydHkpcmV0dXJuO2lmKHRoaXMuaXNEaXJ0eT0hMSx0aGlzLmZpbGUubW9kZT09PSJiaW5hcnkiKXt0aGlzLmZpbGUuY29udGVudD1uZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlcik7cmV0dXJufWNvbnN0IHQ9bmV3IFRleHREZWNvZGVyO3RoaXMuZmlsZS5jb250ZW50PXQuZGVjb2RlKHRoaXMuYnVmZmVyKX1zZWVrKHQsaSl7c3dpdGNoKGkpe2Nhc2UgRC5TRVQ6dGhpcy5fb2Zmc2V0PXQ7YnJlYWs7Y2FzZSBELkNVUjp0aGlzLl9vZmZzZXQrPXQ7YnJlYWs7Y2FzZSBELkVORDp0aGlzLl9vZmZzZXQ9QmlnSW50KHRoaXMuYnVmZmVyLmxlbmd0aCkrdDticmVha31yZXR1cm4gdGhpcy5fb2Zmc2V0fXRlbGwoKXtyZXR1cm4gdGhpcy5fb2Zmc2V0fXN0YXQoKXtyZXR1cm57cGF0aDp0aGlzLmZpbGUucGF0aCx0aW1lc3RhbXBzOnRoaXMuZmlsZS50aW1lc3RhbXBzLHR5cGU6QS5SRUdVTEFSX0ZJTEUsYnl0ZUxlbmd0aDp0aGlzLmJ1ZmZlci5sZW5ndGh9fXNldEZsYWdzKHQpe3RoaXMuZmRmbGFncz10fXNldFNpemUodCl7dGhpcy5yZXNpemUodCl9c2V0QWNjZXNzVGltZSh0KXt0aGlzLmZpbGUudGltZXN0YW1wcy5hY2Nlc3M9dH1zZXRNb2RpZmljYXRpb25UaW1lKHQpe3RoaXMuZmlsZS50aW1lc3RhbXBzLm1vZGlmaWNhdGlvbj10fXJlc2l6ZSh0KXtpZih0PD10aGlzLmJ1ZmZlci5idWZmZXIuYnl0ZUxlbmd0aCl7dGhpcy5idWZmZXI9bmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIuYnVmZmVyLDAsdCk7cmV0dXJufWxldCBpO3RoaXMuYnVmZmVyLmJ1ZmZlci5ieXRlTGVuZ3RoPT09MD9pPW5ldyBBcnJheUJ1ZmZlcih0PDEwMjQ/MTAyNDp0KjIpOnQ+dGhpcy5idWZmZXIuYnVmZmVyLmJ5dGVMZW5ndGgqMj9pPW5ldyBBcnJheUJ1ZmZlcih0KjIpOmk9bmV3IEFycmF5QnVmZmVyKHRoaXMuYnVmZmVyLmJ1ZmZlci5ieXRlTGVuZ3RoKjIpO2NvbnN0IG49bmV3IFVpbnQ4QXJyYXkoaSwwLHQpO24uc2V0KHRoaXMuYnVmZmVyKSx0aGlzLmJ1ZmZlcj1ufX1mdW5jdGlvbiBQKGUsdCl7Y29uc3QgaT10LnJlcGxhY2UoL1svXC1cXF4kKis/LigpfFtcXXt9XS9nLCJcXCQmIiksbj1uZXcgUmVnRXhwKGBeJHtpfWApO3JldHVybiBlLnJlcGxhY2UobiwiIil9Y2xhc3MgdXtjb25zdHJ1Y3Rvcih0LGkpe2QodGhpcywiZGlyIik7ZCh0aGlzLCJwcmVmaXgiKTt0aGlzLmRpcj10LHRoaXMucHJlZml4PWl9Y29udGFpbnNGaWxlKHQpe2Zvcihjb25zdCBpIG9mIE9iamVjdC5rZXlzKHRoaXMuZGlyKSlpZihQKGksdGhpcy5wcmVmaXgpPT09dClyZXR1cm4hMDtyZXR1cm4hMX1jb250YWluc0RpcmVjdG9yeSh0KXtmb3IoY29uc3QgaSBvZiBPYmplY3Qua2V5cyh0aGlzLmRpcikpaWYoUChpLHRoaXMucHJlZml4KS5zdGFydHNXaXRoKGAke3R9L2ApKXJldHVybiEwO3JldHVybiExfWNvbnRhaW5zKHQpe2Zvcihjb25zdCBpIG9mIE9iamVjdC5rZXlzKHRoaXMuZGlyKSl7Y29uc3Qgbj1QKGksdGhpcy5wcmVmaXgpO2lmKG49PT10fHxuLnN0YXJ0c1dpdGgoYCR7dH0vYCkpcmV0dXJuITB9cmV0dXJuITF9Z2V0KHQpe3JldHVybiB0aGlzLmRpclt0aGlzLmZ1bGxQYXRoKHQpXX1mdWxsUGF0aCh0KXtyZXR1cm5gJHt0aGlzLnByZWZpeH0ke3R9YH1saXN0KCl7Y29uc3QgdD1bXSxpPW5ldyBTZXQ7Zm9yKGNvbnN0IG4gb2YgT2JqZWN0LmtleXModGhpcy5kaXIpKXtjb25zdCBzPVAobix0aGlzLnByZWZpeCk7aWYocy5pbmNsdWRlcygiLyIpKXtjb25zdCBhPXMuc3BsaXQoIi8iKVswXTtpZihpLmhhcyhhKSljb250aW51ZTtpLmFkZChhKSx0LnB1c2goe25hbWU6YSx0eXBlOkEuRElSRUNUT1JZfSl9ZWxzZSB0LnB1c2goe25hbWU6cyx0eXBlOkEuUkVHVUxBUl9GSUxFfSl9cmV0dXJuIHR9c3RhdCgpe3JldHVybntwYXRoOnRoaXMucHJlZml4LHRpbWVzdGFtcHM6e2FjY2VzczpuZXcgRGF0ZSxtb2RpZmljYXRpb246bmV3IERhdGUsY2hhbmdlOm5ldyBEYXRlfSx0eXBlOkEuRElSRUNUT1JZLGJ5dGVMZW5ndGg6MH19fWxldCBrPVtdO2Z1bmN0aW9uIFUoZSl7ay5wdXNoKGUpfWZ1bmN0aW9uIGV0KCl7Y29uc3QgZT1rO3JldHVybiBrPVtdLGV9Y2xhc3MgWXtjb25zdHJ1Y3Rvcih0KXtkKHRoaXMsImluc3RhbmNlIik7ZCh0aGlzLCJtb2R1bGUiKTtkKHRoaXMsIm1lbW9yeSIpO2QodGhpcywiY29udGV4dCIpO2QodGhpcywiZHJpdmUiKTtkKHRoaXMsImluaXRpYWxpemVkIiwhMSk7dGhpcy5jb250ZXh0PXQsdGhpcy5kcml2ZT1uZXcgdHQodC5mcyl9c3RhdGljIGFzeW5jIHN0YXJ0KHQsaSl7Y29uc3Qgbj1uZXcgWShpKSxzPWF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nKHQse3dhc2lfc25hcHNob3RfcHJldmlldzE6bi5nZXRJbXBvcnRzKCJwcmV2aWV3MSIsaS5kZWJ1Zyksd2FzaV91bnN0YWJsZTpuLmdldEltcG9ydHMoInVuc3RhYmxlIixpLmRlYnVnKX0pO3JldHVybiBuLmluaXQocyksbi5zdGFydCgpfWluaXQodCl7dGhpcy5pbnN0YW5jZT10Lmluc3RhbmNlLHRoaXMubW9kdWxlPXQubW9kdWxlLHRoaXMubWVtb3J5PXRoaXMuaW5zdGFuY2UuZXhwb3J0cy5tZW1vcnksdGhpcy5pbml0aWFsaXplZD0hMH1zdGFydCgpe2lmKCF0aGlzLmluaXRpYWxpemVkKXRocm93IG5ldyBFcnJvcigiV0FTSSBtdXN0IGJlIGluaXRpYWxpemVkIHdpdGggaW5pdCh3YXNtKSBmaXJzdCIpO2NvbnN0IHQ9dGhpcy5pbnN0YW5jZS5leHBvcnRzLl9zdGFydDt0cnl7dCgpfWNhdGNoKGkpe2lmKGkgaW5zdGFuY2VvZiBYKXJldHVybntleGl0Q29kZTppLmNvZGUsZnM6dGhpcy5kcml2ZS5mc307aWYoaSBpbnN0YW5jZW9mIFdlYkFzc2VtYmx5LlJ1bnRpbWVFcnJvcilyZXR1cm57ZXhpdENvZGU6MTM0LGZzOnRoaXMuZHJpdmUuZnN9O3Rocm93IGl9cmV0dXJue2V4aXRDb2RlOjAsZnM6dGhpcy5kcml2ZS5mc319Z2V0SW1wb3J0cyh0LGkpe2NvbnN0IG49e2FyZ3NfZ2V0OnRoaXMuYXJnc19nZXQuYmluZCh0aGlzKSxhcmdzX3NpemVzX2dldDp0aGlzLmFyZ3Nfc2l6ZXNfZ2V0LmJpbmQodGhpcyksY2xvY2tfcmVzX2dldDp0aGlzLmNsb2NrX3Jlc19nZXQuYmluZCh0aGlzKSxjbG9ja190aW1lX2dldDp0aGlzLmNsb2NrX3RpbWVfZ2V0LmJpbmQodGhpcyksZW52aXJvbl9nZXQ6dGhpcy5lbnZpcm9uX2dldC5iaW5kKHRoaXMpLGVudmlyb25fc2l6ZXNfZ2V0OnRoaXMuZW52aXJvbl9zaXplc19nZXQuYmluZCh0aGlzKSxwcm9jX2V4aXQ6dGhpcy5wcm9jX2V4aXQuYmluZCh0aGlzKSxyYW5kb21fZ2V0OnRoaXMucmFuZG9tX2dldC5iaW5kKHRoaXMpLHNjaGVkX3lpZWxkOnRoaXMuc2NoZWRfeWllbGQuYmluZCh0aGlzKSxmZF9hZHZpc2U6dGhpcy5mZF9hZHZpc2UuYmluZCh0aGlzKSxmZF9hbGxvY2F0ZTp0aGlzLmZkX2FsbG9jYXRlLmJpbmQodGhpcyksZmRfY2xvc2U6dGhpcy5mZF9jbG9zZS5iaW5kKHRoaXMpLGZkX2RhdGFzeW5jOnRoaXMuZmRfZGF0YXN5bmMuYmluZCh0aGlzKSxmZF9mZHN0YXRfZ2V0OnRoaXMuZmRfZmRzdGF0X2dldC5iaW5kKHRoaXMpLGZkX2Zkc3RhdF9zZXRfZmxhZ3M6dGhpcy5mZF9mZHN0YXRfc2V0X2ZsYWdzLmJpbmQodGhpcyksZmRfZmRzdGF0X3NldF9yaWdodHM6dGhpcy5mZF9mZHN0YXRfc2V0X3JpZ2h0cy5iaW5kKHRoaXMpLGZkX2ZpbGVzdGF0X2dldDp0aGlzLmZkX2ZpbGVzdGF0X2dldC5iaW5kKHRoaXMpLGZkX2ZpbGVzdGF0X3NldF9zaXplOnRoaXMuZmRfZmlsZXN0YXRfc2V0X3NpemUuYmluZCh0aGlzKSxmZF9maWxlc3RhdF9zZXRfdGltZXM6dGhpcy5mZF9maWxlc3RhdF9zZXRfdGltZXMuYmluZCh0aGlzKSxmZF9wcmVhZDp0aGlzLmZkX3ByZWFkLmJpbmQodGhpcyksZmRfcHJlc3RhdF9kaXJfbmFtZTp0aGlzLmZkX3ByZXN0YXRfZGlyX25hbWUuYmluZCh0aGlzKSxmZF9wcmVzdGF0X2dldDp0aGlzLmZkX3ByZXN0YXRfZ2V0LmJpbmQodGhpcyksZmRfcHdyaXRlOnRoaXMuZmRfcHdyaXRlLmJpbmQodGhpcyksZmRfcmVhZDp0aGlzLmZkX3JlYWQuYmluZCh0aGlzKSxmZF9yZWFkZGlyOnRoaXMuZmRfcmVhZGRpci5iaW5kKHRoaXMpLGZkX3JlbnVtYmVyOnRoaXMuZmRfcmVudW1iZXIuYmluZCh0aGlzKSxmZF9zZWVrOnRoaXMuZmRfc2Vlay5iaW5kKHRoaXMpLGZkX3N5bmM6dGhpcy5mZF9zeW5jLmJpbmQodGhpcyksZmRfdGVsbDp0aGlzLmZkX3RlbGwuYmluZCh0aGlzKSxmZF93cml0ZTp0aGlzLmZkX3dyaXRlLmJpbmQodGhpcykscGF0aF9maWxlc3RhdF9nZXQ6dGhpcy5wYXRoX2ZpbGVzdGF0X2dldC5iaW5kKHRoaXMpLHBhdGhfZmlsZXN0YXRfc2V0X3RpbWVzOnRoaXMucGF0aF9maWxlc3RhdF9zZXRfdGltZXMuYmluZCh0aGlzKSxwYXRoX29wZW46dGhpcy5wYXRoX29wZW4uYmluZCh0aGlzKSxwYXRoX3JlbmFtZTp0aGlzLnBhdGhfcmVuYW1lLmJpbmQodGhpcykscGF0aF91bmxpbmtfZmlsZTp0aGlzLnBhdGhfdW5saW5rX2ZpbGUuYmluZCh0aGlzKSxwYXRoX2NyZWF0ZV9kaXJlY3Rvcnk6dGhpcy5wYXRoX2NyZWF0ZV9kaXJlY3RvcnkuYmluZCh0aGlzKSxwYXRoX2xpbms6dGhpcy5wYXRoX2xpbmsuYmluZCh0aGlzKSxwYXRoX3JlYWRsaW5rOnRoaXMucGF0aF9yZWFkbGluay5iaW5kKHRoaXMpLHBhdGhfcmVtb3ZlX2RpcmVjdG9yeTp0aGlzLnBhdGhfcmVtb3ZlX2RpcmVjdG9yeS5iaW5kKHRoaXMpLHBhdGhfc3ltbGluazp0aGlzLnBhdGhfc3ltbGluay5iaW5kKHRoaXMpLHBvbGxfb25lb2ZmOnRoaXMucG9sbF9vbmVvZmYuYmluZCh0aGlzKSxwcm9jX3JhaXNlOnRoaXMucHJvY19yYWlzZS5iaW5kKHRoaXMpLHNvY2tfYWNjZXB0OnRoaXMuc29ja19hY2NlcHQuYmluZCh0aGlzKSxzb2NrX3JlY3Y6dGhpcy5zb2NrX3JlY3YuYmluZCh0aGlzKSxzb2NrX3NlbmQ6dGhpcy5zb2NrX3NlbmQuYmluZCh0aGlzKSxzb2NrX3NodXRkb3duOnRoaXMuc29ja19zaHV0ZG93bi5iaW5kKHRoaXMpLHNvY2tfb3Blbjp0aGlzLnNvY2tfb3Blbi5iaW5kKHRoaXMpLHNvY2tfbGlzdGVuOnRoaXMuc29ja19saXN0ZW4uYmluZCh0aGlzKSxzb2NrX2Nvbm5lY3Q6dGhpcy5zb2NrX2Nvbm5lY3QuYmluZCh0aGlzKSxzb2NrX3NldHNvY2tvcHQ6dGhpcy5zb2NrX3NldHNvY2tvcHQuYmluZCh0aGlzKSxzb2NrX2JpbmQ6dGhpcy5zb2NrX2JpbmQuYmluZCh0aGlzKSxzb2NrX2dldGxvY2FsYWRkcjp0aGlzLnNvY2tfZ2V0bG9jYWxhZGRyLmJpbmQodGhpcyksc29ja19nZXRwZWVyYWRkcjp0aGlzLnNvY2tfZ2V0cGVlcmFkZHIuYmluZCh0aGlzKSxzb2NrX2dldGFkZHJpbmZvOnRoaXMuc29ja19nZXRhZGRyaW5mby5iaW5kKHRoaXMpfTt0PT09InVuc3RhYmxlIiYmKG4ucGF0aF9maWxlc3RhdF9nZXQ9dGhpcy51bnN0YWJsZV9wYXRoX2ZpbGVzdGF0X2dldC5iaW5kKHRoaXMpLG4uZmRfZmlsZXN0YXRfZ2V0PXRoaXMudW5zdGFibGVfZmRfZmlsZXN0YXRfZ2V0LmJpbmQodGhpcyksbi5mZF9zZWVrPXRoaXMudW5zdGFibGVfZmRfc2Vlay5iaW5kKHRoaXMpKTtmb3IoY29uc3RbcyxhXW9mIE9iamVjdC5lbnRyaWVzKG4pKW5bc109ZnVuY3Rpb24oKXtsZXQgZj1hLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtpZihpKXtjb25zdCBjPWV0KCk7Zj1pKHMsWy4uLmFyZ3VtZW50c10sZixjKT8/Zn1yZXR1cm4gZn07cmV0dXJuIG59Z2V0IGVudkFycmF5KCl7cmV0dXJuIE9iamVjdC5lbnRyaWVzKHRoaXMuY29udGV4dC5lbnYpLm1hcCgoW3QsaV0pPT5gJHt0fT0ke2l9YCl9YXJnc19nZXQodCxpKXtjb25zdCBuPW5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpO2Zvcihjb25zdCBzIG9mIHRoaXMuY29udGV4dC5hcmdzKXtuLnNldFVpbnQzMih0LGksITApLHQrPTQ7Y29uc3QgYT1uZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoYCR7c31cMGApO25ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlcixpLGEuYnl0ZUxlbmd0aCkuc2V0KGEpLGkrPWEuYnl0ZUxlbmd0aH1yZXR1cm4gci5TVUNDRVNTfWFyZ3Nfc2l6ZXNfZ2V0KHQsaSl7Y29uc3Qgbj10aGlzLmNvbnRleHQuYXJncyxzPW4ucmVkdWNlKChmLGMpPT5mK25ldyBUZXh0RW5jb2RlcigpLmVuY29kZShgJHtjfVwwYCkuYnl0ZUxlbmd0aCwwKSxhPW5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpO3JldHVybiBhLnNldFVpbnQzMih0LG4ubGVuZ3RoLCEwKSxhLnNldFVpbnQzMihpLHMsITApLHIuU1VDQ0VTU31jbG9ja19yZXNfZ2V0KHQsaSl7c3dpdGNoKHQpe2Nhc2UgVC5SRUFMVElNRTpjYXNlIFQuTU9OT1RPTklDOmNhc2UgVC5QUk9DRVNTX0NQVVRJTUVfSUQ6Y2FzZSBULlRIUkVBRF9DUFVUSU1FX0lEOnJldHVybiBuZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKS5zZXRCaWdVaW50NjQoaSxCaWdJbnQoMWU2KSwhMCksci5TVUNDRVNTfXJldHVybiByLkVJTlZBTH1jbG9ja190aW1lX2dldCh0LGksbil7c3dpdGNoKHQpe2Nhc2UgVC5SRUFMVElNRTpjYXNlIFQuTU9OT1RPTklDOmNhc2UgVC5QUk9DRVNTX0NQVVRJTUVfSUQ6Y2FzZSBULlRIUkVBRF9DUFVUSU1FX0lEOnJldHVybiBuZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKS5zZXRCaWdVaW50NjQobix5KG5ldyBEYXRlKSwhMCksci5TVUNDRVNTfXJldHVybiByLkVJTlZBTH1lbnZpcm9uX2dldCh0LGkpe2NvbnN0IG49bmV3IERhdGFWaWV3KHRoaXMubWVtb3J5LmJ1ZmZlcik7Zm9yKGNvbnN0IHMgb2YgdGhpcy5lbnZBcnJheSl7bi5zZXRVaW50MzIodCxpLCEwKSx0Kz00O2NvbnN0IGE9bmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGAke3N9XDBgKTtuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsaSxhLmJ5dGVMZW5ndGgpLnNldChhKSxpKz1hLmJ5dGVMZW5ndGh9cmV0dXJuIHIuU1VDQ0VTU31lbnZpcm9uX3NpemVzX2dldCh0LGkpe2NvbnN0IG49dGhpcy5lbnZBcnJheS5yZWR1Y2UoKGEsZik9PmErbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGAke2Z9XDBgKS5ieXRlTGVuZ3RoLDApLHM9bmV3IERhdGFWaWV3KHRoaXMubWVtb3J5LmJ1ZmZlcik7cmV0dXJuIHMuc2V0VWludDMyKHQsdGhpcy5lbnZBcnJheS5sZW5ndGgsITApLHMuc2V0VWludDMyKGksbiwhMCksci5TVUNDRVNTfXByb2NfZXhpdCh0KXt0aHJvdyBuZXcgWCh0KX1yYW5kb21fZ2V0KHQsaSl7Y29uc3Qgbj1uZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsdCxpKTtyZXR1cm4gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuKSxyLlNVQ0NFU1N9c2NoZWRfeWllbGQoKXtyZXR1cm4gci5TVUNDRVNTfWZkX3JlYWQodCxpLG4scyl7aWYodD09PTF8fHQ9PT0yKXJldHVybiByLkVOT1RTVVA7Y29uc3QgYT1uZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKSxmPXYoYSxpLG4pLGM9bmV3IFRleHRFbmNvZGVyO2xldCBvPTAsRT1yLlNVQ0NFU1M7Zm9yKGNvbnN0IGggb2YgZil7bGV0IFM7aWYodD09PTApe2NvbnN0IEM9dGhpcy5jb250ZXh0LnN0ZGluKGguYnl0ZUxlbmd0aCk7aWYoIUMpYnJlYWs7Uz1jLmVuY29kZShDKX1lbHNle2NvbnN0W0MsbF09dGhpcy5kcml2ZS5yZWFkKHQsaC5ieXRlTGVuZ3RoKTtpZihDKXtFPUM7YnJlYWt9ZWxzZSBTPWx9Y29uc3QgZz1NYXRoLm1pbihoLmJ5dGVMZW5ndGgsUy5ieXRlTGVuZ3RoKTtoLnNldChTLnN1YmFycmF5KDAsZykpLG8rPWd9cmV0dXJuIFUoe2J5dGVzUmVhZDpvfSksYS5zZXRVaW50MzIocyxvLCEwKSxFfWZkX3dyaXRlKHQsaSxuLHMpe2lmKHQ9PT0wKXJldHVybiByLkVOT1RTVVA7Y29uc3QgYT1uZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKSxmPXYoYSxpLG4pLGM9bmV3IFRleHREZWNvZGVyO2xldCBvPTAsRT1yLlNVQ0NFU1M7Zm9yKGNvbnN0IGggb2YgZilpZihoLmJ5dGVMZW5ndGghPT0wKXtpZih0PT09MXx8dD09PTIpe2NvbnN0IFM9dD09PTE/dGhpcy5jb250ZXh0LnN0ZG91dDp0aGlzLmNvbnRleHQuc3RkZXJyLGc9Yy5kZWNvZGUoaCk7UyhnKSxVKHtvdXRwdXQ6Z30pfWVsc2UgaWYoRT10aGlzLmRyaXZlLndyaXRlKHQsaCksRSE9ci5TVUNDRVNTKWJyZWFrO28rPWguYnl0ZUxlbmd0aH1yZXR1cm4gYS5zZXRVaW50MzIocyxvLCEwKSxFfWZkX2FkdmlzZSgpe3JldHVybiByLlNVQ0NFU1N9ZmRfYWxsb2NhdGUodCxpLG4pe3JldHVybiB0aGlzLmRyaXZlLnB3cml0ZSh0LG5ldyBVaW50OEFycmF5KE51bWJlcihuKSksTnVtYmVyKGkpKX1mZF9jbG9zZSh0KXtyZXR1cm4gdGhpcy5kcml2ZS5jbG9zZSh0KX1mZF9kYXRhc3luYyh0KXtyZXR1cm4gdGhpcy5kcml2ZS5zeW5jKHQpfWZkX2Zkc3RhdF9nZXQodCxpKXtpZih0PDMpe2xldCBjO2lmKHRoaXMuY29udGV4dC5pc1RUWSl7Y29uc3QgRT14Xl8uRkRfU0VFS15fLkZEX1RFTEw7Yz1WKEEuQ0hBUkFDVEVSX0RFVklDRSwwLEUpfWVsc2UgYz1WKEEuQ0hBUkFDVEVSX0RFVklDRSwwKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkodGhpcy5tZW1vcnkuYnVmZmVyLGksYy5ieXRlTGVuZ3RoKS5zZXQoYyksci5TVUNDRVNTfWlmKCF0aGlzLmRyaXZlLmV4aXN0cyh0KSlyZXR1cm4gci5FQkFERjtjb25zdCBuPXRoaXMuZHJpdmUuZmlsZVR5cGUodCkscz10aGlzLmRyaXZlLmZpbGVGZGZsYWdzKHQpLGE9VihuLHMpO3JldHVybiBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsaSxhLmJ5dGVMZW5ndGgpLnNldChhKSxyLlNVQ0NFU1N9ZmRfZmRzdGF0X3NldF9mbGFncyh0LGkpe3JldHVybiB0aGlzLmRyaXZlLnNldEZsYWdzKHQsaSl9ZmRfZmRzdGF0X3NldF9yaWdodHMoKXtyZXR1cm4gci5TVUNDRVNTfWZkX2ZpbGVzdGF0X2dldCh0LGkpe3JldHVybiB0aGlzLnNoYXJlZF9mZF9maWxlc3RhdF9nZXQodCxpLCJwcmV2aWV3MSIpfXVuc3RhYmxlX2ZkX2ZpbGVzdGF0X2dldCh0LGkpe3JldHVybiB0aGlzLnNoYXJlZF9mZF9maWxlc3RhdF9nZXQodCxpLCJ1bnN0YWJsZSIpfXNoYXJlZF9mZF9maWxlc3RhdF9nZXQodCxpLG4pe2NvbnN0IHM9bj09PSJ1bnN0YWJsZSI/WjpqO2lmKHQ8Myl7bGV0IEU7c3dpdGNoKHQpe2Nhc2UgMDpFPSIvZGV2L3N0ZGluIjticmVhaztjYXNlIDE6RT0iL2Rldi9zdGRvdXQiO2JyZWFrO2Nhc2UgMjpFPSIvZGV2L3N0ZGVyciI7YnJlYWs7ZGVmYXVsdDpFPSIvZGV2L3VuZGVmaW5lZCI7YnJlYWt9Y29uc3QgaD1zKHtwYXRoOkUsYnl0ZUxlbmd0aDowLHRpbWVzdGFtcHM6e2FjY2VzczpuZXcgRGF0ZSxtb2RpZmljYXRpb246bmV3IERhdGUsY2hhbmdlOm5ldyBEYXRlfSx0eXBlOkEuQ0hBUkFDVEVSX0RFVklDRX0pO3JldHVybiBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsaSxoLmJ5dGVMZW5ndGgpLnNldChoKSxyLlNVQ0NFU1N9Y29uc3RbYSxmXT10aGlzLmRyaXZlLnN0YXQodCk7aWYoYSE9ci5TVUNDRVNTKXJldHVybiBhO1Uoe3Jlc29sdmVkUGF0aDpmLnBhdGgsc3RhdDpmfSk7Y29uc3QgYz1zKGYpO3JldHVybiBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsaSxjLmJ5dGVMZW5ndGgpLnNldChjKSxyLlNVQ0NFU1N9ZmRfZmlsZXN0YXRfc2V0X3NpemUodCxpKXtyZXR1cm4gdGhpcy5kcml2ZS5zZXRTaXplKHQsaSl9ZmRfZmlsZXN0YXRfc2V0X3RpbWVzKHQsaSxuLHMpe2xldCBhPW51bGw7cyZtLkFUSU0mJihhPXAoaSkpLHMmbS5BVElNX05PVyYmKGE9bmV3IERhdGUpO2xldCBmPW51bGw7aWYocyZtLk1USU0mJihmPXAobikpLHMmbS5NVElNX05PVyYmKGY9bmV3IERhdGUpLGEpe2NvbnN0IGM9dGhpcy5kcml2ZS5zZXRBY2Nlc3NUaW1lKHQsYSk7aWYoYyE9ci5TVUNDRVNTKXJldHVybiBjfWlmKGYpe2NvbnN0IGM9dGhpcy5kcml2ZS5zZXRNb2RpZmljYXRpb25UaW1lKHQsZik7aWYoYyE9ci5TVUNDRVNTKXJldHVybiBjfXJldHVybiByLlNVQ0NFU1N9ZmRfcHJlYWQodCxpLG4scyxhKXtpZih0PT09MXx8dD09PTIpcmV0dXJuIHIuRU5PVFNVUDtpZih0PT09MClyZXR1cm4gdGhpcy5mZF9yZWFkKHQsaSxuLGEpO2NvbnN0IGY9bmV3IERhdGFWaWV3KHRoaXMubWVtb3J5LmJ1ZmZlciksYz12KGYsaSxuKTtsZXQgbz0wLEU9ci5TVUNDRVNTO2Zvcihjb25zdCBoIG9mIGMpe2NvbnN0W1MsZ109dGhpcy5kcml2ZS5wcmVhZCh0LGguYnl0ZUxlbmd0aCxOdW1iZXIocykrbyk7aWYoUyE9PXIuU1VDQ0VTUyl7RT1TO2JyZWFrfWNvbnN0IEM9TWF0aC5taW4oaC5ieXRlTGVuZ3RoLGcuYnl0ZUxlbmd0aCk7aC5zZXQoZy5zdWJhcnJheSgwLEMpKSxvKz1DfXJldHVybiBmLnNldFVpbnQzMihhLG8sITApLEV9ZmRfcHJlc3RhdF9kaXJfbmFtZSh0LGksbil7aWYodCE9PTMpcmV0dXJuIHIuRUJBREY7Y29uc3Qgcz1uZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoIi8iKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkodGhpcy5tZW1vcnkuYnVmZmVyLGksbikuc2V0KHMuc3ViYXJyYXkoMCxuKSksci5TVUNDRVNTfWZkX3ByZXN0YXRfZ2V0KHQsaSl7aWYodCE9PTMpcmV0dXJuIHIuRUJBREY7Y29uc3Qgbj1uZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoIi4iKSxzPW5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIsaSk7cmV0dXJuIHMuc2V0VWludDgoMCxHLkRJUikscy5zZXRVaW50MzIoNCxuLmJ5dGVMZW5ndGgsITApLHIuU1VDQ0VTU31mZF9wd3JpdGUodCxpLG4scyxhKXtpZih0PT09MClyZXR1cm4gci5FTk9UU1VQO2lmKHQ9PT0xfHx0PT09MilyZXR1cm4gdGhpcy5mZF93cml0ZSh0LGksbixhKTtjb25zdCBmPW5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpLGM9dihmLGksbik7bGV0IG89MCxFPXIuU1VDQ0VTUztmb3IoY29uc3QgaCBvZiBjKWlmKGguYnl0ZUxlbmd0aCE9PTApe2lmKEU9dGhpcy5kcml2ZS5wd3JpdGUodCxoLE51bWJlcihzKSksRSE9ci5TVUNDRVNTKWJyZWFrO28rPWguYnl0ZUxlbmd0aH1yZXR1cm4gZi5zZXRVaW50MzIoYSxvLCEwKSxFfWZkX3JlYWRkaXIodCxpLG4scyxhKXtjb25zdFtmLGNdPXRoaXMuZHJpdmUubGlzdCh0KTtpZihmIT1yLlNVQ0NFU1MpcmV0dXJuIGY7bGV0IG89W10sRT0wO2Zvcihjb25zdHtuYW1lOncsdHlwZTpGfW9mIGMpe2NvbnN0IEs9bnQodyxGLEUpO28ucHVzaChLKSxFKyt9bz1vLnNsaWNlKE51bWJlcihzKSk7Y29uc3QgaD1vLnJlZHVjZSgodyxGKT0+dytGLmJ5dGVMZW5ndGgsMCksUz1uZXcgVWludDhBcnJheShoKTtsZXQgZz0wO2Zvcihjb25zdCB3IG9mIG8pUy5zZXQodyxnKSxnKz13LmJ5dGVMZW5ndGg7Y29uc3QgQz1uZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsaSxuKSxsPVMuc3ViYXJyYXkoMCxuKTtyZXR1cm4gQy5zZXQobCksbmV3IERhdGFWaWV3KHRoaXMubWVtb3J5LmJ1ZmZlcikuc2V0VWludDMyKGEsbC5ieXRlTGVuZ3RoLCEwKSxyLlNVQ0NFU1N9ZmRfcmVudW1iZXIodCxpKXtyZXR1cm4gdGhpcy5kcml2ZS5yZW51bWJlcih0LGkpfWZkX3NlZWsodCxpLG4scyl7Y29uc3RbYSxmXT10aGlzLmRyaXZlLnNlZWsodCxpLG4pO3JldHVybiBhIT09ci5TVUNDRVNTfHwoVSh7bmV3T2Zmc2V0OmYudG9TdHJpbmcoKX0pLG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpLnNldEJpZ1VpbnQ2NChzLGYsITApKSxhfXVuc3RhYmxlX2ZkX3NlZWsodCxpLG4scyl7Y29uc3QgYT1zdFtuXTtyZXR1cm4gdGhpcy5mZF9zZWVrKHQsaSxhLHMpfWZkX3N5bmModCl7cmV0dXJuIHRoaXMuZHJpdmUuc3luYyh0KX1mZF90ZWxsKHQsaSl7Y29uc3RbbixzXT10aGlzLmRyaXZlLnRlbGwodCk7cmV0dXJuIG4hPT1yLlNVQ0NFU1N8fG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpLnNldEJpZ1VpbnQ2NChpLHMsITApLG59cGF0aF9maWxlc3RhdF9nZXQodCxpLG4scyxhKXtyZXR1cm4gdGhpcy5zaGFyZWRfcGF0aF9maWxlc3RhdF9nZXQodCxpLG4scyxhLCJwcmV2aWV3MSIpfXVuc3RhYmxlX3BhdGhfZmlsZXN0YXRfZ2V0KHQsaSxuLHMsYSl7cmV0dXJuIHRoaXMuc2hhcmVkX3BhdGhfZmlsZXN0YXRfZ2V0KHQsaSxuLHMsYSwidW5zdGFibGUiKX1zaGFyZWRfcGF0aF9maWxlc3RhdF9nZXQodCxpLG4scyxhLGYpe2NvbnN0IGM9Zj09PSJ1bnN0YWJsZSI/WjpqLG89bmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlcixuLHMpKTtVKHtwYXRoOm99KTtjb25zdFtFLGhdPXRoaXMuZHJpdmUucGF0aFN0YXQodCxvKTtpZihFIT1yLlNVQ0NFU1MpcmV0dXJuIEU7Y29uc3QgUz1jKGgpO3JldHVybiBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsYSxTLmJ5dGVMZW5ndGgpLnNldChTKSxFfXBhdGhfZmlsZXN0YXRfc2V0X3RpbWVzKHQsaSxuLHMsYSxmLGMpe2xldCBvPW51bGw7YyZtLkFUSU0mJihvPXAoYSkpLGMmbS5BVElNX05PVyYmKG89bmV3IERhdGUpO2xldCBFPW51bGw7YyZtLk1USU0mJihFPXAoZikpLGMmbS5NVElNX05PVyYmKEU9bmV3IERhdGUpO2NvbnN0IGg9bmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlcixuLHMpKTtpZihvKXtjb25zdCBTPXRoaXMuZHJpdmUucGF0aFNldEFjY2Vzc1RpbWUodCxoLG8pO2lmKFMhPXIuU1VDQ0VTUylyZXR1cm4gU31pZihFKXtjb25zdCBTPXRoaXMuZHJpdmUucGF0aFNldE1vZGlmaWNhdGlvblRpbWUodCxoLEUpO2lmKFMhPXIuU1VDQ0VTUylyZXR1cm4gU31yZXR1cm4gci5TVUNDRVNTfXBhdGhfb3Blbih0LGksbixzLGEsZixjLG8sRSl7Y29uc3QgaD1uZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKSxTPUIodGhpcy5tZW1vcnksbixzKSxnPSEhKGEmTi5DUkVBVCksQz0hIShhJk4uRElSRUNUT1JZKSxsPSEhKGEmTi5FWENMKSxKPSEhKGEmTi5UUlVOQyksdz0hIShvJk8uQVBQRU5EKSxGPSEhKG8mTy5EU1lOQyksSz0hIShvJk8uTk9OQkxPQ0spLFN0PSEhKG8mTy5SU1lOQyksX3Q9ISEobyZPLlNZTkMpO1Uoe3BhdGg6UyxvcGVuRmxhZ3M6e2NyZWF0ZUZpbGVJZk5vbmU6ZyxmYWlsSWZOb3REaXI6QyxmYWlsSWZGaWxlRXhpc3RzOmwsdHJ1bmNhdGVGaWxlOkp9LGZpbGVEZXNjcmlwdG9yRmxhZ3M6e2ZsYWdBcHBlbmQ6dyxmbGFnRFN5bmM6RixmbGFnTm9uQmxvY2s6SyxmbGFnUlN5bmM6U3QsZmxhZ1N5bmM6X3R9fSk7Y29uc3RbUixkdF09dGhpcy5kcml2ZS5vcGVuKHQsUyxhLG8pO3JldHVybiBSfHwoaC5zZXRVaW50MzIoRSxkdCwhMCksUil9cGF0aF9yZW5hbWUodCxpLG4scyxhLGYpe2NvbnN0IGM9Qih0aGlzLm1lbW9yeSxpLG4pLG89Qih0aGlzLm1lbW9yeSxhLGYpO3JldHVybiBVKHtvbGRQYXRoOmMsbmV3UGF0aDpvfSksdGhpcy5kcml2ZS5yZW5hbWUodCxjLHMsbyl9cGF0aF91bmxpbmtfZmlsZSh0LGksbil7Y29uc3Qgcz1CKHRoaXMubWVtb3J5LGksbik7cmV0dXJuIFUoe3BhdGg6c30pLHRoaXMuZHJpdmUudW5saW5rKHQscyl9cG9sbF9vbmVvZmYodCxpLG4scyl7Zm9yKGxldCBmPTA7ZjxuO2YrKyl7Y29uc3QgYz1uZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsdCtmKnoseiksbz1pdChjKSxFPW5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlcixpK2YqJCwkKTtsZXQgaD0wLFM9ci5TVUNDRVNTO3N3aXRjaChvLnR5cGUpe2Nhc2UgYi5DTE9DSzpmb3IoO25ldyBEYXRlPG8udGltZW91dDspO0Uuc2V0KHJ0KG8udXNlcmRhdGEsci5TVUNDRVNTKSk7YnJlYWs7Y2FzZSBiLkZEX1JFQUQ6aWYoby5mZDwzKW8uZmQ9PT0wPyhTPXIuU1VDQ0VTUyxoPTMyKTpTPXIuRUJBREY7ZWxzZXtjb25zdFtnLENdPXRoaXMuZHJpdmUuc3RhdChvLmZkKTtTPWcsaD1DP0MuYnl0ZUxlbmd0aDowfUUuc2V0KFEoby51c2VyZGF0YSxTLGIuRkRfUkVBRCxCaWdJbnQoaCkpKTticmVhaztjYXNlIGIuRkRfV1JJVEU6aWYoaD0wLFM9ci5TVUNDRVNTLG8uZmQ8MylvLmZkPT09MD9TPXIuRUJBREY6KFM9ci5TVUNDRVNTLGg9MTAyNCk7ZWxzZXtjb25zdFtnLENdPXRoaXMuZHJpdmUuc3RhdChvLmZkKTtTPWcsaD1DP0MuYnl0ZUxlbmd0aDowfUUuc2V0KFEoby51c2VyZGF0YSxTLGIuRkRfUkVBRCxCaWdJbnQoaCkpKTticmVha319cmV0dXJuIG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIscyw0KS5zZXRVaW50MzIoMCxuLCEwKSxyLlNVQ0NFU1N9cGF0aF9jcmVhdGVfZGlyZWN0b3J5KHQsaSxuKXtjb25zdCBzPUIodGhpcy5tZW1vcnksaSxuKTtyZXR1cm4gdGhpcy5kcml2ZS5wYXRoQ3JlYXRlRGlyKHQscyl9cGF0aF9saW5rKCl7cmV0dXJuIHIuRU5PU1lTfXBhdGhfcmVhZGxpbmsoKXtyZXR1cm4gci5FTk9TWVN9cGF0aF9yZW1vdmVfZGlyZWN0b3J5KCl7cmV0dXJuIHIuRU5PU1lTfXBhdGhfc3ltbGluaygpe3JldHVybiByLkVOT1NZU31wcm9jX3JhaXNlKCl7cmV0dXJuIHIuRU5PU1lTfXNvY2tfYWNjZXB0KCl7cmV0dXJuIHIuRU5PU1lTfXNvY2tfcmVjdigpe3JldHVybiByLkVOT1NZU31zb2NrX3NlbmQoKXtyZXR1cm4gci5FTk9TWVN9c29ja19zaHV0ZG93bigpe3JldHVybiByLkVOT1NZU31zb2NrX29wZW4oKXtyZXR1cm4gci5FTk9TWVN9c29ja19saXN0ZW4oKXtyZXR1cm4gci5FTk9TWVN9c29ja19jb25uZWN0KCl7cmV0dXJuIHIuRU5PU1lTfXNvY2tfc2V0c29ja29wdCgpe3JldHVybiByLkVOT1NZU31zb2NrX2JpbmQoKXtyZXR1cm4gci5FTk9TWVN9c29ja19nZXRsb2NhbGFkZHIoKXtyZXR1cm4gci5FTk9TWVN9c29ja19nZXRwZWVyYWRkcigpe3JldHVybiByLkVOT1NZU31zb2NrX2dldGFkZHJpbmZvKCl7cmV0dXJuIHIuRU5PU1lTfX1jb25zdCB4PV8uRkRfREFUQVNZTkN8Xy5GRF9SRUFEfF8uRkRfU0VFS3xfLkZEX0ZEU1RBVF9TRVRfRkxBR1N8Xy5GRF9TWU5DfF8uRkRfVEVMTHxfLkZEX1dSSVRFfF8uRkRfQURWSVNFfF8uRkRfQUxMT0NBVEV8Xy5QQVRIX0NSRUFURV9ESVJFQ1RPUll8Xy5QQVRIX0NSRUFURV9GSUxFfF8uUEFUSF9MSU5LX1NPVVJDRXxfLlBBVEhfTElOS19UQVJHRVR8Xy5QQVRIX09QRU58Xy5GRF9SRUFERElSfF8uUEFUSF9SRUFETElOS3xfLlBBVEhfUkVOQU1FX1NPVVJDRXxfLlBBVEhfUkVOQU1FX1RBUkdFVHxfLlBBVEhfRklMRVNUQVRfR0VUfF8uUEFUSF9GSUxFU1RBVF9TRVRfU0laRXxfLlBBVEhfRklMRVNUQVRfU0VUX1RJTUVTfF8uRkRfRklMRVNUQVRfR0VUfF8uRkRfRklMRVNUQVRfU0VUX1NJWkV8Xy5GRF9GSUxFU1RBVF9TRVRfVElNRVN8Xy5QQVRIX1NZTUxJTkt8Xy5QQVRIX1JFTU9WRV9ESVJFQ1RPUll8Xy5QQVRIX1VOTElOS19GSUxFfF8uUE9MTF9GRF9SRUFEV1JJVEV8Xy5TT0NLX1NIVVRET1dOfF8uU09DS19BQ0NFUFQ7Y2xhc3MgWCBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKGkpe3N1cGVyKCk7ZCh0aGlzLCJjb2RlIik7dGhpcy5jb2RlPWl9fWZ1bmN0aW9uIEIoZSx0LGkpe3JldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoZS5idWZmZXIsdCxpKSl9ZnVuY3Rpb24gdihlLHQsaSl7bGV0IG49QXJyYXkoaSk7Zm9yKGxldCBzPTA7czxpO3MrKyl7Y29uc3QgYT1lLmdldFVpbnQzMih0LCEwKTt0Kz00O2NvbnN0IGY9ZS5nZXRVaW50MzIodCwhMCk7dCs9NCxuW3NdPW5ldyBVaW50OEFycmF5KGUuYnVmZmVyLGEsZil9cmV0dXJuIG59ZnVuY3Rpb24gaXQoZSl7Y29uc3QgdD1uZXcgVWludDhBcnJheSg4KTt0LnNldChlLnN1YmFycmF5KDAsOCkpO2NvbnN0IGk9ZVs4XSxuPW5ldyBEYXRhVmlldyhlLmJ1ZmZlcixlLmJ5dGVPZmZzZXQrOSk7c3dpdGNoKGkpe2Nhc2UgYi5GRF9SRUFEOmNhc2UgYi5GRF9XUklURTpyZXR1cm57dXNlcmRhdGE6dCx0eXBlOmksZmQ6bi5nZXRVaW50MzIoMCwhMCl9O2Nhc2UgYi5DTE9DSzpjb25zdCBzPW4uZ2V0VWludDE2KDI0LCEwKSxhPXkobmV3IERhdGUpLGY9bi5nZXRCaWdVaW50NjQoOCwhMCksYz1uLmdldEJpZ1VpbnQ2NCgxNiwhMCksbz1zJnEuU1VCU0NSSVBUSU9OX0NMT0NLX0FCU1RJTUU/ZjphK2Y7cmV0dXJue3VzZXJkYXRhOnQsdHlwZTppLGlkOm4uZ2V0VWludDMyKDAsITApLHRpbWVvdXQ6cChvKSxwcmVjaXNpb246cChvK2MpfX19ZnVuY3Rpb24gaihlKXtjb25zdCB0PW5ldyBVaW50OEFycmF5KFcpLGk9bmV3IERhdGFWaWV3KHQuYnVmZmVyKTtyZXR1cm4gaS5zZXRCaWdVaW50NjQoMCxCaWdJbnQoMCksITApLGkuc2V0QmlnVWludDY0KDgsQmlnSW50KEgoZS5wYXRoKSksITApLGkuc2V0VWludDgoMTYsZS50eXBlKSxpLnNldEJpZ1VpbnQ2NCgyNCxCaWdJbnQoMSksITApLGkuc2V0QmlnVWludDY0KDMyLEJpZ0ludChlLmJ5dGVMZW5ndGgpLCEwKSxpLnNldEJpZ1VpbnQ2NCg0MCx5KGUudGltZXN0YW1wcy5hY2Nlc3MpLCEwKSxpLnNldEJpZ1VpbnQ2NCg0OCx5KGUudGltZXN0YW1wcy5tb2RpZmljYXRpb24pLCEwKSxpLnNldEJpZ1VpbnQ2NCg1Nix5KGUudGltZXN0YW1wcy5jaGFuZ2UpLCEwKSx0fWZ1bmN0aW9uIFooZSl7Y29uc3QgdD1uZXcgVWludDhBcnJheShXKSxpPW5ldyBEYXRhVmlldyh0LmJ1ZmZlcik7cmV0dXJuIGkuc2V0QmlnVWludDY0KDAsQmlnSW50KDApLCEwKSxpLnNldEJpZ1VpbnQ2NCg4LEJpZ0ludChIKGUucGF0aCkpLCEwKSxpLnNldFVpbnQ4KDE2LGUudHlwZSksaS5zZXRVaW50MzIoMjAsMSwhMCksaS5zZXRCaWdVaW50NjQoMjQsQmlnSW50KGUuYnl0ZUxlbmd0aCksITApLGkuc2V0QmlnVWludDY0KDMyLHkoZS50aW1lc3RhbXBzLmFjY2VzcyksITApLGkuc2V0QmlnVWludDY0KDQwLHkoZS50aW1lc3RhbXBzLm1vZGlmaWNhdGlvbiksITApLGkuc2V0QmlnVWludDY0KDQ4LHkoZS50aW1lc3RhbXBzLmNoYW5nZSksITApLHR9ZnVuY3Rpb24gVihlLHQsaSl7Y29uc3Qgbj1pPz94LHM9aT8/eCxhPW5ldyBVaW50OEFycmF5KDI0KSxmPW5ldyBEYXRhVmlldyhhLmJ1ZmZlciwwLDI0KTtyZXR1cm4gZi5zZXRVaW50OCgwLGUpLGYuc2V0VWludDMyKDIsdCwhMCksZi5zZXRCaWdVaW50NjQoOCxuLCEwKSxmLnNldEJpZ1VpbnQ2NCgxNixzLCEwKSxhfWZ1bmN0aW9uIG50KGUsdCxpKXtjb25zdCBuPW5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShlKSxzPTI0K24uYnl0ZUxlbmd0aCxhPW5ldyBVaW50OEFycmF5KHMpLGY9bmV3IERhdGFWaWV3KGEuYnVmZmVyKTtyZXR1cm4gZi5zZXRCaWdVaW50NjQoMCxCaWdJbnQoaSsxKSwhMCksZi5zZXRCaWdVaW50NjQoOCxCaWdJbnQoSChlKSksITApLGYuc2V0VWludDMyKDE2LG4ubGVuZ3RoLCEwKSxmLnNldFVpbnQ4KDIwLHQpLGEuc2V0KG4sMjQpLGF9ZnVuY3Rpb24gcnQoZSx0KXtjb25zdCBpPW5ldyBVaW50OEFycmF5KDMyKTtpLnNldChlLDApO2NvbnN0IG49bmV3IERhdGFWaWV3KGkuYnVmZmVyKTtyZXR1cm4gbi5zZXRVaW50MTYoOCx0LCEwKSxuLnNldFVpbnQxNigxMCxiLkNMT0NLLCEwKSxpfWZ1bmN0aW9uIFEoZSx0LGksbil7Y29uc3Qgcz1uZXcgVWludDhBcnJheSgzMik7cy5zZXQoZSwwKTtjb25zdCBhPW5ldyBEYXRhVmlldyhzLmJ1ZmZlcik7cmV0dXJuIGEuc2V0VWludDE2KDgsdCwhMCksYS5zZXRVaW50MTYoMTAsaSwhMCksYS5zZXRCaWdVaW50NjQoMTYsbiwhMCksc31mdW5jdGlvbiBIKGUsdD0wKXtsZXQgaT0zNzM1OTI4NTU5XnQsbj0xMTAzNTQ3OTkxXnQ7Zm9yKGxldCBzPTAsYTtzPGUubGVuZ3RoO3MrKylhPWUuY2hhckNvZGVBdChzKSxpPU1hdGguaW11bChpXmEsMjY1NDQzNTc2MSksbj1NYXRoLmltdWwobl5hLDE1OTczMzQ2NzcpO3JldHVybiBpPU1hdGguaW11bChpXmk+Pj4xNiwyMjQ2ODIyNTA3KV5NYXRoLmltdWwobl5uPj4+MTMsMzI2NjQ4OTkwOSksbj1NYXRoLmltdWwobl5uPj4+MTYsMjI0NjgyMjUwNyleTWF0aC5pbXVsKGleaT4+PjEzLDMyNjY0ODk5MDkpLDQyOTQ5NjcyOTYqKDIwOTcxNTEmbikrKGk+Pj4wKX1mdW5jdGlvbiB5KGUpe3JldHVybiBCaWdJbnQoZS5nZXRUaW1lKCkpKkJpZ0ludCgxZTYpfWZ1bmN0aW9uIHAoZSl7cmV0dXJuIG5ldyBEYXRlKE51bWJlcihlL0JpZ0ludCgxZTYpKSl9Y29uc3Qgc3Q9e1tNLkNVUl06RC5DVVIsW00uRU5EXTpELkVORCxbTS5TRVRdOkQuU0VUfTtjbGFzcyBhdHtjb25zdHJ1Y3Rvcih0KXtkKHRoaXMsImZzIik7ZCh0aGlzLCJhcmdzIik7ZCh0aGlzLCJlbnYiKTtkKHRoaXMsInN0ZGluIik7ZCh0aGlzLCJzdGRvdXQiKTtkKHRoaXMsInN0ZGVyciIpO2QodGhpcywiZGVidWciKTtkKHRoaXMsImlzVFRZIik7dGhpcy5mcz0odD09bnVsbD92b2lkIDA6dC5mcyk/P3t9LHRoaXMuYXJncz0odD09bnVsbD92b2lkIDA6dC5hcmdzKT8/W10sdGhpcy5lbnY9KHQ9PW51bGw/dm9pZCAwOnQuZW52KT8/e30sdGhpcy5zdGRpbj0odD09bnVsbD92b2lkIDA6dC5zdGRpbik/PygoKT0+bnVsbCksdGhpcy5zdGRvdXQ9KHQ9PW51bGw/dm9pZCAwOnQuc3Rkb3V0KT8/KCgpPT57fSksdGhpcy5zdGRlcnI9KHQ9PW51bGw/dm9pZCAwOnQuc3RkZXJyKT8/KCgpPT57fSksdGhpcy5kZWJ1Zz10PT1udWxsP3ZvaWQgMDp0LmRlYnVnLHRoaXMuaXNUVFk9ISEodCE9bnVsbCYmdC5pc1RUWSl9fW9ubWVzc2FnZT1hc3luYyBlPT57Y29uc3QgdD1lLmRhdGE7c3dpdGNoKHQudHlwZSl7Y2FzZSJzdGFydCI6dHJ5e2NvbnN0IGk9YXdhaXQgZnQodC5iaW5hcnlVUkwsdC5zdGRpbkJ1ZmZlcix0KTtMKHt0YXJnZXQ6Imhvc3QiLHR5cGU6InJlc3VsdCIscmVzdWx0Oml9KX1jYXRjaChpKXtsZXQgbjtpIGluc3RhbmNlb2YgRXJyb3I/bj17bWVzc2FnZTppLm1lc3NhZ2UsdHlwZTppLmNvbnN0cnVjdG9yLm5hbWV9Om49e21lc3NhZ2U6YHVua25vd24gZXJyb3IgLSAke2l9YCx0eXBlOiJVbmtub3duIn0sTCh7dGFyZ2V0OiJob3N0Iix0eXBlOiJjcmFzaCIsZXJyb3I6bn0pfWJyZWFrfX07ZnVuY3Rpb24gTChlKXtwb3N0TWVzc2FnZShlKX1hc3luYyBmdW5jdGlvbiBmdChlLHQsaSl7cmV0dXJuIFkuc3RhcnQoZmV0Y2goZSksbmV3IGF0KHsuLi5pLHN0ZG91dDpvdCxzdGRlcnI6Y3Qsc3RkaW46bj0+aHQobix0KSxkZWJ1ZzpFdH0pKX1mdW5jdGlvbiBvdChlKXtMKHt0YXJnZXQ6Imhvc3QiLHR5cGU6InN0ZG91dCIsdGV4dDplfSl9ZnVuY3Rpb24gY3QoZSl7TCh7dGFyZ2V0OiJob3N0Iix0eXBlOiJzdGRlcnIiLHRleHQ6ZX0pfWZ1bmN0aW9uIEV0KGUsdCxpLG4pe3JldHVybiBuPUpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobikpLEwoe3RhcmdldDoiaG9zdCIsdHlwZToiZGVidWciLG5hbWU6ZSxhcmdzOnQscmV0OmksZGF0YTpufSksaX1mdW5jdGlvbiBodChlLHQpe0F0b21pY3Mud2FpdChuZXcgSW50MzJBcnJheSh0KSwwLDApO2NvbnN0IGk9bmV3IERhdGFWaWV3KHQpLG49aS5nZXRJbnQzMigwKTtpZihuPDApcmV0dXJuIGkuc2V0SW50MzIoMCwwKSxudWxsO2NvbnN0IHM9bmV3IFVpbnQ4QXJyYXkodCw0LG4pLGE9bmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKHMuc2xpY2UoMCxlKSksZj1zLnNsaWNlKGUscy5sZW5ndGgpO3JldHVybiBpLnNldEludDMyKDAsZi5ieXRlTGVuZ3RoKSxzLnNldChmKSxhfX0pKCk7Cg==", j = typeof window < "u" && window.Blob && new Blob([atob(tt)], { type: "text/javascript;charset=utf-8" });
+const tt =
+    "dmFyIHV0ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgZ3QgPSAociwgVCwgRCkgPT4gVCBpbiByID8gdXQociwgVCwgewogICAgZW51bWVyYWJsZTogITAsCiAgICBjb25maWd1cmFibGU6ICEwLAogICAgd3JpdGFibGU6ICEwLAogICAgdmFsdWU6IEQKfSkgOiByW1RdID0gRDsKdmFyIGQgPSAociwgVCwgRCkgPT4gKGd0KHIsIHR5cGVvZiBUICE9ICJzeW1ib2wiID8gVCArICIiIDogVCwgRCksIEQpOwooZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgciA9IChlID0+IChlW2UuU1VDQ0VTUyA9IDBdID0gIlNVQ0NFU1MiLCBlW2UuRTJCSUcgPSAxXSA9ICJFMkJJRyIsIGVbZS5FQUNDRVNTID0gMl0gPSAiRUFDQ0VTUyIsIGVbZS5FQUREUklOVVNFID0gM10gPSAiRUFERFJJTlVTRSIsIGVbZS5FQUREUk5PVEFWQUlMID0gNF0gPSAiRUFERFJOT1RBVkFJTCIsIGVbZS5FQUZOT1NVUFBPUlQgPSA1XSA9ICJFQUZOT1NVUFBPUlQiLCBlW2UuRUFHQUlOID0gNl0gPSAiRUFHQUlOIiwgZVtlLkVBTFJFQURZID0gN10gPSAiRUFMUkVBRFkiLCBlW2UuRUJBREYgPSA4XSA9ICJFQkFERiIsIGVbZS5FQkFETVNHID0gOV0gPSAiRUJBRE1TRyIsIGVbZS5FQlVTWSA9IDEwXSA9ICJFQlVTWSIsIGVbZS5FQ0FOQ0VMRUQgPSAxMV0gPSAiRUNBTkNFTEVEIiwgZVtlLkVDSElMRCA9IDEyXSA9ICJFQ0hJTEQiLCBlW2UuRUNPTk5BQk9SVEVEID0gMTNdID0gIkVDT05OQUJPUlRFRCIsIGVbZS5FQ09OTlJFRlVTRUQgPSAxNF0gPSAiRUNPTk5SRUZVU0VEIiwgZVtlLkVDT05OUkVTRVQgPSAxNV0gPSAiRUNPTk5SRVNFVCIsIGVbZS5FREVBRExLID0gMTZdID0gIkVERUFETEsiLCBlW2UuRURFU1RBRERSUkVRID0gMTddID0gIkVERVNUQUREUlJFUSIsIGVbZS5FRE9NID0gMThdID0gIkVET00iLCBlW2UuRURRVU9UID0gMTldID0gIkVEUVVPVCIsIGVbZS5FRVhJU1QgPSAyMF0gPSAiRUVYSVNUIiwgZVtlLkVGQVVMVCA9IDIxXSA9ICJFRkFVTFQiLCBlW2UuRUZCSUcgPSAyMl0gPSAiRUZCSUciLCBlW2UuRUhPU1RVTlJFQUNIID0gMjNdID0gIkVIT1NUVU5SRUFDSCIsIGVbZS5FSURSTSA9IDI0XSA9ICJFSURSTSIsIGVbZS5FSUxTRVEgPSAyNV0gPSAiRUlMU0VRIiwgZVtlLkVJTlBST0dSRVNTID0gMjZdID0gIkVJTlBST0dSRVNTIiwgZVtlLkVJTlRSID0gMjddID0gIkVJTlRSIiwgZVtlLkVJTlZBTCA9IDI4XSA9ICJFSU5WQUwiLCBlW2UuRUlPID0gMjldID0gIkVJTyIsIGVbZS5FSVNDT05OID0gMzBdID0gIkVJU0NPTk4iLCBlW2UuRUlTRElSID0gMzFdID0gIkVJU0RJUiIsIGVbZS5FTE9PUCA9IDMyXSA9ICJFTE9PUCIsIGVbZS5FTUZJTEUgPSAzM10gPSAiRU1GSUxFIiwgZVtlLkVNTElOSyA9IDM0XSA9ICJFTUxJTksiLCBlW2UuRU1TR1NJWkUgPSAzNV0gPSAiRU1TR1NJWkUiLCBlW2UuRU1VTFRJSE9QID0gMzZdID0gIkVNVUxUSUhPUCIsIGVbZS5FTkFNRVRPT0xPTkcgPSAzN10gPSAiRU5BTUVUT09MT05HIiwgZVtlLkVORVRET1dOID0gMzhdID0gIkVORVRET1dOIiwgZVtlLkVORVRSRVNFVCA9IDM5XSA9ICJFTkVUUkVTRVQiLCBlW2UuRU5FVFVOUkVBQ0ggPSA0MF0gPSAiRU5FVFVOUkVBQ0giLCBlW2UuRU5GSUxFID0gNDFdID0gIkVORklMRSIsIGVbZS5FTk9CVUZTID0gNDJdID0gIkVOT0JVRlMiLCBlW2UuRU5PREVWID0gNDNdID0gIkVOT0RFViIsIGVbZS5FTk9FTlQgPSA0NF0gPSAiRU5PRU5UIiwgZVtlLkVOT0VYRUMgPSA0NV0gPSAiRU5PRVhFQyIsIGVbZS5FTk9MQ0sgPSA0Nl0gPSAiRU5PTENLIiwgZVtlLkVOT0xJTksgPSA0N10gPSAiRU5PTElOSyIsIGVbZS5FTk9NRU0gPSA0OF0gPSAiRU5PTUVNIiwgZVtlLkVOT01TRyA9IDQ5XSA9ICJFTk9NU0ciLCBlW2UuRU5PUFJPVE9PUFQgPSA1MF0gPSAiRU5PUFJPVE9PUFQiLCBlW2UuRU5PU1BDID0gNTFdID0gIkVOT1NQQyIsIGVbZS5FTk9TWVMgPSA1Ml0gPSAiRU5PU1lTIiwgZVtlLkVOT1RDT05OID0gNTNdID0gIkVOT1RDT05OIiwgZVtlLkVOT1RESVIgPSA1NF0gPSAiRU5PVERJUiIsIGVbZS5FTk9URU1QVFkgPSA1NV0gPSAiRU5PVEVNUFRZIiwgZVtlLkVOT1RSRUNPVkVSQUJMRSA9IDU2XSA9ICJFTk9UUkVDT1ZFUkFCTEUiLCBlW2UuRU5PVFNPQ0sgPSA1N10gPSAiRU5PVFNPQ0siLCBlW2UuRU5PVFNVUCA9IDU4XSA9ICJFTk9UU1VQIiwgZVtlLkVOT1RUWSA9IDU5XSA9ICJFTk9UVFkiLCBlW2UuRU5YSU8gPSA2MF0gPSAiRU5YSU8iLCBlW2UuRU9WRVJGTE9XID0gNjFdID0gIkVPVkVSRkxPVyIsIGVbZS5FT1dORVJERUFEID0gNjJdID0gIkVPV05FUkRFQUQiLCBlW2UuRVBFUk0gPSA2M10gPSAiRVBFUk0iLCBlW2UuRVBJUEUgPSA2NF0gPSAiRVBJUEUiLCBlW2UuRVBST1RPID0gNjVdID0gIkVQUk9UTyIsIGVbZS5FUFJPVE9OT1NVUFBPUlQgPSA2Nl0gPSAiRVBST1RPTk9TVVBQT1JUIiwgZVtlLkVQUk9UT1RZUEUgPSA2N10gPSAiRVBST1RPVFlQRSIsIGVbZS5FUkFOR0UgPSA2OF0gPSAiRVJBTkdFIiwgZVtlLkVST0ZTID0gNjldID0gIkVST0ZTIiwgZVtlLkVTUElQRSA9IDcwXSA9ICJFU1BJUEUiLCBlW2UuRVNSQ0ggPSA3MV0gPSAiRVNSQ0giLCBlW2UuRVNUQUxFID0gNzJdID0gIkVTVEFMRSIsIGVbZS5FVElNRURPVVQgPSA3M10gPSAiRVRJTUVET1VUIiwgZVtlLkVUWFRCU1kgPSA3NF0gPSAiRVRYVEJTWSIsIGVbZS5FWERFViA9IDc1XSA9ICJFWERFViIsIGVbZS5FTk9UQ0FQQUJMRSA9IDc2XSA9ICJFTk9UQ0FQQUJMRSIsIGUpKShyIHx8IHt9KSwKICAgICAgICBUID0gKGUgPT4gKGVbZS5SRUFMVElNRSA9IDBdID0gIlJFQUxUSU1FIiwgZVtlLk1PTk9UT05JQyA9IDFdID0gIk1PTk9UT05JQyIsIGVbZS5QUk9DRVNTX0NQVVRJTUVfSUQgPSAyXSA9ICJQUk9DRVNTX0NQVVRJTUVfSUQiLCBlW2UuVEhSRUFEX0NQVVRJTUVfSUQgPSAzXSA9ICJUSFJFQURfQ1BVVElNRV9JRCIsIGUpKShUIHx8IHt9KSwKICAgICAgICBEID0gKGUgPT4gKGVbZS5TRVQgPSAwXSA9ICJTRVQiLCBlW2UuQ1VSID0gMV0gPSAiQ1VSIiwgZVtlLkVORCA9IDJdID0gIkVORCIsIGUpKShEIHx8IHt9KSwKICAgICAgICBBID0gKGUgPT4gKGVbZS5VTktOT1dOID0gMF0gPSAiVU5LTk9XTiIsIGVbZS5CTE9DS19ERVZJQ0UgPSAxXSA9ICJCTE9DS19ERVZJQ0UiLCBlW2UuQ0hBUkFDVEVSX0RFVklDRSA9IDJdID0gIkNIQVJBQ1RFUl9ERVZJQ0UiLCBlW2UuRElSRUNUT1JZID0gM10gPSAiRElSRUNUT1JZIiwgZVtlLlJFR1VMQVJfRklMRSA9IDRdID0gIlJFR1VMQVJfRklMRSIsIGVbZS5TT0NLRVRfREdSQU0gPSA1XSA9ICJTT0NLRVRfREdSQU0iLCBlW2UuU09DS0VUX1NUUkVBTSA9IDZdID0gIlNPQ0tFVF9TVFJFQU0iLCBlW2UuU1lNQk9MSUNfTElOSyA9IDddID0gIlNZTUJPTElDX0xJTksiLCBlKSkoQSB8fCB7fSksCiAgICAgICAgRyA9IChlID0+IChlW2UuRElSID0gMF0gPSAiRElSIiwgZSkpKEcgfHwge30pLAogICAgICAgIGIgPSAoZSA9PiAoZVtlLkNMT0NLID0gMF0gPSAiQ0xPQ0siLCBlW2UuRkRfUkVBRCA9IDFdID0gIkZEX1JFQUQiLCBlW2UuRkRfV1JJVEUgPSAyXSA9ICJGRF9XUklURSIsIGUpKShiIHx8IHt9KTsKICAgIGNvbnN0IE4gPSB7CiAgICAgICAgICAgIENSRUFUOiAxLAogICAgICAgICAgICBESVJFQ1RPUlk6IDIsCiAgICAgICAgICAgIEVYQ0w6IDQsCiAgICAgICAgICAgIFRSVU5DOiA4CiAgICAgICAgfSwKICAgICAgICBPID0gewogICAgICAgICAgICBBUFBFTkQ6IDEsCiAgICAgICAgICAgIERTWU5DOiAyLAogICAgICAgICAgICBOT05CTE9DSzogNCwKICAgICAgICAgICAgUlNZTkM6IDgsCiAgICAgICAgICAgIFNZTkM6IDE2CiAgICAgICAgfSwKICAgICAgICBfID0gewogICAgICAgICAgICBGRF9EQVRBU1lOQzogQmlnSW50KDEpIDw8IEJpZ0ludCgwKSwKICAgICAgICAgICAgRkRfUkVBRDogQmlnSW50KDEpIDw8IEJpZ0ludCgxKSwKICAgICAgICAgICAgRkRfU0VFSzogQmlnSW50KDEpIDw8IEJpZ0ludCgyKSwKICAgICAgICAgICAgRkRfRkRTVEFUX1NFVF9GTEFHUzogQmlnSW50KDEpIDw8IEJpZ0ludCgzKSwKICAgICAgICAgICAgRkRfU1lOQzogQmlnSW50KDEpIDw8IEJpZ0ludCg0KSwKICAgICAgICAgICAgRkRfVEVMTDogQmlnSW50KDEpIDw8IEJpZ0ludCg1KSwKICAgICAgICAgICAgRkRfV1JJVEU6IEJpZ0ludCgxKSA8PCBCaWdJbnQoNiksCiAgICAgICAgICAgIEZEX0FEVklTRTogQmlnSW50KDEpIDw8IEJpZ0ludCg3KSwKICAgICAgICAgICAgRkRfQUxMT0NBVEU6IEJpZ0ludCgxKSA8PCBCaWdJbnQoOCksCiAgICAgICAgICAgIFBBVEhfQ1JFQVRFX0RJUkVDVE9SWTogQmlnSW50KDEpIDw8IEJpZ0ludCg5KSwKICAgICAgICAgICAgUEFUSF9DUkVBVEVfRklMRTogQmlnSW50KDEpIDw8IEJpZ0ludCgxMCksCiAgICAgICAgICAgIFBBVEhfTElOS19TT1VSQ0U6IEJpZ0ludCgxKSA8PCBCaWdJbnQoMTEpLAogICAgICAgICAgICBQQVRIX0xJTktfVEFSR0VUOiBCaWdJbnQoMSkgPDwgQmlnSW50KDEyKSwKICAgICAgICAgICAgUEFUSF9PUEVOOiBCaWdJbnQoMSkgPDwgQmlnSW50KDEzKSwKICAgICAgICAgICAgRkRfUkVBRERJUjogQmlnSW50KDEpIDw8IEJpZ0ludCgxNCksCiAgICAgICAgICAgIFBBVEhfUkVBRExJTks6IEJpZ0ludCgxKSA8PCBCaWdJbnQoMTUpLAogICAgICAgICAgICBQQVRIX1JFTkFNRV9TT1VSQ0U6IEJpZ0ludCgxKSA8PCBCaWdJbnQoMTYpLAogICAgICAgICAgICBQQVRIX1JFTkFNRV9UQVJHRVQ6IEJpZ0ludCgxKSA8PCBCaWdJbnQoMTcpLAogICAgICAgICAgICBQQVRIX0ZJTEVTVEFUX0dFVDogQmlnSW50KDEpIDw8IEJpZ0ludCgxOCksCiAgICAgICAgICAgIFBBVEhfRklMRVNUQVRfU0VUX1NJWkU6IEJpZ0ludCgxKSA8PCBCaWdJbnQoMTkpLAogICAgICAgICAgICBQQVRIX0ZJTEVTVEFUX1NFVF9USU1FUzogQmlnSW50KDEpIDw8IEJpZ0ludCgyMCksCiAgICAgICAgICAgIEZEX0ZJTEVTVEFUX0dFVDogQmlnSW50KDEpIDw8IEJpZ0ludCgyMSksCiAgICAgICAgICAgIEZEX0ZJTEVTVEFUX1NFVF9TSVpFOiBCaWdJbnQoMSkgPDwgQmlnSW50KDIyKSwKICAgICAgICAgICAgRkRfRklMRVNUQVRfU0VUX1RJTUVTOiBCaWdJbnQoMSkgPDwgQmlnSW50KDIzKSwKICAgICAgICAgICAgUEFUSF9TWU1MSU5LOiBCaWdJbnQoMSkgPDwgQmlnSW50KDI0KSwKICAgICAgICAgICAgUEFUSF9SRU1PVkVfRElSRUNUT1JZOiBCaWdJbnQoMSkgPDwgQmlnSW50KDI1KSwKICAgICAgICAgICAgUEFUSF9VTkxJTktfRklMRTogQmlnSW50KDEpIDw8IEJpZ0ludCgyNiksCiAgICAgICAgICAgIFBPTExfRkRfUkVBRFdSSVRFOiBCaWdJbnQoMSkgPDwgQmlnSW50KDI3KSwKICAgICAgICAgICAgU09DS19TSFVURE9XTjogQmlnSW50KDEpIDw8IEJpZ0ludCgyOCksCiAgICAgICAgICAgIFNPQ0tfQUNDRVBUOiBCaWdJbnQoMSkgPDwgQmlnSW50KDI5KQogICAgICAgIH0sCiAgICAgICAgbSA9IHsKICAgICAgICAgICAgQVRJTTogMSwKICAgICAgICAgICAgQVRJTV9OT1c6IDIsCiAgICAgICAgICAgIE1USU06IDQsCiAgICAgICAgICAgIE1USU1fTk9XOiA4CiAgICAgICAgfSwKICAgICAgICBxID0gewogICAgICAgICAgICBTVUJTQ1JJUFRJT05fQ0xPQ0tfQUJTVElNRTogMQogICAgICAgIH0sCiAgICAgICAgVyA9IDY0LAogICAgICAgIHogPSA0OCwKICAgICAgICAkID0gMzI7CiAgICB2YXIgTSA9IChlID0+IChlW2UuQ1VSID0gMF0gPSAiQ1VSIiwgZVtlLkVORCA9IDFdID0gIkVORCIsIGVbZS5TRVQgPSAyXSA9ICJTRVQiLCBlKSkoTSB8fCB7fSk7CiAgICBjbGFzcyB0dCB7CiAgICAgICAgY29uc3RydWN0b3IodCkgewogICAgICAgICAgICBkKHRoaXMsICJmcyIpOwogICAgICAgICAgICBkKHRoaXMsICJuZXh0RkQiLCAxMCk7CiAgICAgICAgICAgIGQodGhpcywgIm9wZW5NYXAiLCBuZXcgTWFwKTsKICAgICAgICAgICAgdGhpcy5mcyA9IHsKICAgICAgICAgICAgICAgIC4uLnQKICAgICAgICAgICAgfSwgdGhpcy5vcGVuTWFwLnNldCgzLCBuZXcgdSh0aGlzLmZzLCAiLyIpKQogICAgICAgIH0KICAgICAgICBvcGVuRmlsZSh0LCBpLCBuKSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSBuZXcgSSh0LCBuKTsKICAgICAgICAgICAgaSAmJiAocy5idWZmZXIgPSBuZXcgVWludDhBcnJheShuZXcgQXJyYXlCdWZmZXIoMTAyNCksIDAsIDApKTsKICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMubmV4dEZEOwogICAgICAgICAgICByZXR1cm4gdGhpcy5vcGVuTWFwLnNldChhLCBzKSwgdGhpcy5uZXh0RkQrKywgW3IuU1VDQ0VTUywgYV0KICAgICAgICB9CiAgICAgICAgb3BlbkRpcih0LCBpKSB7CiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgdSh0LCBpKSwKICAgICAgICAgICAgICAgIHMgPSB0aGlzLm5leHRGRDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMub3Blbk1hcC5zZXQocywgbiksIHRoaXMubmV4dEZEKyssIFtyLlNVQ0NFU1MsIHNdCiAgICAgICAgfQogICAgICAgIGhhc0Rpcih0LCBpKSB7CiAgICAgICAgICAgIHJldHVybiBpID09PSAiLiIgPyAhMCA6IHQuY29udGFpbnNEaXJlY3RvcnkoaSkKICAgICAgICB9CiAgICAgICAgb3Blbih0LCBpLCBuLCBzKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSAhIShuICYgTi5DUkVBVCksCiAgICAgICAgICAgICAgICBmID0gISEobiAmIE4uRElSRUNUT1JZKSwKICAgICAgICAgICAgICAgIGMgPSAhIShuICYgTi5FWENMKSwKICAgICAgICAgICAgICAgIG8gPSAhIShuICYgTi5UUlVOQyksCiAgICAgICAgICAgICAgICBFID0gdGhpcy5vcGVuTWFwLmdldCh0KTsKICAgICAgICAgICAgaWYgKCEoRSBpbnN0YW5jZW9mIHUpKSByZXR1cm4gW3IuRUJBREZdOwogICAgICAgICAgICBpZiAoRS5jb250YWluc0ZpbGUoaSkpIHJldHVybiBmID8gW3IuRU5PVERJUl0gOiBjID8gW3IuRUVYSVNUXSA6IHRoaXMub3BlbkZpbGUoRS5nZXQoaSksIG8sIHMpOwogICAgICAgICAgICBpZiAodGhpcy5oYXNEaXIoRSwgaSkpIHsKICAgICAgICAgICAgICAgIGlmIChpID09PSAiLiIpIHJldHVybiB0aGlzLm9wZW5EaXIodGhpcy5mcywgIi8iKTsKICAgICAgICAgICAgICAgIGNvbnN0IGggPSBgLyR7aX0vYCwKICAgICAgICAgICAgICAgICAgICBTID0gT2JqZWN0LmVudHJpZXModGhpcy5mcykuZmlsdGVyKChbZ10pID0+IGcuc3RhcnRzV2l0aChoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcGVuRGlyKE9iamVjdC5mcm9tRW50cmllcyhTKSwgaCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaCA9IEUuZnVsbFBhdGgoaSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZnNbaF0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGgsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICJiaW5hcnkiLAogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBuZXcgVWludDhBcnJheSwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzOiBuZXcgRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWNhdGlvbjogbmV3IERhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IG5ldyBEYXRlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLm9wZW5GaWxlKHRoaXMuZnNbaF0sIG8sIHMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gW3IuRU5PRU5UXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNsb3NlKHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm9wZW5NYXAuaGFzKHQpKSByZXR1cm4gci5FQkFERjsKICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMub3Blbk1hcC5nZXQodCk7CiAgICAgICAgICAgIHJldHVybiBpIGluc3RhbmNlb2YgSSAmJiBpLnN5bmMoKSwgdGhpcy5vcGVuTWFwLmRlbGV0ZSh0KSwgci5TVUNDRVNTCiAgICAgICAgfQogICAgICAgIHJlYWQodCwgaSkgewogICAgICAgICAgICBjb25zdCBuID0gdGhpcy5vcGVuTWFwLmdldCh0KTsKICAgICAgICAgICAgcmV0dXJuICFuIHx8IG4gaW5zdGFuY2VvZiB1ID8gW3IuRUJBREZdIDogW3IuU1VDQ0VTUywgbi5yZWFkKGkpXQogICAgICAgIH0KICAgICAgICBwcmVhZCh0LCBpLCBuKSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLm9wZW5NYXAuZ2V0KHQpOwogICAgICAgICAgICByZXR1cm4gIXMgfHwgcyBpbnN0YW5jZW9mIHUgPyBbci5FQkFERl0gOiBbci5TVUNDRVNTLCBzLnByZWFkKGksIG4pXQogICAgICAgIH0KICAgICAgICB3cml0ZSh0LCBpKSB7CiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLm9wZW5NYXAuZ2V0KHQpOwogICAgICAgICAgICByZXR1cm4gIW4gfHwgbiBpbnN0YW5jZW9mIHUgPyByLkVCQURGIDogKG4ud3JpdGUoaSksIHIuU1VDQ0VTUykKICAgICAgICB9CiAgICAgICAgcHdyaXRlKHQsIGksIG4pIHsKICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMub3Blbk1hcC5nZXQodCk7CiAgICAgICAgICAgIHJldHVybiAhcyB8fCBzIGluc3RhbmNlb2YgdSA/IHIuRUJBREYgOiAocy5wd3JpdGUoaSwgbiksIHIuU1VDQ0VTUykKICAgICAgICB9CiAgICAgICAgc3luYyh0KSB7CiAgICAgICAgICAgIGNvbnN0IGkgPSB0aGlzLm9wZW5NYXAuZ2V0KHQpOwogICAgICAgICAgICByZXR1cm4gIWkgfHwgaSBpbnN0YW5jZW9mIHUgPyByLkVCQURGIDogKGkuc3luYygpLCByLlNVQ0NFU1MpCiAgICAgICAgfQogICAgICAgIHNlZWsodCwgaSwgbikgewogICAgICAgICAgICBjb25zdCBzID0gdGhpcy5vcGVuTWFwLmdldCh0KTsKICAgICAgICAgICAgcmV0dXJuICFzIHx8IHMgaW5zdGFuY2VvZiB1ID8gW3IuRUJBREZdIDogW3IuU1VDQ0VTUywgcy5zZWVrKGksIG4pXQogICAgICAgIH0KICAgICAgICB0ZWxsKHQpIHsKICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMub3Blbk1hcC5nZXQodCk7CiAgICAgICAgICAgIHJldHVybiAhaSB8fCBpIGluc3RhbmNlb2YgdSA/IFtyLkVCQURGXSA6IFtyLlNVQ0NFU1MsIGkudGVsbCgpXQogICAgICAgIH0KICAgICAgICByZW51bWJlcih0LCBpKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5leGlzdHModCkgfHwgIXRoaXMuZXhpc3RzKGkpID8gci5FQkFERiA6ICh0ID09PSBpIHx8ICh0aGlzLmNsb3NlKGkpLCB0aGlzLm9wZW5NYXAuc2V0KGksIHRoaXMub3Blbk1hcC5nZXQodCkpKSwgci5TVUNDRVNTKQogICAgICAgIH0KICAgICAgICB1bmxpbmsodCwgaSkgewogICAgICAgICAgICBjb25zdCBuID0gdGhpcy5vcGVuTWFwLmdldCh0KTsKICAgICAgICAgICAgaWYgKCEobiBpbnN0YW5jZW9mIHUpKSByZXR1cm4gci5FQkFERjsKICAgICAgICAgICAgaWYgKCFuLmNvbnRhaW5zKGkpKSByZXR1cm4gci5FTk9FTlQ7CiAgICAgICAgICAgIGZvciAoY29uc3QgcyBvZiBPYmplY3Qua2V5cyh0aGlzLmZzKSkocyA9PT0gbi5mdWxsUGF0aChpKSB8fCBzLnN0YXJ0c1dpdGgoYCR7bi5mdWxsUGF0aChpKX0vYCkpICYmIGRlbGV0ZSB0aGlzLmZzW3NdOwogICAgICAgICAgICByZXR1cm4gci5TVUNDRVNTCiAgICAgICAgfQogICAgICAgIHJlbmFtZSh0LCBpLCBuLCBzKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLm9wZW5NYXAuZ2V0KHQpLAogICAgICAgICAgICAgICAgZiA9IHRoaXMub3Blbk1hcC5nZXQobik7CiAgICAgICAgICAgIGlmICghKGEgaW5zdGFuY2VvZiB1KSB8fCAhKGYgaW5zdGFuY2VvZiB1KSkgcmV0dXJuIHIuRUJBREY7CiAgICAgICAgICAgIGlmICghYS5jb250YWlucyhpKSkgcmV0dXJuIHIuRU5PRU5UOwogICAgICAgICAgICBpZiAoZi5jb250YWlucyhzKSkgcmV0dXJuIHIuRUVYSVNUOwogICAgICAgICAgICBjb25zdCBjID0gYS5mdWxsUGF0aChpKSwKICAgICAgICAgICAgICAgIG8gPSBmLmZ1bGxQYXRoKHMpOwogICAgICAgICAgICBmb3IgKGNvbnN0IEUgb2YgT2JqZWN0LmtleXModGhpcy5mcykpCiAgICAgICAgICAgICAgICBpZiAoRS5zdGFydHNXaXRoKGMpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaCA9IEUucmVwbGFjZShjLCBvKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmZzW2hdID0gdGhpcy5mc1tFXSwgdGhpcy5mc1toXS5wYXRoID0gaCwgZGVsZXRlIHRoaXMuZnNbRV0KICAgICAgICAgICAgICAgIH0gcmV0dXJuIHIuU1VDQ0VTUwogICAgICAgIH0KICAgICAgICBsaXN0KHQpIHsKICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMub3Blbk1hcC5nZXQodCk7CiAgICAgICAgICAgIHJldHVybiBpIGluc3RhbmNlb2YgdSA/IFtyLlNVQ0NFU1MsIGkubGlzdCgpXSA6IFtyLkVCQURGXQogICAgICAgIH0KICAgICAgICBzdGF0KHQpIHsKICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMub3Blbk1hcC5nZXQodCk7CiAgICAgICAgICAgIHJldHVybiBpIGluc3RhbmNlb2YgSSA/IFtyLlNVQ0NFU1MsIGkuc3RhdCgpXSA6IFtyLkVCQURGXQogICAgICAgIH0KICAgICAgICBwYXRoU3RhdCh0LCBpKSB7CiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLm9wZW5NYXAuZ2V0KHQpOwogICAgICAgICAgICBpZiAoIShuIGluc3RhbmNlb2YgdSkpIHJldHVybiBbci5FQkFERl07CiAgICAgICAgICAgIGlmIChuLmNvbnRhaW5zRmlsZShpKSkgewogICAgICAgICAgICAgICAgY29uc3QgcyA9IG4uZnVsbFBhdGgoaSksCiAgICAgICAgICAgICAgICAgICAgYSA9IG5ldyBJKHRoaXMuZnNbc10sIDApLnN0YXQoKTsKICAgICAgICAgICAgICAgIHJldHVybiBbci5TVUNDRVNTLCBhXQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaGFzRGlyKG4sIGkpKSB7CiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gIi4iKSByZXR1cm4gW3IuU1VDQ0VTUywgbmV3IHUodGhpcy5mcywgIi8iKS5zdGF0KCldOwogICAgICAgICAgICAgICAgY29uc3QgcyA9IGAvJHtpfS9gLAogICAgICAgICAgICAgICAgICAgIGEgPSBPYmplY3QuZW50cmllcyh0aGlzLmZzKS5maWx0ZXIoKFtjXSkgPT4gYy5zdGFydHNXaXRoKHMpKSwKICAgICAgICAgICAgICAgICAgICBmID0gbmV3IHUoT2JqZWN0LmZyb21FbnRyaWVzKGEpLCBzKS5zdGF0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gW3IuU1VDQ0VTUywgZl0KICAgICAgICAgICAgfSBlbHNlIHJldHVybiBbci5FTk9FTlRdCiAgICAgICAgfQogICAgICAgIHNldEZsYWdzKHQsIGkpIHsKICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMub3Blbk1hcC5nZXQodCk7CiAgICAgICAgICAgIHJldHVybiBuIGluc3RhbmNlb2YgSSA/IChuLnNldEZsYWdzKGkpLCByLlNVQ0NFU1MpIDogci5FQkFERgogICAgICAgIH0KICAgICAgICBzZXRTaXplKHQsIGkpIHsKICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMub3Blbk1hcC5nZXQodCk7CiAgICAgICAgICAgIHJldHVybiBuIGluc3RhbmNlb2YgSSA/IChuLnNldFNpemUoTnVtYmVyKGkpKSwgci5TVUNDRVNTKSA6IHIuRUJBREYKICAgICAgICB9CiAgICAgICAgc2V0QWNjZXNzVGltZSh0LCBpKSB7CiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLm9wZW5NYXAuZ2V0KHQpOwogICAgICAgICAgICByZXR1cm4gbiBpbnN0YW5jZW9mIEkgPyAobi5zZXRBY2Nlc3NUaW1lKGkpLCByLlNVQ0NFU1MpIDogci5FQkFERgogICAgICAgIH0KICAgICAgICBzZXRNb2RpZmljYXRpb25UaW1lKHQsIGkpIHsKICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMub3Blbk1hcC5nZXQodCk7CiAgICAgICAgICAgIHJldHVybiBuIGluc3RhbmNlb2YgSSA/IChuLnNldE1vZGlmaWNhdGlvblRpbWUoaSksIHIuU1VDQ0VTUykgOiByLkVCQURGCiAgICAgICAgfQogICAgICAgIHBhdGhTZXRBY2Nlc3NUaW1lKHQsIGksIG4pIHsKICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMub3Blbk1hcC5nZXQodCk7CiAgICAgICAgICAgIGlmICghKHMgaW5zdGFuY2VvZiB1KSkgcmV0dXJuIHIuRUJBREY7CiAgICAgICAgICAgIGNvbnN0IGEgPSBzLmdldChpKTsKICAgICAgICAgICAgaWYgKCFhKSByZXR1cm4gci5FTk9FTlQ7CiAgICAgICAgICAgIGNvbnN0IGYgPSBuZXcgSShhLCAwKTsKICAgICAgICAgICAgcmV0dXJuIGYuc2V0QWNjZXNzVGltZShuKSwgZi5zeW5jKCksIHIuU1VDQ0VTUwogICAgICAgIH0KICAgICAgICBwYXRoU2V0TW9kaWZpY2F0aW9uVGltZSh0LCBpLCBuKSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLm9wZW5NYXAuZ2V0KHQpOwogICAgICAgICAgICBpZiAoIShzIGluc3RhbmNlb2YgdSkpIHJldHVybiByLkVCQURGOwogICAgICAgICAgICBjb25zdCBhID0gcy5nZXQoaSk7CiAgICAgICAgICAgIGlmICghYSkgcmV0dXJuIHIuRU5PRU5UOwogICAgICAgICAgICBjb25zdCBmID0gbmV3IEkoYSwgMCk7CiAgICAgICAgICAgIHJldHVybiBmLnNldE1vZGlmaWNhdGlvblRpbWUobiksIGYuc3luYygpLCByLlNVQ0NFU1MKICAgICAgICB9CiAgICAgICAgcGF0aENyZWF0ZURpcih0LCBpKSB7CiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLm9wZW5NYXAuZ2V0KHQpOwogICAgICAgICAgICBpZiAoIShuIGluc3RhbmNlb2YgdSkpIHJldHVybiByLkVCQURGOwogICAgICAgICAgICBpZiAobi5jb250YWlucyhpKSkgcmV0dXJuIHIuRU5PRU5UOwogICAgICAgICAgICBjb25zdCBzID0gYCR7bi5mdWxsUGF0aChpKX0vLnJ1bm5vYDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZnNbc10gPSB7CiAgICAgICAgICAgICAgICBwYXRoOiBzLAogICAgICAgICAgICAgICAgdGltZXN0YW1wczogewogICAgICAgICAgICAgICAgICAgIGFjY2VzczogbmV3IERhdGUsCiAgICAgICAgICAgICAgICAgICAgbW9kaWZpY2F0aW9uOiBuZXcgRGF0ZSwKICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IG5ldyBEYXRlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbW9kZTogInN0cmluZyIsCiAgICAgICAgICAgICAgICBjb250ZW50OiAiIgogICAgICAgICAgICB9LCByLlNVQ0NFU1MKICAgICAgICB9CiAgICAgICAgZXhpc3RzKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMub3Blbk1hcC5oYXModCkKICAgICAgICB9CiAgICAgICAgZmlsZVR5cGUodCkgewogICAgICAgICAgICBjb25zdCBpID0gdGhpcy5vcGVuTWFwLmdldCh0KTsKICAgICAgICAgICAgcmV0dXJuIGkgPyBpIGluc3RhbmNlb2YgSSA/IEEuUkVHVUxBUl9GSUxFIDogQS5ESVJFQ1RPUlkgOiBBLlVOS05PV04KICAgICAgICB9CiAgICAgICAgZmlsZUZkZmxhZ3ModCkgewogICAgICAgICAgICBjb25zdCBpID0gdGhpcy5vcGVuTWFwLmdldCh0KTsKICAgICAgICAgICAgcmV0dXJuIGkgaW5zdGFuY2VvZiBJID8gaS5mZGZsYWdzIDogMAogICAgICAgIH0KICAgIH0KICAgIGNsYXNzIEkgewogICAgICAgIGNvbnN0cnVjdG9yKHQsIGkpIHsKICAgICAgICAgICAgZCh0aGlzLCAiZmlsZSIpOwogICAgICAgICAgICBkKHRoaXMsICJidWZmZXIiKTsKICAgICAgICAgICAgZCh0aGlzLCAiX29mZnNldCIsIEJpZ0ludCgwKSk7CiAgICAgICAgICAgIGQodGhpcywgImlzRGlydHkiLCAhMSk7CiAgICAgICAgICAgIGQodGhpcywgImZkZmxhZ3MiKTsKICAgICAgICAgICAgZCh0aGlzLCAiZmxhZ0FwcGVuZCIpOwogICAgICAgICAgICBkKHRoaXMsICJmbGFnRFN5bmMiKTsKICAgICAgICAgICAgZCh0aGlzLCAiZmxhZ05vbkJsb2NrIik7CiAgICAgICAgICAgIGQodGhpcywgImZsYWdSU3luYyIpOwogICAgICAgICAgICBkKHRoaXMsICJmbGFnU3luYyIpOwogICAgICAgICAgICBpZiAodGhpcy5maWxlID0gdCwgdGhpcy5maWxlLm1vZGUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICBjb25zdCBuID0gbmV3IFRleHRFbmNvZGVyOwogICAgICAgICAgICAgICAgdGhpcy5idWZmZXIgPSBuLmVuY29kZSh0aGlzLmZpbGUuY29udGVudCkKICAgICAgICAgICAgfSBlbHNlIHRoaXMuYnVmZmVyID0gdGhpcy5maWxlLmNvbnRlbnQ7CiAgICAgICAgICAgIHRoaXMuZmRmbGFncyA9IGksIHRoaXMuZmxhZ0FwcGVuZCA9ICEhKGkgJiBPLkFQUEVORCksIHRoaXMuZmxhZ0RTeW5jID0gISEoaSAmIE8uRFNZTkMpLCB0aGlzLmZsYWdOb25CbG9jayA9ICEhKGkgJiBPLk5PTkJMT0NLKSwgdGhpcy5mbGFnUlN5bmMgPSAhIShpICYgTy5SU1lOQyksIHRoaXMuZmxhZ1N5bmMgPSAhIShpICYgTy5TWU5DKQogICAgICAgIH0KICAgICAgICBnZXQgb2Zmc2V0KCkgewogICAgICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuX29mZnNldCkKICAgICAgICB9CiAgICAgICAgcmVhZCh0KSB7CiAgICAgICAgICAgIGNvbnN0IGkgPSB0aGlzLmJ1ZmZlci5zdWJhcnJheSh0aGlzLm9mZnNldCwgdGhpcy5vZmZzZXQgKyB0KTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29mZnNldCArPSBCaWdJbnQoaS5sZW5ndGgpLCBpCiAgICAgICAgfQogICAgICAgIHByZWFkKHQsIGkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnN1YmFycmF5KGksIGkgKyB0KQogICAgICAgIH0KICAgICAgICB3cml0ZSh0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzRGlydHkgPSAhMCwgdGhpcy5mbGFnQXBwZW5kKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gdGhpcy5idWZmZXIubGVuZ3RoOwogICAgICAgICAgICAgICAgdGhpcy5yZXNpemUoaSArIHQuYnl0ZUxlbmd0aCksIHRoaXMuYnVmZmVyLnNldCh0LCBpKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgaSA9IE1hdGgubWF4KHRoaXMub2Zmc2V0ICsgdC5ieXRlTGVuZ3RoLCB0aGlzLmJ1ZmZlci5ieXRlTGVuZ3RoKTsKICAgICAgICAgICAgICAgIHRoaXMucmVzaXplKGkpLCB0aGlzLmJ1ZmZlci5zZXQodCwgdGhpcy5vZmZzZXQpLCB0aGlzLl9vZmZzZXQgKz0gQmlnSW50KHQuYnl0ZUxlbmd0aCkKICAgICAgICAgICAgfSh0aGlzLmZsYWdEU3luYyB8fCB0aGlzLmZsYWdTeW5jKSAmJiB0aGlzLnN5bmMoKQogICAgICAgIH0KICAgICAgICBwd3JpdGUodCwgaSkgewogICAgICAgICAgICBpZiAodGhpcy5pc0RpcnR5ID0gITAsIHRoaXMuZmxhZ0FwcGVuZCkgewogICAgICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuYnVmZmVyLmxlbmd0aDsKICAgICAgICAgICAgICAgIHRoaXMucmVzaXplKG4gKyB0LmJ5dGVMZW5ndGgpLCB0aGlzLmJ1ZmZlci5zZXQodCwgbikKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBNYXRoLm1heChpICsgdC5ieXRlTGVuZ3RoLCB0aGlzLmJ1ZmZlci5ieXRlTGVuZ3RoKTsKICAgICAgICAgICAgICAgIHRoaXMucmVzaXplKG4pLCB0aGlzLmJ1ZmZlci5zZXQodCwgaSkKICAgICAgICAgICAgfSh0aGlzLmZsYWdEU3luYyB8fCB0aGlzLmZsYWdTeW5jKSAmJiB0aGlzLnN5bmMoKQogICAgICAgIH0KICAgICAgICBzeW5jKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuaXNEaXJ0eSkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5pc0RpcnR5ID0gITEsIHRoaXMuZmlsZS5tb2RlID09PSAiYmluYXJ5IikgewogICAgICAgICAgICAgICAgdGhpcy5maWxlLmNvbnRlbnQgPSBuZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlcik7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB0ID0gbmV3IFRleHREZWNvZGVyOwogICAgICAgICAgICB0aGlzLmZpbGUuY29udGVudCA9IHQuZGVjb2RlKHRoaXMuYnVmZmVyKQogICAgICAgIH0KICAgICAgICBzZWVrKHQsIGkpIHsKICAgICAgICAgICAgc3dpdGNoIChpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEQuU0VUOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX29mZnNldCA9IHQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEQuQ1VSOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX29mZnNldCArPSB0OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBELkVORDoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9vZmZzZXQgPSBCaWdJbnQodGhpcy5idWZmZXIubGVuZ3RoKSArIHQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2Zmc2V0CiAgICAgICAgfQogICAgICAgIHRlbGwoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vZmZzZXQKICAgICAgICB9CiAgICAgICAgc3RhdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGg6IHRoaXMuZmlsZS5wYXRoLAogICAgICAgICAgICAgICAgdGltZXN0YW1wczogdGhpcy5maWxlLnRpbWVzdGFtcHMsCiAgICAgICAgICAgICAgICB0eXBlOiBBLlJFR1VMQVJfRklMRSwKICAgICAgICAgICAgICAgIGJ5dGVMZW5ndGg6IHRoaXMuYnVmZmVyLmxlbmd0aAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNldEZsYWdzKHQpIHsKICAgICAgICAgICAgdGhpcy5mZGZsYWdzID0gdAogICAgICAgIH0KICAgICAgICBzZXRTaXplKHQpIHsKICAgICAgICAgICAgdGhpcy5yZXNpemUodCkKICAgICAgICB9CiAgICAgICAgc2V0QWNjZXNzVGltZSh0KSB7CiAgICAgICAgICAgIHRoaXMuZmlsZS50aW1lc3RhbXBzLmFjY2VzcyA9IHQKICAgICAgICB9CiAgICAgICAgc2V0TW9kaWZpY2F0aW9uVGltZSh0KSB7CiAgICAgICAgICAgIHRoaXMuZmlsZS50aW1lc3RhbXBzLm1vZGlmaWNhdGlvbiA9IHQKICAgICAgICB9CiAgICAgICAgcmVzaXplKHQpIHsKICAgICAgICAgICAgaWYgKHQgPD0gdGhpcy5idWZmZXIuYnVmZmVyLmJ5dGVMZW5ndGgpIHsKICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIuYnVmZmVyLCAwLCB0KTsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBpOwogICAgICAgICAgICB0aGlzLmJ1ZmZlci5idWZmZXIuYnl0ZUxlbmd0aCA9PT0gMCA/IGkgPSBuZXcgQXJyYXlCdWZmZXIodCA8IDEwMjQgPyAxMDI0IDogdCAqIDIpIDogdCA+IHRoaXMuYnVmZmVyLmJ1ZmZlci5ieXRlTGVuZ3RoICogMiA/IGkgPSBuZXcgQXJyYXlCdWZmZXIodCAqIDIpIDogaSA9IG5ldyBBcnJheUJ1ZmZlcih0aGlzLmJ1ZmZlci5idWZmZXIuYnl0ZUxlbmd0aCAqIDIpOwogICAgICAgICAgICBjb25zdCBuID0gbmV3IFVpbnQ4QXJyYXkoaSwgMCwgdCk7CiAgICAgICAgICAgIG4uc2V0KHRoaXMuYnVmZmVyKSwgdGhpcy5idWZmZXIgPSBuCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFAoZSwgdCkgewogICAgICAgIGNvbnN0IGkgPSB0LnJlcGxhY2UoL1svXC1cXF4kKis/LigpfFtcXXt9XS9nLCAiXFwkJiIpLAogICAgICAgICAgICBuID0gbmV3IFJlZ0V4cChgXiR7aX1gKTsKICAgICAgICByZXR1cm4gZS5yZXBsYWNlKG4sICIiKQogICAgfQogICAgY2xhc3MgdSB7CiAgICAgICAgY29uc3RydWN0b3IodCwgaSkgewogICAgICAgICAgICBkKHRoaXMsICJkaXIiKTsKICAgICAgICAgICAgZCh0aGlzLCAicHJlZml4Iik7CiAgICAgICAgICAgIHRoaXMuZGlyID0gdCwgdGhpcy5wcmVmaXggPSBpCiAgICAgICAgfQogICAgICAgIGNvbnRhaW5zRmlsZSh0KSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgaSBvZiBPYmplY3Qua2V5cyh0aGlzLmRpcikpCiAgICAgICAgICAgICAgICBpZiAoUChpLCB0aGlzLnByZWZpeCkgPT09IHQpIHJldHVybiAhMDsKICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgfQogICAgICAgIGNvbnRhaW5zRGlyZWN0b3J5KHQpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBpIG9mIE9iamVjdC5rZXlzKHRoaXMuZGlyKSkKICAgICAgICAgICAgICAgIGlmIChQKGksIHRoaXMucHJlZml4KS5zdGFydHNXaXRoKGAke3R9L2ApKSByZXR1cm4gITA7CiAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgIH0KICAgICAgICBjb250YWlucyh0KSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgaSBvZiBPYmplY3Qua2V5cyh0aGlzLmRpcikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBQKGksIHRoaXMucHJlZml4KTsKICAgICAgICAgICAgICAgIGlmIChuID09PSB0IHx8IG4uc3RhcnRzV2l0aChgJHt0fS9gKSkgcmV0dXJuICEwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgfQogICAgICAgIGdldCh0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpclt0aGlzLmZ1bGxQYXRoKHQpXQogICAgICAgIH0KICAgICAgICBmdWxsUGF0aCh0KSB7CiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLnByZWZpeH0ke3R9YAogICAgICAgIH0KICAgICAgICBsaXN0KCkgewogICAgICAgICAgICBjb25zdCB0ID0gW10sCiAgICAgICAgICAgICAgICBpID0gbmV3IFNldDsKICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIE9iamVjdC5rZXlzKHRoaXMuZGlyKSkgewogICAgICAgICAgICAgICAgY29uc3QgcyA9IFAobiwgdGhpcy5wcmVmaXgpOwogICAgICAgICAgICAgICAgaWYgKHMuaW5jbHVkZXMoIi8iKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBzLnNwbGl0KCIvIilbMF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGkuaGFzKGEpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBpLmFkZChhKSwgdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogYSwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQS5ESVJFQ1RPUlkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBlbHNlIHQucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogcywKICAgICAgICAgICAgICAgICAgICB0eXBlOiBBLlJFR1VMQVJfRklMRQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdAogICAgICAgIH0KICAgICAgICBzdGF0KCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcGF0aDogdGhpcy5wcmVmaXgsCiAgICAgICAgICAgICAgICB0aW1lc3RhbXBzOiB7CiAgICAgICAgICAgICAgICAgICAgYWNjZXNzOiBuZXcgRGF0ZSwKICAgICAgICAgICAgICAgICAgICBtb2RpZmljYXRpb246IG5ldyBEYXRlLAogICAgICAgICAgICAgICAgICAgIGNoYW5nZTogbmV3IERhdGUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0eXBlOiBBLkRJUkVDVE9SWSwKICAgICAgICAgICAgICAgIGJ5dGVMZW5ndGg6IDAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGxldCBrID0gW107CgogICAgZnVuY3Rpb24gVShlKSB7CiAgICAgICAgay5wdXNoKGUpCiAgICB9CgogICAgZnVuY3Rpb24gZXQoKSB7CiAgICAgICAgY29uc3QgZSA9IGs7CiAgICAgICAgcmV0dXJuIGsgPSBbXSwgZQogICAgfQogICAgY2xhc3MgWSB7CiAgICAgICAgY29uc3RydWN0b3IodCkgewogICAgICAgICAgICBkKHRoaXMsICJpbnN0YW5jZSIpOwogICAgICAgICAgICBkKHRoaXMsICJtb2R1bGUiKTsKICAgICAgICAgICAgZCh0aGlzLCAibWVtb3J5Iik7CiAgICAgICAgICAgIGQodGhpcywgImNvbnRleHQiKTsKICAgICAgICAgICAgZCh0aGlzLCAiZHJpdmUiKTsKICAgICAgICAgICAgZCh0aGlzLCAiaW5pdGlhbGl6ZWQiLCAhMSk7CiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IHQsIHRoaXMuZHJpdmUgPSBuZXcgdHQodC5mcykKICAgICAgICB9CiAgICAgICAgc3RhdGljIGFzeW5jIHN0YXJ0KHQsIGkpIHsKICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBZKGkpLAogICAgICAgICAgICAgICAgcyA9IGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nKHQsIHsKICAgICAgICAgICAgICAgICAgICB3YXNpX3NuYXBzaG90X3ByZXZpZXcxOiBuLmdldEltcG9ydHMoInByZXZpZXcxIiwgaS5kZWJ1ZyksCiAgICAgICAgICAgICAgICAgICAgd2FzaV91bnN0YWJsZTogbi5nZXRJbXBvcnRzKCJ1bnN0YWJsZSIsIGkuZGVidWcpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG4uaW5pdChzKSwgbi5zdGFydCgpCiAgICAgICAgfQogICAgICAgIGluaXQodCkgewogICAgICAgICAgICB0aGlzLmluc3RhbmNlID0gdC5pbnN0YW5jZSwgdGhpcy5tb2R1bGUgPSB0Lm1vZHVsZSwgdGhpcy5tZW1vcnkgPSB0aGlzLmluc3RhbmNlLmV4cG9ydHMubWVtb3J5LCB0aGlzLmluaXRpYWxpemVkID0gITAKICAgICAgICB9CiAgICAgICAgc3RhcnQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkgdGhyb3cgbmV3IEVycm9yKCJXQVNJIG11c3QgYmUgaW5pdGlhbGl6ZWQgd2l0aCBpbml0KHdhc20pIGZpcnN0Iik7CiAgICAgICAgICAgIGxldCBtZW1idWZ2aWV3ID0gbmV3IFVpbnQzMkFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgIG1lbWJ1ZnZpZXcuZmlsbCgweGRlYWRiZWVmLCAtMTYzODQpOyAvLyA2NCBrQiAoZGl2aWRlZCBieSA0KQogICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5pbnN0YW5jZS5leHBvcnRzLl9zdGFydDsKICAgICAgICAgICAgY29uc3Qgc2EgPSAoKSA9PiB0aGlzLmluc3RhbmNlLmV4cG9ydHMudHJhaW5lcl9hbGxvY19jYWxscyA/IHRoaXMuaW5zdGFuY2UuZXhwb3J0cy50cmFpbmVyX2FsbG9jX2NhbGxzKCkgOiAwCiAgICAgICAgICAgIGNvbnN0IHNmID0gKCkgPT4gdGhpcy5pbnN0YW5jZS5leHBvcnRzLnRyYWluZXJfZnJlZV9jYWxscyA/IHRoaXMuaW5zdGFuY2UuZXhwb3J0cy50cmFpbmVyX2ZyZWVfY2FsbHMoKSA6IDAKCiAgICAgICAgICAgIGNvbnN0IHJlYWRTdHIgPSAocG9zKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgcmVhZFBvcyA9IHBvcwogICAgICAgICAgICAgICAgbGV0IG1lbXZpZXcgPSBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIpCiAgICAgICAgICAgICAgICBsZXQgY2hhcmxpbWl0ID0gODE5MgogICAgICAgICAgICAgICAgd2hpbGUgKCAtLWNoYXJsaW1pdCA+IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hyID0gbWVtdmlld1tyZWFkUG9zKytdCiAgICAgICAgICAgICAgICAgICAgaWYgKGNociA9PT0gMCkgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKG1lbXZpZXcuc3ViYXJyYXkocG9zLCByZWFkUG9zKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3Qgc3RwID0gKCkgPT4gdGhpcy5pbnN0YW5jZS5leHBvcnRzLnRyYWluZXJfdGVzdHNfcGFzc2VkID8gdGhpcy5pbnN0YW5jZS5leHBvcnRzLnRyYWluZXJfdGVzdHNfcGFzc2VkKCkgOiAwCiAgICAgICAgICAgIGNvbnN0IHN0dCA9ICgpID0+IHRoaXMuaW5zdGFuY2UuZXhwb3J0cy50cmFpbmVyX3Rlc3RzX3RvdGFsID8gdGhpcy5pbnN0YW5jZS5leHBvcnRzLnRyYWluZXJfdGVzdHNfdG90YWwoKSA6IDAKCiAgICAgICAgICAgIGNvbnN0IHN0aSA9ICgpID0+IHRoaXMuaW5zdGFuY2UuZXhwb3J0cy50cmFpbmVyX2lucHV0ID8gcmVhZFN0cih0aGlzLmluc3RhbmNlLmV4cG9ydHMudHJhaW5lcl9pbnB1dCgpKSA6ICIiCiAgICAgICAgICAgIGNvbnN0IHN0byA9ICgpID0+IHRoaXMuaW5zdGFuY2UuZXhwb3J0cy50cmFpbmVyX291dHB1dCA/IHJlYWRTdHIodGhpcy5pbnN0YW5jZS5leHBvcnRzLnRyYWluZXJfb3V0cHV0KCkpIDogIiIKICAgICAgICAgICAgY29uc3Qgc3RyID0gKCkgPT4gdGhpcy5pbnN0YW5jZS5leHBvcnRzLnRyYWluZXJfcmVmID8gcmVhZFN0cih0aGlzLmluc3RhbmNlLmV4cG9ydHMudHJhaW5lcl9yZWYoKSkgOiAiIgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdCgpCiAgICAgICAgICAgIH0gY2F0Y2ggKGkpIHsKICAgICAgICAgICAgICAgIGlmIChpIGluc3RhbmNlb2YgWCkgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBleGl0Q29kZTogaS5jb2RlLAogICAgICAgICAgICAgICAgICAgIGFsbG9jQ2FsbHM6IHNhKCksIGZyZWVDYWxsczogc2YoKSwKICAgICAgICAgICAgICAgICAgICB0ZXN0c1Bhc3NlZDogc3RwKCksIHRlc3RzVG90YWw6IHN0dCgpLAogICAgICAgICAgICAgICAgICAgIGlucHV0OiBzdGkoKSwgb3V0cHV0OiBzdG8oKSwgcmVmOiBzdHIoKSwKICAgICAgICAgICAgICAgICAgICBmczogdGhpcy5kcml2ZS5mcwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGlmIChpIGluc3RhbmNlb2YgV2ViQXNzZW1ibHkuUnVudGltZUVycm9yKSByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGV4aXRDb2RlOiAxMzQsCiAgICAgICAgICAgICAgICAgICAgYWxsb2NDYWxsczogc2EoKSwgZnJlZUNhbGxzOiBzZigpLAogICAgICAgICAgICAgICAgICAgIHRlc3RzUGFzc2VkOiBzdHAoKSwgdGVzdHNUb3RhbDogc3R0KCksCiAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IHN0aSgpLCBvdXRwdXQ6IHN0bygpLCByZWY6IHN0cigpLAogICAgICAgICAgICAgICAgICAgIGZzOiB0aGlzLmRyaXZlLmZzCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdGhyb3cgaQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBleGl0Q29kZTogMCwKICAgICAgICAgICAgICAgIGFsbG9jQ2FsbHM6IHNhKCksIGZyZWVDYWxsczogc2YoKSwKICAgICAgICAgICAgICAgIHRlc3RzUGFzc2VkOiBzdHAoKSwgdGVzdHNUb3RhbDogc3R0KCksCiAgICAgICAgICAgICAgICBpbnB1dDogc3RpKCksIG91dHB1dDogc3RvKCksIHJlZjogc3RyKCksCiAgICAgICAgICAgICAgICBmczogdGhpcy5kcml2ZS5mcwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGdldEltcG9ydHModCwgaSkgewogICAgICAgICAgICBjb25zdCBuID0gewogICAgICAgICAgICAgICAgYXJnc19nZXQ6IHRoaXMuYXJnc19nZXQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGFyZ3Nfc2l6ZXNfZ2V0OiB0aGlzLmFyZ3Nfc2l6ZXNfZ2V0LmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBjbG9ja19yZXNfZ2V0OiB0aGlzLmNsb2NrX3Jlc19nZXQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGNsb2NrX3RpbWVfZ2V0OiB0aGlzLmNsb2NrX3RpbWVfZ2V0LmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBlbnZpcm9uX2dldDogdGhpcy5lbnZpcm9uX2dldC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgZW52aXJvbl9zaXplc19nZXQ6IHRoaXMuZW52aXJvbl9zaXplc19nZXQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHByb2NfZXhpdDogdGhpcy5wcm9jX2V4aXQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHJhbmRvbV9nZXQ6IHRoaXMucmFuZG9tX2dldC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgc2NoZWRfeWllbGQ6IHRoaXMuc2NoZWRfeWllbGQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGZkX2FkdmlzZTogdGhpcy5mZF9hZHZpc2UuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGZkX2FsbG9jYXRlOiB0aGlzLmZkX2FsbG9jYXRlLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBmZF9jbG9zZTogdGhpcy5mZF9jbG9zZS5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgZmRfZGF0YXN5bmM6IHRoaXMuZmRfZGF0YXN5bmMuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGZkX2Zkc3RhdF9nZXQ6IHRoaXMuZmRfZmRzdGF0X2dldC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgZmRfZmRzdGF0X3NldF9mbGFnczogdGhpcy5mZF9mZHN0YXRfc2V0X2ZsYWdzLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBmZF9mZHN0YXRfc2V0X3JpZ2h0czogdGhpcy5mZF9mZHN0YXRfc2V0X3JpZ2h0cy5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgZmRfZmlsZXN0YXRfZ2V0OiB0aGlzLmZkX2ZpbGVzdGF0X2dldC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgZmRfZmlsZXN0YXRfc2V0X3NpemU6IHRoaXMuZmRfZmlsZXN0YXRfc2V0X3NpemUuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGZkX2ZpbGVzdGF0X3NldF90aW1lczogdGhpcy5mZF9maWxlc3RhdF9zZXRfdGltZXMuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGZkX3ByZWFkOiB0aGlzLmZkX3ByZWFkLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBmZF9wcmVzdGF0X2Rpcl9uYW1lOiB0aGlzLmZkX3ByZXN0YXRfZGlyX25hbWUuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGZkX3ByZXN0YXRfZ2V0OiB0aGlzLmZkX3ByZXN0YXRfZ2V0LmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBmZF9wd3JpdGU6IHRoaXMuZmRfcHdyaXRlLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBmZF9yZWFkOiB0aGlzLmZkX3JlYWQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGZkX3JlYWRkaXI6IHRoaXMuZmRfcmVhZGRpci5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgZmRfcmVudW1iZXI6IHRoaXMuZmRfcmVudW1iZXIuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGZkX3NlZWs6IHRoaXMuZmRfc2Vlay5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgZmRfc3luYzogdGhpcy5mZF9zeW5jLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBmZF90ZWxsOiB0aGlzLmZkX3RlbGwuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIGZkX3dyaXRlOiB0aGlzLmZkX3dyaXRlLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBwYXRoX2ZpbGVzdGF0X2dldDogdGhpcy5wYXRoX2ZpbGVzdGF0X2dldC5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgcGF0aF9maWxlc3RhdF9zZXRfdGltZXM6IHRoaXMucGF0aF9maWxlc3RhdF9zZXRfdGltZXMuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHBhdGhfb3BlbjogdGhpcy5wYXRoX29wZW4uYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHBhdGhfcmVuYW1lOiB0aGlzLnBhdGhfcmVuYW1lLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBwYXRoX3VubGlua19maWxlOiB0aGlzLnBhdGhfdW5saW5rX2ZpbGUuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHBhdGhfY3JlYXRlX2RpcmVjdG9yeTogdGhpcy5wYXRoX2NyZWF0ZV9kaXJlY3RvcnkuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHBhdGhfbGluazogdGhpcy5wYXRoX2xpbmsuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHBhdGhfcmVhZGxpbms6IHRoaXMucGF0aF9yZWFkbGluay5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgcGF0aF9yZW1vdmVfZGlyZWN0b3J5OiB0aGlzLnBhdGhfcmVtb3ZlX2RpcmVjdG9yeS5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgcGF0aF9zeW1saW5rOiB0aGlzLnBhdGhfc3ltbGluay5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgcG9sbF9vbmVvZmY6IHRoaXMucG9sbF9vbmVvZmYuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHByb2NfcmFpc2U6IHRoaXMucHJvY19yYWlzZS5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgc29ja19hY2NlcHQ6IHRoaXMuc29ja19hY2NlcHQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHNvY2tfcmVjdjogdGhpcy5zb2NrX3JlY3YuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHNvY2tfc2VuZDogdGhpcy5zb2NrX3NlbmQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHNvY2tfc2h1dGRvd246IHRoaXMuc29ja19zaHV0ZG93bi5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgc29ja19vcGVuOiB0aGlzLnNvY2tfb3Blbi5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgc29ja19saXN0ZW46IHRoaXMuc29ja19saXN0ZW4uYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHNvY2tfY29ubmVjdDogdGhpcy5zb2NrX2Nvbm5lY3QuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHNvY2tfc2V0c29ja29wdDogdGhpcy5zb2NrX3NldHNvY2tvcHQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHNvY2tfYmluZDogdGhpcy5zb2NrX2JpbmQuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHNvY2tfZ2V0bG9jYWxhZGRyOiB0aGlzLnNvY2tfZ2V0bG9jYWxhZGRyLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICBzb2NrX2dldHBlZXJhZGRyOiB0aGlzLnNvY2tfZ2V0cGVlcmFkZHIuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgIHNvY2tfZ2V0YWRkcmluZm86IHRoaXMuc29ja19nZXRhZGRyaW5mby5iaW5kKHRoaXMpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHQgPT09ICJ1bnN0YWJsZSIgJiYgKG4ucGF0aF9maWxlc3RhdF9nZXQgPSB0aGlzLnVuc3RhYmxlX3BhdGhfZmlsZXN0YXRfZ2V0LmJpbmQodGhpcyksIG4uZmRfZmlsZXN0YXRfZ2V0ID0gdGhpcy51bnN0YWJsZV9mZF9maWxlc3RhdF9nZXQuYmluZCh0aGlzKSwgbi5mZF9zZWVrID0gdGhpcy51bnN0YWJsZV9mZF9zZWVrLmJpbmQodGhpcykpOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtzLCBhXSBvZiBPYmplY3QuZW50cmllcyhuKSkgbltzXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgbGV0IGYgPSBhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICBpZiAoaSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBldCgpOwogICAgICAgICAgICAgICAgICAgIGYgPSBpKHMsIFsuLi5hcmd1bWVudHNdLCBmLCBjKSA/PyBmCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gbgogICAgICAgIH0KICAgICAgICBnZXQgZW52QXJyYXkoKSB7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuZW50cmllcyh0aGlzLmNvbnRleHQuZW52KS5tYXAoKFt0LCBpXSkgPT4gYCR7dH09JHtpfWApCiAgICAgICAgfQogICAgICAgIGFyZ3NfZ2V0KHQsIGkpIHsKICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdGhpcy5jb250ZXh0LmFyZ3MpIHsKICAgICAgICAgICAgICAgIG4uc2V0VWludDMyKHQsIGksICEwKSwgdCArPSA0OwogICAgICAgICAgICAgICAgY29uc3QgYSA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShgJHtzfVwwYCk7CiAgICAgICAgICAgICAgICBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsIGksIGEuYnl0ZUxlbmd0aCkuc2V0KGEpLCBpICs9IGEuYnl0ZUxlbmd0aAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByLlNVQ0NFU1MKICAgICAgICB9CiAgICAgICAgYXJnc19zaXplc19nZXQodCwgaSkgewogICAgICAgICAgICBjb25zdCBuID0gdGhpcy5jb250ZXh0LmFyZ3MsCiAgICAgICAgICAgICAgICBzID0gbi5yZWR1Y2UoKGYsIGMpID0+IGYgKyBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoYCR7Y31cMGApLmJ5dGVMZW5ndGgsIDApLAogICAgICAgICAgICAgICAgYSA9IG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICByZXR1cm4gYS5zZXRVaW50MzIodCwgbi5sZW5ndGgsICEwKSwgYS5zZXRVaW50MzIoaSwgcywgITApLCByLlNVQ0NFU1MKICAgICAgICB9CiAgICAgICAgY2xvY2tfcmVzX2dldCh0LCBpKSB7CiAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgY2FzZSBULlJFQUxUSU1FOgogICAgICAgICAgICAgICAgY2FzZSBULk1PTk9UT05JQzoKICAgICAgICAgICAgICAgIGNhc2UgVC5QUk9DRVNTX0NQVVRJTUVfSUQ6CiAgICAgICAgICAgICAgICBjYXNlIFQuVEhSRUFEX0NQVVRJTUVfSUQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpLnNldEJpZ1VpbnQ2NChpLCBCaWdJbnQoMWU2KSwgITApLCByLlNVQ0NFU1MKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gci5FSU5WQUwKICAgICAgICB9CiAgICAgICAgY2xvY2tfdGltZV9nZXQodCwgaSwgbikgewogICAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgVC5SRUFMVElNRToKICAgICAgICAgICAgICAgIGNhc2UgVC5NT05PVE9OSUM6CiAgICAgICAgICAgICAgICBjYXNlIFQuUFJPQ0VTU19DUFVUSU1FX0lEOgogICAgICAgICAgICAgICAgY2FzZSBULlRIUkVBRF9DUFVUSU1FX0lEOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKS5zZXRCaWdVaW50NjQobiwgeShuZXcgRGF0ZSksICEwKSwgci5TVUNDRVNTCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHIuRUlOVkFMCiAgICAgICAgfQogICAgICAgIGVudmlyb25fZ2V0KHQsIGkpIHsKICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdGhpcy5lbnZBcnJheSkgewogICAgICAgICAgICAgICAgbi5zZXRVaW50MzIodCwgaSwgITApLCB0ICs9IDQ7CiAgICAgICAgICAgICAgICBjb25zdCBhID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGAke3N9XDBgKTsKICAgICAgICAgICAgICAgIG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlciwgaSwgYS5ieXRlTGVuZ3RoKS5zZXQoYSksIGkgKz0gYS5ieXRlTGVuZ3RoCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHIuU1VDQ0VTUwogICAgICAgIH0KICAgICAgICBlbnZpcm9uX3NpemVzX2dldCh0LCBpKSB7CiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLmVudkFycmF5LnJlZHVjZSgoYSwgZikgPT4gYSArIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShgJHtmfVwwYCkuYnl0ZUxlbmd0aCwgMCksCiAgICAgICAgICAgICAgICBzID0gbmV3IERhdGFWaWV3KHRoaXMubWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgIHJldHVybiBzLnNldFVpbnQzMih0LCB0aGlzLmVudkFycmF5Lmxlbmd0aCwgITApLCBzLnNldFVpbnQzMihpLCBuLCAhMCksIHIuU1VDQ0VTUwogICAgICAgIH0KICAgICAgICBwcm9jX2V4aXQodCkgewogICAgICAgICAgICB0aHJvdyBuZXcgWCh0KQogICAgICAgIH0KICAgICAgICByYW5kb21fZ2V0KHQsIGkpIHsKICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlciwgdCwgaSk7CiAgICAgICAgICAgIHJldHVybiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKG4pLCByLlNVQ0NFU1MKICAgICAgICB9CiAgICAgICAgc2NoZWRfeWllbGQoKSB7CiAgICAgICAgICAgIHJldHVybiByLlNVQ0NFU1MKICAgICAgICB9CiAgICAgICAgZmRfcmVhZCh0LCBpLCBuLCBzKSB7CiAgICAgICAgICAgIGlmICh0ID09PSAxIHx8IHQgPT09IDIpIHJldHVybiByLkVOT1RTVVA7CiAgICAgICAgICAgIGNvbnN0IGEgPSBuZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKSwKICAgICAgICAgICAgICAgIGYgPSB2KGEsIGksIG4pLAogICAgICAgICAgICAgICAgYyA9IG5ldyBUZXh0RW5jb2RlcjsKICAgICAgICAgICAgbGV0IG8gPSAwLAogICAgICAgICAgICAgICAgRSA9IHIuU1VDQ0VTUzsKICAgICAgICAgICAgZm9yIChjb25zdCBoIG9mIGYpIHsKICAgICAgICAgICAgICAgIGxldCBTOwogICAgICAgICAgICAgICAgaWYgKHQgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBDID0gdGhpcy5jb250ZXh0LnN0ZGluKGguYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFDKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBTID0gYy5lbmNvZGUoQykKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW0MsIGxdID0gdGhpcy5kcml2ZS5yZWFkKHQsIGguYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKEMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgRSA9IEM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIFMgPSBsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBnID0gTWF0aC5taW4oaC5ieXRlTGVuZ3RoLCBTLmJ5dGVMZW5ndGgpOwogICAgICAgICAgICAgICAgaC5zZXQoUy5zdWJhcnJheSgwLCBnKSksIG8gKz0gZwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBVKHsKICAgICAgICAgICAgICAgIGJ5dGVzUmVhZDogbwogICAgICAgICAgICB9KSwgYS5zZXRVaW50MzIocywgbywgITApLCBFCiAgICAgICAgfQogICAgICAgIGZkX3dyaXRlKHQsIGksIG4sIHMpIHsKICAgICAgICAgICAgaWYgKHQgPT09IDApIHJldHVybiByLkVOT1RTVVA7CiAgICAgICAgICAgIGNvbnN0IGEgPSBuZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKSwKICAgICAgICAgICAgICAgIGYgPSB2KGEsIGksIG4pLAogICAgICAgICAgICAgICAgYyA9IG5ldyBUZXh0RGVjb2RlcjsKICAgICAgICAgICAgbGV0IG8gPSAwLAogICAgICAgICAgICAgICAgRSA9IHIuU1VDQ0VTUzsKICAgICAgICAgICAgZm9yIChjb25zdCBoIG9mIGYpCiAgICAgICAgICAgICAgICBpZiAoaC5ieXRlTGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHQgPT09IDEgfHwgdCA9PT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBTID0gdCA9PT0gMSA/IHRoaXMuY29udGV4dC5zdGRvdXQgOiB0aGlzLmNvbnRleHQuc3RkZXJyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGMuZGVjb2RlKGgpOwogICAgICAgICAgICAgICAgICAgICAgICBTKGcpLCBVKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dDogZwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoRSA9IHRoaXMuZHJpdmUud3JpdGUodCwgaCksIEUgIT0gci5TVUNDRVNTKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBvICs9IGguYnl0ZUxlbmd0aAogICAgICAgICAgICAgICAgfSByZXR1cm4gYS5zZXRVaW50MzIocywgbywgITApLCBFCiAgICAgICAgfQogICAgICAgIGZkX2FkdmlzZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHIuU1VDQ0VTUwogICAgICAgIH0KICAgICAgICBmZF9hbGxvY2F0ZSh0LCBpLCBuKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRyaXZlLnB3cml0ZSh0LCBuZXcgVWludDhBcnJheShOdW1iZXIobikpLCBOdW1iZXIoaSkpCiAgICAgICAgfQogICAgICAgIGZkX2Nsb3NlKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZHJpdmUuY2xvc2UodCkKICAgICAgICB9CiAgICAgICAgZmRfZGF0YXN5bmModCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5kcml2ZS5zeW5jKHQpCiAgICAgICAgfQogICAgICAgIGZkX2Zkc3RhdF9nZXQodCwgaSkgewogICAgICAgICAgICBpZiAodCA8IDMpIHsKICAgICAgICAgICAgICAgIGxldCBjOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udGV4dC5pc1RUWSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IEUgPSB4IF4gXy5GRF9TRUVLIF4gXy5GRF9URUxMOwogICAgICAgICAgICAgICAgICAgIGMgPSBWKEEuQ0hBUkFDVEVSX0RFVklDRSwgMCwgRSkKICAgICAgICAgICAgICAgIH0gZWxzZSBjID0gVihBLkNIQVJBQ1RFUl9ERVZJQ0UsIDApOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlciwgaSwgYy5ieXRlTGVuZ3RoKS5zZXQoYyksIHIuU1VDQ0VTUwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5kcml2ZS5leGlzdHModCkpIHJldHVybiByLkVCQURGOwogICAgICAgICAgICBjb25zdCBuID0gdGhpcy5kcml2ZS5maWxlVHlwZSh0KSwKICAgICAgICAgICAgICAgIHMgPSB0aGlzLmRyaXZlLmZpbGVGZGZsYWdzKHQpLAogICAgICAgICAgICAgICAgYSA9IFYobiwgcyk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsIGksIGEuYnl0ZUxlbmd0aCkuc2V0KGEpLCByLlNVQ0NFU1MKICAgICAgICB9CiAgICAgICAgZmRfZmRzdGF0X3NldF9mbGFncyh0LCBpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRyaXZlLnNldEZsYWdzKHQsIGkpCiAgICAgICAgfQogICAgICAgIGZkX2Zkc3RhdF9zZXRfcmlnaHRzKCkgewogICAgICAgICAgICByZXR1cm4gci5TVUNDRVNTCiAgICAgICAgfQogICAgICAgIGZkX2ZpbGVzdGF0X2dldCh0LCBpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNoYXJlZF9mZF9maWxlc3RhdF9nZXQodCwgaSwgInByZXZpZXcxIikKICAgICAgICB9CiAgICAgICAgdW5zdGFibGVfZmRfZmlsZXN0YXRfZ2V0KHQsIGkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hhcmVkX2ZkX2ZpbGVzdGF0X2dldCh0LCBpLCAidW5zdGFibGUiKQogICAgICAgIH0KICAgICAgICBzaGFyZWRfZmRfZmlsZXN0YXRfZ2V0KHQsIGksIG4pIHsKICAgICAgICAgICAgY29uc3QgcyA9IG4gPT09ICJ1bnN0YWJsZSIgPyBaIDogajsKICAgICAgICAgICAgaWYgKHQgPCAzKSB7CiAgICAgICAgICAgICAgICBsZXQgRTsKICAgICAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgRSA9ICIvZGV2L3N0ZGluIjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICBFID0gIi9kZXYvc3Rkb3V0IjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICBFID0gIi9kZXYvc3RkZXJyIjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgRSA9ICIvZGV2L3VuZGVmaW5lZCI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBoID0gcyh7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogRSwKICAgICAgICAgICAgICAgICAgICBieXRlTGVuZ3RoOiAwLAogICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzOiBuZXcgRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpY2F0aW9uOiBuZXcgRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlOiBuZXcgRGF0ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdHlwZTogQS5DSEFSQUNURVJfREVWSUNFCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsIGksIGguYnl0ZUxlbmd0aCkuc2V0KGgpLCByLlNVQ0NFU1MKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBbYSwgZl0gPSB0aGlzLmRyaXZlLnN0YXQodCk7CiAgICAgICAgICAgIGlmIChhICE9IHIuU1VDQ0VTUykgcmV0dXJuIGE7CiAgICAgICAgICAgIFUoewogICAgICAgICAgICAgICAgcmVzb2x2ZWRQYXRoOiBmLnBhdGgsCiAgICAgICAgICAgICAgICBzdGF0OiBmCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBjID0gcyhmKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlciwgaSwgYy5ieXRlTGVuZ3RoKS5zZXQoYyksIHIuU1VDQ0VTUwogICAgICAgIH0KICAgICAgICBmZF9maWxlc3RhdF9zZXRfc2l6ZSh0LCBpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRyaXZlLnNldFNpemUodCwgaSkKICAgICAgICB9CiAgICAgICAgZmRfZmlsZXN0YXRfc2V0X3RpbWVzKHQsIGksIG4sIHMpIHsKICAgICAgICAgICAgbGV0IGEgPSBudWxsOwogICAgICAgICAgICBzICYgbS5BVElNICYmIChhID0gcChpKSksIHMgJiBtLkFUSU1fTk9XICYmIChhID0gbmV3IERhdGUpOwogICAgICAgICAgICBsZXQgZiA9IG51bGw7CiAgICAgICAgICAgIGlmIChzICYgbS5NVElNICYmIChmID0gcChuKSksIHMgJiBtLk1USU1fTk9XICYmIChmID0gbmV3IERhdGUpLCBhKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gdGhpcy5kcml2ZS5zZXRBY2Nlc3NUaW1lKHQsIGEpOwogICAgICAgICAgICAgICAgaWYgKGMgIT0gci5TVUNDRVNTKSByZXR1cm4gYwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gdGhpcy5kcml2ZS5zZXRNb2RpZmljYXRpb25UaW1lKHQsIGYpOwogICAgICAgICAgICAgICAgaWYgKGMgIT0gci5TVUNDRVNTKSByZXR1cm4gYwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByLlNVQ0NFU1MKICAgICAgICB9CiAgICAgICAgZmRfcHJlYWQodCwgaSwgbiwgcywgYSkgewogICAgICAgICAgICBpZiAodCA9PT0gMSB8fCB0ID09PSAyKSByZXR1cm4gci5FTk9UU1VQOwogICAgICAgICAgICBpZiAodCA9PT0gMCkgcmV0dXJuIHRoaXMuZmRfcmVhZCh0LCBpLCBuLCBhKTsKICAgICAgICAgICAgY29uc3QgZiA9IG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpLAogICAgICAgICAgICAgICAgYyA9IHYoZiwgaSwgbik7CiAgICAgICAgICAgIGxldCBvID0gMCwKICAgICAgICAgICAgICAgIEUgPSByLlNVQ0NFU1M7CiAgICAgICAgICAgIGZvciAoY29uc3QgaCBvZiBjKSB7CiAgICAgICAgICAgICAgICBjb25zdCBbUywgZ10gPSB0aGlzLmRyaXZlLnByZWFkKHQsIGguYnl0ZUxlbmd0aCwgTnVtYmVyKHMpICsgbyk7CiAgICAgICAgICAgICAgICBpZiAoUyAhPT0gci5TVUNDRVNTKSB7CiAgICAgICAgICAgICAgICAgICAgRSA9IFM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IEMgPSBNYXRoLm1pbihoLmJ5dGVMZW5ndGgsIGcuYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICBoLnNldChnLnN1YmFycmF5KDAsIEMpKSwgbyArPSBDCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGYuc2V0VWludDMyKGEsIG8sICEwKSwgRQogICAgICAgIH0KICAgICAgICBmZF9wcmVzdGF0X2Rpcl9uYW1lKHQsIGksIG4pIHsKICAgICAgICAgICAgaWYgKHQgIT09IDMpIHJldHVybiByLkVCQURGOwogICAgICAgICAgICBjb25zdCBzID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKCIvIik7CiAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsIGksIG4pLnNldChzLnN1YmFycmF5KDAsIG4pKSwgci5TVUNDRVNTCiAgICAgICAgfQogICAgICAgIGZkX3ByZXN0YXRfZ2V0KHQsIGkpIHsKICAgICAgICAgICAgaWYgKHQgIT09IDMpIHJldHVybiByLkVCQURGOwogICAgICAgICAgICBjb25zdCBuID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKCIuIiksCiAgICAgICAgICAgICAgICBzID0gbmV3IERhdGFWaWV3KHRoaXMubWVtb3J5LmJ1ZmZlciwgaSk7CiAgICAgICAgICAgIHJldHVybiBzLnNldFVpbnQ4KDAsIEcuRElSKSwgcy5zZXRVaW50MzIoNCwgbi5ieXRlTGVuZ3RoLCAhMCksIHIuU1VDQ0VTUwogICAgICAgIH0KICAgICAgICBmZF9wd3JpdGUodCwgaSwgbiwgcywgYSkgewogICAgICAgICAgICBpZiAodCA9PT0gMCkgcmV0dXJuIHIuRU5PVFNVUDsKICAgICAgICAgICAgaWYgKHQgPT09IDEgfHwgdCA9PT0gMikgcmV0dXJuIHRoaXMuZmRfd3JpdGUodCwgaSwgbiwgYSk7CiAgICAgICAgICAgIGNvbnN0IGYgPSBuZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKSwKICAgICAgICAgICAgICAgIGMgPSB2KGYsIGksIG4pOwogICAgICAgICAgICBsZXQgbyA9IDAsCiAgICAgICAgICAgICAgICBFID0gci5TVUNDRVNTOwogICAgICAgICAgICBmb3IgKGNvbnN0IGggb2YgYykKICAgICAgICAgICAgICAgIGlmIChoLmJ5dGVMZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoRSA9IHRoaXMuZHJpdmUucHdyaXRlKHQsIGgsIE51bWJlcihzKSksIEUgIT0gci5TVUNDRVNTKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBvICs9IGguYnl0ZUxlbmd0aAogICAgICAgICAgICAgICAgfSByZXR1cm4gZi5zZXRVaW50MzIoYSwgbywgITApLCBFCiAgICAgICAgfQogICAgICAgIGZkX3JlYWRkaXIodCwgaSwgbiwgcywgYSkgewogICAgICAgICAgICBjb25zdCBbZiwgY10gPSB0aGlzLmRyaXZlLmxpc3QodCk7CiAgICAgICAgICAgIGlmIChmICE9IHIuU1VDQ0VTUykgcmV0dXJuIGY7CiAgICAgICAgICAgIGxldCBvID0gW10sCiAgICAgICAgICAgICAgICBFID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgICAgICAgICBuYW1lOiB3LAogICAgICAgICAgICAgICAgdHlwZTogRgogICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvZiBjKSB7CiAgICAgICAgICAgICAgICBjb25zdCBLID0gbnQodywgRiwgRSk7CiAgICAgICAgICAgICAgICBvLnB1c2goSyksIEUrKwogICAgICAgICAgICB9CiAgICAgICAgICAgIG8gPSBvLnNsaWNlKE51bWJlcihzKSk7CiAgICAgICAgICAgIGNvbnN0IGggPSBvLnJlZHVjZSgodywgRikgPT4gdyArIEYuYnl0ZUxlbmd0aCwgMCksCiAgICAgICAgICAgICAgICBTID0gbmV3IFVpbnQ4QXJyYXkoaCk7CiAgICAgICAgICAgIGxldCBnID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCB3IG9mIG8pIFMuc2V0KHcsIGcpLCBnICs9IHcuYnl0ZUxlbmd0aDsKICAgICAgICAgICAgY29uc3QgQyA9IG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlciwgaSwgbiksCiAgICAgICAgICAgICAgICBsID0gUy5zdWJhcnJheSgwLCBuKTsKICAgICAgICAgICAgcmV0dXJuIEMuc2V0KGwpLCBuZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKS5zZXRVaW50MzIoYSwgbC5ieXRlTGVuZ3RoLCAhMCksIHIuU1VDQ0VTUwogICAgICAgIH0KICAgICAgICBmZF9yZW51bWJlcih0LCBpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRyaXZlLnJlbnVtYmVyKHQsIGkpCiAgICAgICAgfQogICAgICAgIGZkX3NlZWsodCwgaSwgbiwgcykgewogICAgICAgICAgICBjb25zdCBbYSwgZl0gPSB0aGlzLmRyaXZlLnNlZWsodCwgaSwgbik7CiAgICAgICAgICAgIHJldHVybiBhICE9PSByLlNVQ0NFU1MgfHwgKFUoewogICAgICAgICAgICAgICAgbmV3T2Zmc2V0OiBmLnRvU3RyaW5nKCkKICAgICAgICAgICAgfSksIG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpLnNldEJpZ1VpbnQ2NChzLCBmLCAhMCkpLCBhCiAgICAgICAgfQogICAgICAgIHVuc3RhYmxlX2ZkX3NlZWsodCwgaSwgbiwgcykgewogICAgICAgICAgICBjb25zdCBhID0gc3Rbbl07CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZkX3NlZWsodCwgaSwgYSwgcykKICAgICAgICB9CiAgICAgICAgZmRfc3luYyh0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRyaXZlLnN5bmModCkKICAgICAgICB9CiAgICAgICAgZmRfdGVsbCh0LCBpKSB7CiAgICAgICAgICAgIGNvbnN0IFtuLCBzXSA9IHRoaXMuZHJpdmUudGVsbCh0KTsKICAgICAgICAgICAgcmV0dXJuIG4gIT09IHIuU1VDQ0VTUyB8fCBuZXcgRGF0YVZpZXcodGhpcy5tZW1vcnkuYnVmZmVyKS5zZXRCaWdVaW50NjQoaSwgcywgITApLCBuCiAgICAgICAgfQogICAgICAgIHBhdGhfZmlsZXN0YXRfZ2V0KHQsIGksIG4sIHMsIGEpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hhcmVkX3BhdGhfZmlsZXN0YXRfZ2V0KHQsIGksIG4sIHMsIGEsICJwcmV2aWV3MSIpCiAgICAgICAgfQogICAgICAgIHVuc3RhYmxlX3BhdGhfZmlsZXN0YXRfZ2V0KHQsIGksIG4sIHMsIGEpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hhcmVkX3BhdGhfZmlsZXN0YXRfZ2V0KHQsIGksIG4sIHMsIGEsICJ1bnN0YWJsZSIpCiAgICAgICAgfQogICAgICAgIHNoYXJlZF9wYXRoX2ZpbGVzdGF0X2dldCh0LCBpLCBuLCBzLCBhLCBmKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSBmID09PSAidW5zdGFibGUiID8gWiA6IGosCiAgICAgICAgICAgICAgICBvID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlciwgbiwgcykpOwogICAgICAgICAgICBVKHsKICAgICAgICAgICAgICAgIHBhdGg6IG8KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IFtFLCBoXSA9IHRoaXMuZHJpdmUucGF0aFN0YXQodCwgbyk7CiAgICAgICAgICAgIGlmIChFICE9IHIuU1VDQ0VTUykgcmV0dXJuIEU7CiAgICAgICAgICAgIGNvbnN0IFMgPSBjKGgpOwogICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkodGhpcy5tZW1vcnkuYnVmZmVyLCBhLCBTLmJ5dGVMZW5ndGgpLnNldChTKSwgRQogICAgICAgIH0KICAgICAgICBwYXRoX2ZpbGVzdGF0X3NldF90aW1lcyh0LCBpLCBuLCBzLCBhLCBmLCBjKSB7CiAgICAgICAgICAgIGxldCBvID0gbnVsbDsKICAgICAgICAgICAgYyAmIG0uQVRJTSAmJiAobyA9IHAoYSkpLCBjICYgbS5BVElNX05PVyAmJiAobyA9IG5ldyBEYXRlKTsKICAgICAgICAgICAgbGV0IEUgPSBudWxsOwogICAgICAgICAgICBjICYgbS5NVElNICYmIChFID0gcChmKSksIGMgJiBtLk1USU1fTk9XICYmIChFID0gbmV3IERhdGUpOwogICAgICAgICAgICBjb25zdCBoID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlciwgbiwgcykpOwogICAgICAgICAgICBpZiAobykgewogICAgICAgICAgICAgICAgY29uc3QgUyA9IHRoaXMuZHJpdmUucGF0aFNldEFjY2Vzc1RpbWUodCwgaCwgbyk7CiAgICAgICAgICAgICAgICBpZiAoUyAhPSByLlNVQ0NFU1MpIHJldHVybiBTCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IFMgPSB0aGlzLmRyaXZlLnBhdGhTZXRNb2RpZmljYXRpb25UaW1lKHQsIGgsIEUpOwogICAgICAgICAgICAgICAgaWYgKFMgIT0gci5TVUNDRVNTKSByZXR1cm4gUwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByLlNVQ0NFU1MKICAgICAgICB9CiAgICAgICAgcGF0aF9vcGVuKHQsIGksIG4sIHMsIGEsIGYsIGMsIG8sIEUpIHsKICAgICAgICAgICAgY29uc3QgaCA9IG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIpLAogICAgICAgICAgICAgICAgUyA9IEIodGhpcy5tZW1vcnksIG4sIHMpLAogICAgICAgICAgICAgICAgZyA9ICEhKGEgJiBOLkNSRUFUKSwKICAgICAgICAgICAgICAgIEMgPSAhIShhICYgTi5ESVJFQ1RPUlkpLAogICAgICAgICAgICAgICAgbCA9ICEhKGEgJiBOLkVYQ0wpLAogICAgICAgICAgICAgICAgSiA9ICEhKGEgJiBOLlRSVU5DKSwKICAgICAgICAgICAgICAgIHcgPSAhIShvICYgTy5BUFBFTkQpLAogICAgICAgICAgICAgICAgRiA9ICEhKG8gJiBPLkRTWU5DKSwKICAgICAgICAgICAgICAgIEsgPSAhIShvICYgTy5OT05CTE9DSyksCiAgICAgICAgICAgICAgICBTdCA9ICEhKG8gJiBPLlJTWU5DKSwKICAgICAgICAgICAgICAgIF90ID0gISEobyAmIE8uU1lOQyk7CiAgICAgICAgICAgIFUoewogICAgICAgICAgICAgICAgcGF0aDogUywKICAgICAgICAgICAgICAgIG9wZW5GbGFnczogewogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUZpbGVJZk5vbmU6IGcsCiAgICAgICAgICAgICAgICAgICAgZmFpbElmTm90RGlyOiBDLAogICAgICAgICAgICAgICAgICAgIGZhaWxJZkZpbGVFeGlzdHM6IGwsCiAgICAgICAgICAgICAgICAgICAgdHJ1bmNhdGVGaWxlOiBKCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZmlsZURlc2NyaXB0b3JGbGFnczogewogICAgICAgICAgICAgICAgICAgIGZsYWdBcHBlbmQ6IHcsCiAgICAgICAgICAgICAgICAgICAgZmxhZ0RTeW5jOiBGLAogICAgICAgICAgICAgICAgICAgIGZsYWdOb25CbG9jazogSywKICAgICAgICAgICAgICAgICAgICBmbGFnUlN5bmM6IFN0LAogICAgICAgICAgICAgICAgICAgIGZsYWdTeW5jOiBfdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgW1IsIGR0XSA9IHRoaXMuZHJpdmUub3Blbih0LCBTLCBhLCBvKTsKICAgICAgICAgICAgcmV0dXJuIFIgfHwgKGguc2V0VWludDMyKEUsIGR0LCAhMCksIFIpCiAgICAgICAgfQogICAgICAgIHBhdGhfcmVuYW1lKHQsIGksIG4sIHMsIGEsIGYpIHsKICAgICAgICAgICAgY29uc3QgYyA9IEIodGhpcy5tZW1vcnksIGksIG4pLAogICAgICAgICAgICAgICAgbyA9IEIodGhpcy5tZW1vcnksIGEsIGYpOwogICAgICAgICAgICByZXR1cm4gVSh7CiAgICAgICAgICAgICAgICBvbGRQYXRoOiBjLAogICAgICAgICAgICAgICAgbmV3UGF0aDogbwogICAgICAgICAgICB9KSwgdGhpcy5kcml2ZS5yZW5hbWUodCwgYywgcywgbykKICAgICAgICB9CiAgICAgICAgcGF0aF91bmxpbmtfZmlsZSh0LCBpLCBuKSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSBCKHRoaXMubWVtb3J5LCBpLCBuKTsKICAgICAgICAgICAgcmV0dXJuIFUoewogICAgICAgICAgICAgICAgcGF0aDogcwogICAgICAgICAgICB9KSwgdGhpcy5kcml2ZS51bmxpbmsodCwgcykKICAgICAgICB9CiAgICAgICAgcG9sbF9vbmVvZmYodCwgaSwgbiwgcykgewogICAgICAgICAgICBmb3IgKGxldCBmID0gMDsgZiA8IG47IGYrKykgewogICAgICAgICAgICAgICAgY29uc3QgYyA9IG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlciwgdCArIGYgKiB6LCB6KSwKICAgICAgICAgICAgICAgICAgICBvID0gaXQoYyksCiAgICAgICAgICAgICAgICAgICAgRSA9IG5ldyBVaW50OEFycmF5KHRoaXMubWVtb3J5LmJ1ZmZlciwgaSArIGYgKiAkLCAkKTsKICAgICAgICAgICAgICAgIGxldCBoID0gMCwKICAgICAgICAgICAgICAgICAgICBTID0gci5TVUNDRVNTOwogICAgICAgICAgICAgICAgc3dpdGNoIChvLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIGIuQ0xPQ0s6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBuZXcgRGF0ZSA8IG8udGltZW91dDspOwogICAgICAgICAgICAgICAgICAgICAgICBFLnNldChydChvLnVzZXJkYXRhLCByLlNVQ0NFU1MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBiLkZEX1JFQUQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLmZkIDwgMykgby5mZCA9PT0gMCA/IChTID0gci5TVUNDRVNTLCBoID0gMzIpIDogUyA9IHIuRUJBREY7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgW2csIENdID0gdGhpcy5kcml2ZS5zdGF0KG8uZmQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUyA9IGcsIGggPSBDID8gQy5ieXRlTGVuZ3RoIDogMAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIEUuc2V0KFEoby51c2VyZGF0YSwgUywgYi5GRF9SRUFELCBCaWdJbnQoaCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBiLkZEX1dSSVRFOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaCA9IDAsIFMgPSByLlNVQ0NFU1MsIG8uZmQgPCAzKSBvLmZkID09PSAwID8gUyA9IHIuRUJBREYgOiAoUyA9IHIuU1VDQ0VTUywgaCA9IDEwMjQpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFtnLCBDXSA9IHRoaXMuZHJpdmUuc3RhdChvLmZkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgPSBnLCBoID0gQyA/IEMuYnl0ZUxlbmd0aCA6IDAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBFLnNldChRKG8udXNlcmRhdGEsIFMsIGIuRkRfUkVBRCwgQmlnSW50KGgpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRhVmlldyh0aGlzLm1lbW9yeS5idWZmZXIsIHMsIDQpLnNldFVpbnQzMigwLCBuLCAhMCksIHIuU1VDQ0VTUwogICAgICAgIH0KICAgICAgICBwYXRoX2NyZWF0ZV9kaXJlY3RvcnkodCwgaSwgbikgewogICAgICAgICAgICBjb25zdCBzID0gQih0aGlzLm1lbW9yeSwgaSwgbik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRyaXZlLnBhdGhDcmVhdGVEaXIodCwgcykKICAgICAgICB9CiAgICAgICAgcGF0aF9saW5rKCkgewogICAgICAgICAgICByZXR1cm4gci5FTk9TWVMKICAgICAgICB9CiAgICAgICAgcGF0aF9yZWFkbGluaygpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHBhdGhfcmVtb3ZlX2RpcmVjdG9yeSgpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHBhdGhfc3ltbGluaygpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHByb2NfcmFpc2UoKSB7CiAgICAgICAgICAgIHJldHVybiByLkVOT1NZUwogICAgICAgIH0KICAgICAgICBzb2NrX2FjY2VwdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHNvY2tfcmVjdigpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHNvY2tfc2VuZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHNvY2tfc2h1dGRvd24oKSB7CiAgICAgICAgICAgIHJldHVybiByLkVOT1NZUwogICAgICAgIH0KICAgICAgICBzb2NrX29wZW4oKSB7CiAgICAgICAgICAgIHJldHVybiByLkVOT1NZUwogICAgICAgIH0KICAgICAgICBzb2NrX2xpc3RlbigpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHNvY2tfY29ubmVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHNvY2tfc2V0c29ja29wdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHNvY2tfYmluZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHNvY2tfZ2V0bG9jYWxhZGRyKCkgewogICAgICAgICAgICByZXR1cm4gci5FTk9TWVMKICAgICAgICB9CiAgICAgICAgc29ja19nZXRwZWVyYWRkcigpIHsKICAgICAgICAgICAgcmV0dXJuIHIuRU5PU1lTCiAgICAgICAgfQogICAgICAgIHNvY2tfZ2V0YWRkcmluZm8oKSB7CiAgICAgICAgICAgIHJldHVybiByLkVOT1NZUwogICAgICAgIH0KICAgIH0KICAgIGNvbnN0IHggPSBfLkZEX0RBVEFTWU5DIHwgXy5GRF9SRUFEIHwgXy5GRF9TRUVLIHwgXy5GRF9GRFNUQVRfU0VUX0ZMQUdTIHwgXy5GRF9TWU5DIHwgXy5GRF9URUxMIHwgXy5GRF9XUklURSB8IF8uRkRfQURWSVNFIHwgXy5GRF9BTExPQ0FURSB8IF8uUEFUSF9DUkVBVEVfRElSRUNUT1JZIHwgXy5QQVRIX0NSRUFURV9GSUxFIHwgXy5QQVRIX0xJTktfU09VUkNFIHwgXy5QQVRIX0xJTktfVEFSR0VUIHwgXy5QQVRIX09QRU4gfCBfLkZEX1JFQURESVIgfCBfLlBBVEhfUkVBRExJTksgfCBfLlBBVEhfUkVOQU1FX1NPVVJDRSB8IF8uUEFUSF9SRU5BTUVfVEFSR0VUIHwgXy5QQVRIX0ZJTEVTVEFUX0dFVCB8IF8uUEFUSF9GSUxFU1RBVF9TRVRfU0laRSB8IF8uUEFUSF9GSUxFU1RBVF9TRVRfVElNRVMgfCBfLkZEX0ZJTEVTVEFUX0dFVCB8IF8uRkRfRklMRVNUQVRfU0VUX1NJWkUgfCBfLkZEX0ZJTEVTVEFUX1NFVF9USU1FUyB8IF8uUEFUSF9TWU1MSU5LIHwgXy5QQVRIX1JFTU9WRV9ESVJFQ1RPUlkgfCBfLlBBVEhfVU5MSU5LX0ZJTEUgfCBfLlBPTExfRkRfUkVBRFdSSVRFIHwgXy5TT0NLX1NIVVRET1dOIHwgXy5TT0NLX0FDQ0VQVDsKICAgIGNsYXNzIFggZXh0ZW5kcyBFcnJvciB7CiAgICAgICAgY29uc3RydWN0b3IoaSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICBkKHRoaXMsICJjb2RlIik7CiAgICAgICAgICAgIHRoaXMuY29kZSA9IGkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gQihlLCB0LCBpKSB7CiAgICAgICAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShuZXcgVWludDhBcnJheShlLmJ1ZmZlciwgdCwgaSkpCiAgICB9CgogICAgZnVuY3Rpb24gdihlLCB0LCBpKSB7CiAgICAgICAgbGV0IG4gPSBBcnJheShpKTsKICAgICAgICBmb3IgKGxldCBzID0gMDsgcyA8IGk7IHMrKykgewogICAgICAgICAgICBjb25zdCBhID0gZS5nZXRVaW50MzIodCwgITApOwogICAgICAgICAgICB0ICs9IDQ7CiAgICAgICAgICAgIGNvbnN0IGYgPSBlLmdldFVpbnQzMih0LCAhMCk7CiAgICAgICAgICAgIHQgKz0gNCwgbltzXSA9IG5ldyBVaW50OEFycmF5KGUuYnVmZmVyLCBhLCBmKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbgogICAgfQoKICAgIGZ1bmN0aW9uIGl0KGUpIHsKICAgICAgICBjb25zdCB0ID0gbmV3IFVpbnQ4QXJyYXkoOCk7CiAgICAgICAgdC5zZXQoZS5zdWJhcnJheSgwLCA4KSk7CiAgICAgICAgY29uc3QgaSA9IGVbOF0sCiAgICAgICAgICAgIG4gPSBuZXcgRGF0YVZpZXcoZS5idWZmZXIsIGUuYnl0ZU9mZnNldCArIDkpOwogICAgICAgIHN3aXRjaCAoaSkgewogICAgICAgICAgICBjYXNlIGIuRkRfUkVBRDoKICAgICAgICAgICAgY2FzZSBiLkZEX1dSSVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICB1c2VyZGF0YTogdCwgdHlwZTogaSwgZmQ6IG4uZ2V0VWludDMyKDAsICEwKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgY2FzZSBiLkNMT0NLOgogICAgICAgICAgICAgICAgY29uc3QgcyA9IG4uZ2V0VWludDE2KDI0LCAhMCksCiAgICAgICAgICAgICAgICAgICAgYSA9IHkobmV3IERhdGUpLAogICAgICAgICAgICAgICAgICAgIGYgPSBuLmdldEJpZ1VpbnQ2NCg4LCAhMCksCiAgICAgICAgICAgICAgICAgICAgYyA9IG4uZ2V0QmlnVWludDY0KDE2LCAhMCksCiAgICAgICAgICAgICAgICAgICAgbyA9IHMgJiBxLlNVQlNDUklQVElPTl9DTE9DS19BQlNUSU1FID8gZiA6IGEgKyBmOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICB1c2VyZGF0YTogdCwgdHlwZTogaSwgaWQ6IG4uZ2V0VWludDMyKDAsICEwKSwgdGltZW91dDogcChvKSwgcHJlY2lzaW9uOiBwKG8gKyBjKQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBqKGUpIHsKICAgICAgICBjb25zdCB0ID0gbmV3IFVpbnQ4QXJyYXkoVyksCiAgICAgICAgICAgIGkgPSBuZXcgRGF0YVZpZXcodC5idWZmZXIpOwogICAgICAgIHJldHVybiBpLnNldEJpZ1VpbnQ2NCgwLCBCaWdJbnQoMCksICEwKSwgaS5zZXRCaWdVaW50NjQoOCwgQmlnSW50KEgoZS5wYXRoKSksICEwKSwgaS5zZXRVaW50OCgxNiwgZS50eXBlKSwgaS5zZXRCaWdVaW50NjQoMjQsIEJpZ0ludCgxKSwgITApLCBpLnNldEJpZ1VpbnQ2NCgzMiwgQmlnSW50KGUuYnl0ZUxlbmd0aCksICEwKSwgaS5zZXRCaWdVaW50NjQoNDAsIHkoZS50aW1lc3RhbXBzLmFjY2VzcyksICEwKSwgaS5zZXRCaWdVaW50NjQoNDgsIHkoZS50aW1lc3RhbXBzLm1vZGlmaWNhdGlvbiksICEwKSwgaS5zZXRCaWdVaW50NjQoNTYsIHkoZS50aW1lc3RhbXBzLmNoYW5nZSksICEwKSwgdAogICAgfQoKICAgIGZ1bmN0aW9uIFooZSkgewogICAgICAgIGNvbnN0IHQgPSBuZXcgVWludDhBcnJheShXKSwKICAgICAgICAgICAgaSA9IG5ldyBEYXRhVmlldyh0LmJ1ZmZlcik7CiAgICAgICAgcmV0dXJuIGkuc2V0QmlnVWludDY0KDAsIEJpZ0ludCgwKSwgITApLCBpLnNldEJpZ1VpbnQ2NCg4LCBCaWdJbnQoSChlLnBhdGgpKSwgITApLCBpLnNldFVpbnQ4KDE2LCBlLnR5cGUpLCBpLnNldFVpbnQzMigyMCwgMSwgITApLCBpLnNldEJpZ1VpbnQ2NCgyNCwgQmlnSW50KGUuYnl0ZUxlbmd0aCksICEwKSwgaS5zZXRCaWdVaW50NjQoMzIsIHkoZS50aW1lc3RhbXBzLmFjY2VzcyksICEwKSwgaS5zZXRCaWdVaW50NjQoNDAsIHkoZS50aW1lc3RhbXBzLm1vZGlmaWNhdGlvbiksICEwKSwgaS5zZXRCaWdVaW50NjQoNDgsIHkoZS50aW1lc3RhbXBzLmNoYW5nZSksICEwKSwgdAogICAgfQoKICAgIGZ1bmN0aW9uIFYoZSwgdCwgaSkgewogICAgICAgIGNvbnN0IG4gPSBpID8/IHgsCiAgICAgICAgICAgIHMgPSBpID8/IHgsCiAgICAgICAgICAgIGEgPSBuZXcgVWludDhBcnJheSgyNCksCiAgICAgICAgICAgIGYgPSBuZXcgRGF0YVZpZXcoYS5idWZmZXIsIDAsIDI0KTsKICAgICAgICByZXR1cm4gZi5zZXRVaW50OCgwLCBlKSwgZi5zZXRVaW50MzIoMiwgdCwgITApLCBmLnNldEJpZ1VpbnQ2NCg4LCBuLCAhMCksIGYuc2V0QmlnVWludDY0KDE2LCBzLCAhMCksIGEKICAgIH0KCiAgICBmdW5jdGlvbiBudChlLCB0LCBpKSB7CiAgICAgICAgY29uc3QgbiA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShlKSwKICAgICAgICAgICAgcyA9IDI0ICsgbi5ieXRlTGVuZ3RoLAogICAgICAgICAgICBhID0gbmV3IFVpbnQ4QXJyYXkocyksCiAgICAgICAgICAgIGYgPSBuZXcgRGF0YVZpZXcoYS5idWZmZXIpOwogICAgICAgIHJldHVybiBmLnNldEJpZ1VpbnQ2NCgwLCBCaWdJbnQoaSArIDEpLCAhMCksIGYuc2V0QmlnVWludDY0KDgsIEJpZ0ludChIKGUpKSwgITApLCBmLnNldFVpbnQzMigxNiwgbi5sZW5ndGgsICEwKSwgZi5zZXRVaW50OCgyMCwgdCksIGEuc2V0KG4sIDI0KSwgYQogICAgfQoKICAgIGZ1bmN0aW9uIHJ0KGUsIHQpIHsKICAgICAgICBjb25zdCBpID0gbmV3IFVpbnQ4QXJyYXkoMzIpOwogICAgICAgIGkuc2V0KGUsIDApOwogICAgICAgIGNvbnN0IG4gPSBuZXcgRGF0YVZpZXcoaS5idWZmZXIpOwogICAgICAgIHJldHVybiBuLnNldFVpbnQxNig4LCB0LCAhMCksIG4uc2V0VWludDE2KDEwLCBiLkNMT0NLLCAhMCksIGkKICAgIH0KCiAgICBmdW5jdGlvbiBRKGUsIHQsIGksIG4pIHsKICAgICAgICBjb25zdCBzID0gbmV3IFVpbnQ4QXJyYXkoMzIpOwogICAgICAgIHMuc2V0KGUsIDApOwogICAgICAgIGNvbnN0IGEgPSBuZXcgRGF0YVZpZXcocy5idWZmZXIpOwogICAgICAgIHJldHVybiBhLnNldFVpbnQxNig4LCB0LCAhMCksIGEuc2V0VWludDE2KDEwLCBpLCAhMCksIGEuc2V0QmlnVWludDY0KDE2LCBuLCAhMCksIHMKICAgIH0KCiAgICBmdW5jdGlvbiBIKGUsIHQgPSAwKSB7CiAgICAgICAgbGV0IGkgPSAzNzM1OTI4NTU5IF4gdCwKICAgICAgICAgICAgbiA9IDExMDM1NDc5OTEgXiB0OwogICAgICAgIGZvciAobGV0IHMgPSAwLCBhOyBzIDwgZS5sZW5ndGg7IHMrKykgYSA9IGUuY2hhckNvZGVBdChzKSwgaSA9IE1hdGguaW11bChpIF4gYSwgMjY1NDQzNTc2MSksIG4gPSBNYXRoLmltdWwobiBeIGEsIDE1OTczMzQ2NzcpOwogICAgICAgIHJldHVybiBpID0gTWF0aC5pbXVsKGkgXiBpID4+PiAxNiwgMjI0NjgyMjUwNykgXiBNYXRoLmltdWwobiBeIG4gPj4+IDEzLCAzMjY2NDg5OTA5KSwgbiA9IE1hdGguaW11bChuIF4gbiA+Pj4gMTYsIDIyNDY4MjI1MDcpIF4gTWF0aC5pbXVsKGkgXiBpID4+PiAxMywgMzI2NjQ4OTkwOSksIDQyOTQ5NjcyOTYgKiAoMjA5NzE1MSAmIG4pICsgKGkgPj4+IDApCiAgICB9CgogICAgZnVuY3Rpb24geShlKSB7CiAgICAgICAgcmV0dXJuIEJpZ0ludChlLmdldFRpbWUoKSkgKiBCaWdJbnQoMWU2KQogICAgfQoKICAgIGZ1bmN0aW9uIHAoZSkgewogICAgICAgIHJldHVybiBuZXcgRGF0ZShOdW1iZXIoZSAvIEJpZ0ludCgxZTYpKSkKICAgIH0KICAgIGNvbnN0IHN0ID0gewogICAgICAgIFtNLkNVUl06IEQuQ1VSLAogICAgICAgIFtNLkVORF06IEQuRU5ELAogICAgICAgIFtNLlNFVF06IEQuU0VUCiAgICB9OwogICAgY2xhc3MgYXQgewogICAgICAgIGNvbnN0cnVjdG9yKHQpIHsKICAgICAgICAgICAgZCh0aGlzLCAiZnMiKTsKICAgICAgICAgICAgZCh0aGlzLCAiYXJncyIpOwogICAgICAgICAgICBkKHRoaXMsICJlbnYiKTsKICAgICAgICAgICAgZCh0aGlzLCAic3RkaW4iKTsKICAgICAgICAgICAgZCh0aGlzLCAic3Rkb3V0Iik7CiAgICAgICAgICAgIGQodGhpcywgInN0ZGVyciIpOwogICAgICAgICAgICBkKHRoaXMsICJkZWJ1ZyIpOwogICAgICAgICAgICBkKHRoaXMsICJpc1RUWSIpOwogICAgICAgICAgICB0aGlzLmZzID0gKHQgPT0gbnVsbCA/IHZvaWQgMCA6IHQuZnMpID8/IHt9LCB0aGlzLmFyZ3MgPSAodCA9PSBudWxsID8gdm9pZCAwIDogdC5hcmdzKSA/PyBbXSwgdGhpcy5lbnYgPSAodCA9PSBudWxsID8gdm9pZCAwIDogdC5lbnYpID8/IHt9LCB0aGlzLnN0ZGluID0gKHQgPT0gbnVsbCA/IHZvaWQgMCA6IHQuc3RkaW4pID8/ICgoKSA9PiBudWxsKSwgdGhpcy5zdGRvdXQgPSAodCA9PSBudWxsID8gdm9pZCAwIDogdC5zdGRvdXQpID8/ICgoKSA9PiB7fSksIHRoaXMuc3RkZXJyID0gKHQgPT0gbnVsbCA/IHZvaWQgMCA6IHQuc3RkZXJyKSA/PyAoKCkgPT4ge30pLCB0aGlzLmRlYnVnID0gdCA9PSBudWxsID8gdm9pZCAwIDogdC5kZWJ1ZywgdGhpcy5pc1RUWSA9ICEhKHQgIT0gbnVsbCAmJiB0LmlzVFRZKQogICAgICAgIH0KICAgIH0KICAgIG9ubWVzc2FnZSA9IGFzeW5jIGUgPT4gewogICAgICAgIGNvbnN0IHQgPSBlLmRhdGE7CiAgICAgICAgc3dpdGNoICh0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAic3RhcnRVUkwiOgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gYXdhaXQgZnRVUkwodC5iaW5hcnlVUkwsIHQuc3RkaW5CdWZmZXIsIHQpOwogICAgICAgICAgICAgICAgICAgIEwoewogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6ICJob3N0IiwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInJlc3VsdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdDogaQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG47CiAgICAgICAgICAgICAgICAgICAgaSBpbnN0YW5jZW9mIEVycm9yID8gbiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogaS5tZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBpLmNvbnN0cnVjdG9yLm5hbWUKICAgICAgICAgICAgICAgICAgICB9IDogbiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogYHVua25vd24gZXJyb3IgLSAke2l9YCwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlVua25vd24iCiAgICAgICAgICAgICAgICAgICAgfSwgTCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogImhvc3QiLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiY3Jhc2giLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogbgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBjYXNlICJzdGFydEJ1ZmZlciI6CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBhd2FpdCBmdEJ1ZmZlcih0LmJpbmFyeUJ1ZmZlciwgdC5zdGRpbkJ1ZmZlciwgdCk7CiAgICAgICAgICAgICAgICAgICAgTCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogImhvc3QiLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAicmVzdWx0IiwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0OiBpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGkpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgbjsKICAgICAgICAgICAgICAgICAgICBpIGluc3RhbmNlb2YgRXJyb3IgPyBuID0gewogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBpLm1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGkuY29uc3RydWN0b3IubmFtZQogICAgICAgICAgICAgICAgICAgIH0gOiBuID0gewogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgdW5rbm93biBlcnJvciAtICR7aX1gLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiVW5rbm93biIKICAgICAgICAgICAgICAgICAgICB9LCBMKHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiAiaG9zdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJjcmFzaCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBuCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiBMKGUpIHsKICAgICAgICBwb3N0TWVzc2FnZShlKQogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gZnRCdWZmZXIoZSwgdCwgaSkgewogICAgICAgIGxldCB3YXNpID0gbmV3IFkobmV3IGF0KHsKICAgICAgICAgICAgLi4uaSwKICAgICAgICAgICAgc3Rkb3V0OiBvdCwKICAgICAgICAgICAgc3RkZXJyOiBjdCwKICAgICAgICAgICAgc3RkaW46IG4gPT4gaHQobiwgdCksCiAgICAgICAgICAgIGRlYnVnOiBFdAogICAgICAgIH0pKQogICAgICAgIHdhc2kuaW5pdChhd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShlLCB7CiAgICAgICAgICAgIHdhc2lfc25hcHNob3RfcHJldmlldzE6IHdhc2kuZ2V0SW1wb3J0cygicHJldmlldzEiKSwKICAgICAgICAgICAgd2FzaV91bnN0YWJsZTogd2FzaS5nZXRJbXBvcnRzKCJ1bnN0YWJsZSIpCiAgICAgICAgfSkpCiAgICAgICAgcmV0dXJuIHdhc2kuc3RhcnQoKQogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gZnRVUkwoZSwgdCwgaSkgewogICAgICAgIHJldHVybiBZLnN0YXJ0KGZldGNoKGUpLCBuZXcgYXQoeyAuLi5pLAogICAgICAgICAgICBzdGRvdXQ6IG90LAogICAgICAgICAgICBzdGRlcnI6IGN0LAogICAgICAgICAgICBzdGRpbjogbiA9PiBodChuLCB0KSwKICAgICAgICAgICAgZGVidWc6IEV0CiAgICAgICAgfSkpCiAgICB9CgogICAgZnVuY3Rpb24gb3QoZSkgewogICAgICAgIEwoewogICAgICAgICAgICB0YXJnZXQ6ICJob3N0IiwKICAgICAgICAgICAgdHlwZTogInN0ZG91dCIsCiAgICAgICAgICAgIHRleHQ6IGUKICAgICAgICB9KQogICAgfQoKICAgIGZ1bmN0aW9uIGN0KGUpIHsKICAgICAgICBMKHsKICAgICAgICAgICAgdGFyZ2V0OiAiaG9zdCIsCiAgICAgICAgICAgIHR5cGU6ICJzdGRlcnIiLAogICAgICAgICAgICB0ZXh0OiBlCiAgICAgICAgfSkKICAgIH0KCiAgICBmdW5jdGlvbiBFdChlLCB0LCBpLCBuKSB7CiAgICAgICAgcmV0dXJuIG4gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG4pKSwgTCh7CiAgICAgICAgICAgIHRhcmdldDogImhvc3QiLAogICAgICAgICAgICB0eXBlOiAiZGVidWciLAogICAgICAgICAgICBuYW1lOiBlLAogICAgICAgICAgICBhcmdzOiB0LAogICAgICAgICAgICByZXQ6IGksCiAgICAgICAgICAgIGRhdGE6IG4KICAgICAgICB9KSwgaQogICAgfQoKICAgIGZ1bmN0aW9uIGh0KGUsIHQpIHsKICAgICAgICBBdG9taWNzLndhaXQobmV3IEludDMyQXJyYXkodCksIDAsIDApOwogICAgICAgIGNvbnN0IGkgPSBuZXcgRGF0YVZpZXcodCksCiAgICAgICAgICAgIG4gPSBpLmdldEludDMyKDApOwogICAgICAgIGlmIChuIDwgMCkgcmV0dXJuIGkuc2V0SW50MzIoMCwgMCksIG51bGw7CiAgICAgICAgY29uc3QgcyA9IG5ldyBVaW50OEFycmF5KHQsIDQsIG4pLAogICAgICAgICAgICBhID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKHMuc2xpY2UoMCwgZSkpLAogICAgICAgICAgICBmID0gcy5zbGljZShlLCBzLmxlbmd0aCk7CiAgICAgICAgcmV0dXJuIGkuc2V0SW50MzIoMCwgZi5ieXRlTGVuZ3RoKSwgcy5zZXQoZiksIGEKICAgIH0KfSkoKTs="
+    ,j = typeof window < "u" && window.Blob && new Blob([atob(tt)], { type: "text/javascript;charset=utf-8" });
 function ot() {
   let i;
   try {
@@ -1446,15 +1448,16 @@ function ut(i, t) {
 class St extends Error {
 }
 class Gt {
-  constructor(t, e) {
+  constructor(url, buf, e) {
     m(this, "binaryURL");
+    m(this, "binaryBuffer");
     // 8kb should be big enough
     m(this, "stdinBuffer", new SharedArrayBuffer(8 * 1024));
     m(this, "context");
     m(this, "result");
     m(this, "worker");
     m(this, "reject");
-    this.binaryURL = t, this.context = e;
+    this.binaryURL = url, this.binaryBuffer = buf, this.context = e;
   }
   async start() {
     if (this.result)
@@ -1480,9 +1483,9 @@ class Gt {
             e(l.error);
             break;
         }
-      }), ut(this.worker, {
+      }), ut(this.worker, this.binaryURL ? {
         target: "client",
-        type: "start",
+        type: "startURL",
         binaryURL: this.binaryURL,
         stdinBuffer: this.stdinBuffer,
         // Unfortunately can't just splat these because it includes types
@@ -1491,6 +1494,17 @@ class Gt {
         env: this.context.env,
         fs: this.context.fs,
         isTTY: this.context.isTTY
+      } : {
+        target: "client",
+        type: "startBuffer",
+        binaryBuffer: this.binaryBuffer,
+        stdinBuffer: this.stdinBuffer,
+        // Unfortunately can't just splat these because it includes types
+        // that can't be sent as a message.
+        args: this.context.args,
+        env: this.context.env,
+        fs: this.context.fs,
+        isTTY: this.context.isTTY
       });
     }), this.result;
   }
